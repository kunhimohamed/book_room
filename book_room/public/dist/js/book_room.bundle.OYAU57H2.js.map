{
  "version": 3,
  "sources": ["../../../../../apps/frappe/frappe/public/js/frappe/form/script_manager.js", "frappe-html:/home/kunhi/Projects/library_system/frappe-bench/apps/book_room/book_room/public/js/frappe/ui/page.html", "../../../../../apps/book_room/book_room/public/js/frappe/ui/page.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/quick_entry.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/linked_with.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/form_viewers.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/toolbar.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/section.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/dashboard.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/workflow.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/save.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/print_utils.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/success_action.js", "../../../../../apps/book_room/book_room/public/js/frappe/form/form.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/script_helpers.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/assign_to.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/attachments.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/share.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/review.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/document_follow.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/user_image.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/form_sidebar_users.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/sidebar/form_sidebar.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/base_timeline.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/version_timeline_content_builder.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/form_timeline.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/footer.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/form_tour.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/undo_manager.js", "../../../../../apps/frappe/frappe/public/js/frappe/list/list_filter.js", "../../../../../apps/book_room/book_room/public/js/frappe/list/list_sidebar.js"],
  "sourcesContent": ["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form.handlers\");\n\nwindow.extend_cscript = (cscript, controller_object) => {\n\t$.extend(cscript, controller_object);\n\tif (cscript && controller_object) {\n\t\tcscript.__proto__ = controller_object.__proto__;\n\t}\n\treturn cscript;\n};\n\nfrappe.ui.form.get_event_handler_list = function (doctype, fieldname) {\n\tif (!frappe.ui.form.handlers[doctype]) {\n\t\tfrappe.ui.form.handlers[doctype] = {};\n\t}\n\tif (!frappe.ui.form.handlers[doctype][fieldname]) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\treturn frappe.ui.form.handlers[doctype][fieldname];\n};\n\nfrappe.ui.form.on = frappe.ui.form.on_change = function (doctype, fieldname, handler) {\n\tvar add_handler = function (fieldname, handler) {\n\t\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\n\t\tlet _handler = (...args) => {\n\t\t\ttry {\n\t\t\t\treturn handler(...args);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(handler);\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t};\n\n\t\thandler_list.push(_handler);\n\n\t\t// add last handler to events so it can be called as\n\t\t// frm.events.handler(frm)\n\t\tif (cur_frm && cur_frm.doctype === doctype) {\n\t\t\tcur_frm.events[fieldname] = _handler;\n\t\t}\n\t};\n\n\tif (!handler && $.isPlainObject(fieldname)) {\n\t\t// a dict of handlers {fieldname: handler, ...}\n\t\tfor (var key in fieldname) {\n\t\t\tvar fn = fieldname[key];\n\t\t\tif (typeof fn === \"function\") {\n\t\t\t\tadd_handler(key, fn);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tadd_handler(fieldname, handler);\n\t}\n};\n\n// remove standard event handlers\nfrappe.ui.form.off = function (doctype, fieldname, handler) {\n\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\tif (handler_list.length) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\n\tif (cur_frm && cur_frm.doctype === doctype && cur_frm.events[fieldname]) {\n\t\tdelete cur_frm.events[fieldname];\n\t}\n\n\tif (cur_frm && cur_frm.cscript && cur_frm.cscript[fieldname]) {\n\t\tdelete cur_frm.cscript[fieldname];\n\t}\n};\n\nfrappe.ui.form.trigger = function (doctype, fieldname) {\n\tcur_frm.script_manager.trigger(fieldname, doctype);\n};\n\nfrappe.ui.form.ScriptManager = class ScriptManager {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\tmake(ControllerClass) {\n\t\tthis.frm.cscript = extend_cscript(\n\t\t\tthis.frm.cscript,\n\t\t\tnew ControllerClass({ frm: this.frm })\n\t\t);\n\t}\n\ttrigger(event_name, doctype, name) {\n\t\t// trigger all the form level events that\n\t\t// are bound to this event_name\n\t\tlet me = this;\n\t\tdoctype = doctype || this.frm.doctype;\n\t\tname = name || this.frm.docname;\n\n\t\tlet tasks = [];\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\n\t\t// helper for child table\n\t\tthis.frm.selected_doc = frappe.get_doc(doctype, name);\n\n\t\tlet runner = (_function, is_old_style) => {\n\t\t\tlet _promise = null;\n\t\t\tif (is_old_style) {\n\t\t\t\t// old style arguments (doc, cdt, cdn)\n\t\t\t\t_promise = me.frm.cscript[_function](me.frm.doc, doctype, name);\n\t\t\t} else {\n\t\t\t\t// new style (frm, doctype, name)\n\t\t\t\t_promise = _function(me.frm, doctype, name);\n\t\t\t}\n\n\t\t\t// if the trigger returns a promise, return it,\n\t\t\t// or use the default promise frappe.after_ajax\n\t\t\tif (_promise && _promise.then) {\n\t\t\t\treturn _promise;\n\t\t\t} else {\n\t\t\t\treturn frappe.after_server_call();\n\t\t\t}\n\t\t};\n\n\t\t// make list of functions to be run serially\n\t\thandlers.new_style.forEach((_function) => {\n\t\t\tif (event_name === \"setup\") {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, false);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, false));\n\t\t\t}\n\t\t});\n\n\t\thandlers.old_style.forEach((_function) => {\n\t\t\tif (event_name === \"setup\") {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, true);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, true));\n\t\t\t}\n\t\t});\n\n\t\t// run them serially\n\t\treturn frappe.run_serially(tasks);\n\t}\n\thas_handlers(event_name, doctype) {\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\t\treturn handlers && (handlers.old_style.length || handlers.new_style.length);\n\t}\n\tget_handlers(event_name, doctype) {\n\t\t// returns list of all functions to be called (old style and new style)\n\t\tlet me = this;\n\t\tlet handlers = {\n\t\t\told_style: [],\n\t\t\tnew_style: [],\n\t\t};\n\t\tif (frappe.ui.form.handlers[doctype] && frappe.ui.form.handlers[doctype][event_name]) {\n\t\t\t$.each(frappe.ui.form.handlers[doctype][event_name], function (i, fn) {\n\t\t\t\thandlers.new_style.push(fn);\n\t\t\t});\n\t\t}\n\t\tif (this.frm.cscript[event_name]) {\n\t\t\thandlers.old_style.push(event_name);\n\t\t}\n\t\tif (this.frm.cscript[\"custom_\" + event_name]) {\n\t\t\thandlers.old_style.push(\"custom_\" + event_name);\n\t\t}\n\t\treturn handlers;\n\t}\n\tsetup() {\n\t\tconst doctype = this.frm.meta;\n\t\tconst me = this;\n\t\tlet client_script = doctype.__js;\n\n\t\t// append the custom script for this form's layout\n\t\tif (this.frm.doctype_layout?.client_script) {\n\t\t\t// add a newline to avoid conflict with doctype JS\n\t\t\tclient_script += `\\n${this.frm.doctype_layout.client_script}`;\n\t\t}\n\n\t\tif (client_script) {\n\t\t\teval(client_script);\n\t\t}\n\n\t\tif (!this.frm.doctype_layout && doctype.__custom_js) {\n\t\t\ttry {\n\t\t\t\teval(doctype.__custom_js);\n\t\t\t} catch (e) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __(\"Error in Client Script\"),\n\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t\tmessage: '<pre class=\"small\"><code>' + e.stack + \"</code></pre>\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setup_add_fetch(df) {\n\t\t\tlet is_read_only_field =\n\t\t\t\t[\n\t\t\t\t\t\"Data\",\n\t\t\t\t\t\"Read Only\",\n\t\t\t\t\t\"Text\",\n\t\t\t\t\t\"Small Text\",\n\t\t\t\t\t\"Currency\",\n\t\t\t\t\t\"Check\",\n\t\t\t\t\t\"Text Editor\",\n\t\t\t\t\t\"Attach Image\",\n\t\t\t\t\t\"Code\",\n\t\t\t\t\t\"Link\",\n\t\t\t\t\t\"Float\",\n\t\t\t\t\t\"Int\",\n\t\t\t\t\t\"Date\",\n\t\t\t\t\t\"Select\",\n\t\t\t\t\t\"Duration\",\n\t\t\t\t].includes(df.fieldtype) ||\n\t\t\t\tdf.read_only == 1 ||\n\t\t\t\tdf.is_virtual == 1;\n\n\t\t\tif (is_read_only_field && df.fetch_from && df.fetch_from.indexOf(\".\") != -1) {\n\t\t\t\tvar parts = df.fetch_from.split(\".\");\n\t\t\t\tme.frm.add_fetch(parts[0], parts[1], df.fieldname, df.parent);\n\t\t\t}\n\t\t}\n\n\t\t// setup add fetch\n\t\t$.each(this.frm.fields, function (i, field) {\n\t\t\tsetup_add_fetch(field.df);\n\t\t\tif (frappe.model.table_fields.includes(field.df.fieldtype)) {\n\t\t\t\t$.each(\n\t\t\t\t\tfrappe.meta.get_docfields(field.df.options, me.frm.docname),\n\t\t\t\t\tfunction (i, df) {\n\t\t\t\t\t\tsetup_add_fetch(df);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\t// css\n\t\tdoctype.__css && frappe.dom.set_style(doctype.__css);\n\n\t\tthis.trigger(\"setup\");\n\t}\n\tlog_error(caller, e) {\n\t\tfrappe.show_alert({ message: __(\"Error in Client Script.\"), indicator: \"error\" });\n\t\tconsole.group && console.group();\n\t\tconsole.log(\"----- error in client script -----\");\n\t\tconsole.log(\"method: \" + caller);\n\t\tconsole.log(e);\n\t\tconsole.log(\"error message: \" + e.message);\n\t\tconsole.trace && console.trace();\n\t\tconsole.log(\"----- end of error message -----\");\n\t\tconsole.group && console.groupEnd();\n\t}\n\tcopy_from_first_row(parentfield, current_row, fieldnames) {\n\t\tvar data = this.frm.doc[parentfield];\n\t\tif (data.length === 1 || data[0] === current_row) return;\n\n\t\tif (typeof fieldnames === \"string\") {\n\t\t\tfieldnames = [fieldnames];\n\t\t}\n\n\t\t$.each(fieldnames, function (i, fieldname) {\n\t\t\tfrappe.model.set_value(\n\t\t\t\tcurrent_row.doctype,\n\t\t\t\tcurrent_row.name,\n\t\t\t\tfieldname,\n\t\t\t\tdata[0][fieldname]\n\t\t\t);\n\t\t});\n\t}\n};\n", "\n\tfrappe.templates['page'] = `<div class=\"page-head flex\">\n\t<div class=\"container\">\n\t\t<div class=\"row flex align-center page-head-content justify-between\">\n\t\t\t<div class=\"col-md-4 col-sm-6 col-xs-8 page-title\">\n\t\t\t\t<!-- <div class=\"title-image hide hidden-md hidden-lg\"></div> -->\n\t\t\t\t<!-- title -->\n\t\t\t\t<span class=\"sidebar-toggle-btn\" style=\"display: none;\">\n\t\t\t\t\t<svg class=\"icon icon-md sidebar-toggle-placeholder\">\n\t\t\t\t\t\t<use href=\"#icon-menu\"></use>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span class=\"sidebar-toggle-icon\">\n\t\t\t\t\t\t<svg class=\"icon icon-md\">\n\t\t\t\t\t\t\t<use href=\"#icon-sidebar-collapse\">\n\t\t\t\t\t\t\t</use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<div class=\"flex fill-width title-area\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"flex\">\n\t\t\t\t\t\t\t<h3 class=\"ellipsis title-text\"></h3>\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ellipsis sub-heading hide text-muted\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class=\"btn btn-default more-button hide\">\n\t\t\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t\t\t<use href=\"#icon-dot-horizontal\">\n\t\t\t\t\t\t\t</use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"flex col page-actions justify-content-end\">\n\t\t\t\t<!-- buttons -->\n\t\t\t\t<div class=\"custom-actions hide hidden-xs hidden-md\"></div>\n\t\t\t\t<div class=\"standard-actions flex\">\n\t\t\t\t\t<span class=\"page-icon-group hide hidden-xs hidden-sm\"></span>\n\t\t\t\t\t<div class=\"menu-btn-group hide\">\n\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-default icon-btn\" data-toggle=\"dropdown\" aria-expanded=\"false\">\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t<span class=\"menu-btn-group-label\">\n\t\t\t\t\t\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t\t\t\t\t\t<use href=\"#icon-dot-horizontal\">\n\t\t\t\t\t\t\t\t\t\t</use>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\"></ul>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class=\"btn btn-secondary btn-default btn-sm hide\"></button>\n\t\t\t\t\t<div class=\"actions-btn-group hide\">\n\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary btn-sm\" data-toggle=\"dropdown\" aria-expanded=\"false\">\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t<span class=\"hidden-xs actions-btn-group-label\">{%= __(\"Actions\") %}</span>\n\t\t\t\t\t\t\t\t<svg class=\"icon icon-xs\">\n\t\t\t\t\t\t\t\t\t<use href=\"#icon-select\">\n\t\t\t\t\t\t\t\t\t</use>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\">\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class=\"btn btn-primary btn-sm hide primary-action\"></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div class=\"container page-body\">\n\t<div class=\"page-toolbar hide\">\n\t\t<div class=\"container\">\n\t\t</div>\n\t</div>\n\t<div class=\"page-wrapper\">\n\t\t<div class=\"page-content\">\n\t\t\t<div class=\"workflow-button-area btn-group pull-right hide\"></div>\n\t\t\t<div class=\"clearfix\"></div>\n\t\t</div>\n\t</div>\n</div>\n`;\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n/**\n * Make a standard page layout with a toolbar and title\n *\n * @param {Object} opts\n *\n * @param {string} opts.parent [HTMLElement] Parent element\n * @param {boolean} opts.single_column Whether to include sidebar\n * @param {string} [opts.title] Page title\n * @param {Object} [opts.make_page]\n *\n * @returns {frappe.ui.Page}\n */\n\n/**\n * @typedef {Object} frappe.ui.Page\n */\n\nfrappe.ui.make_app_page = function (opts) {\n\topts.parent.page = new frappe.ui.Page(opts);\n\treturn opts.parent.page;\n};\n\nfrappe.ui.pages = {};\n\nfrappe.ui.Page = class Page {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.set_document_title = true;\n\t\tthis.buttons = {};\n\t\tthis.fields_dict = {};\n\t\tthis.views = {};\n\n\t\tthis.make();\n\t\tfrappe.ui.pages[frappe.get_route_str()] = this;\n\t}\n\n\tmake() {\n\t\tthis.wrapper = $(this.parent);\n\t\tthis.add_main_section();\n\t\tthis.setup_scroll_handler();\n\t\tthis.setup_sidebar_toggle();\n\t}\n\n\tsetup_scroll_handler() {\n\t\tlet last_scroll = 0;\n\t\t$(window).scroll(\n\t\t\tfrappe.utils.throttle(() => {\n\t\t\t\t$(\".page-head\").toggleClass(\"drop-shadow\", !!document.documentElement.scrollTop);\n\t\t\t\tlet current_scroll = document.documentElement.scrollTop;\n\t\t\t\tif (current_scroll > 0 && last_scroll <= current_scroll) {\n\t\t\t\t\t$(\".page-head\").css(\"top\", \"-15px\");\n\t\t\t\t} else {\n\t\t\t\t\t$(\".page-head\").css(\"top\", \"var(--navbar-height)\");\n\t\t\t\t}\n\t\t\t\tlast_scroll = current_scroll;\n\t\t\t}, 500)\n\t\t);\n\t}\n\n\tget_empty_state(title, message, primary_action) {\n\t\tlet $empty_state = $(`<div class=\"page-card-container\">\n\t\t\t<div class=\"page-card\">\n\t\t\t\t<div class=\"page-card-head\">\n\t\t\t\t\t<span class=\"indicator blue\">\n\t\t\t\t\t\t${title}</span>\n\t\t\t\t</div>\n\t\t\t\t<p>${message}</p>\n\t\t\t\t<div>\n\t\t\t\t\t<button class=\"btn btn-primary btn-sm\">${primary_action}</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`);\n\n\t\treturn $empty_state;\n\t}\n\n\tload_lib(callback) {\n\t\tfrappe.require(this.required_libs, callback);\n\t}\n\n\tadd_main_section() {\n\t\t$(frappe.render_template(\"page\", {})).appendTo(this.wrapper);\n\t\tif (this.single_column) {\n\t\t\t// nesting under col-sm-12 for consistency\n\t\t\tthis.add_view(\n\t\t\t\t\"main\",\n\t\t\t\t'<div class=\"row layout-main\">\\\n\t\t\t\t\t<div class=\"col-md-12 layout-main-section-wrapper\">\\\n\t\t\t\t\t\t<div class=\"layout-main-section\"></div>\\\n\t\t\t\t\t\t<div class=\"layout-footer hide\"></div>\\\n\t\t\t\t\t</div>\\\n\t\t\t\t</div>'\n\t\t\t);\n\t\t} else {\n\t\t\t// display none for side bar by default\n\t\t\tthis.add_view(\n\t\t\t\t\"main\",\n\t\t\t\t`\n\t\t\t\t<div class=\"row layout-main\">\n\t\t\t\t\t<div class=\"col-lg-2 layout-side-section\" style=\"display:none\"></div>\n\t\t\t\t\t<div class=\"col layout-main-section-wrapper\">\n\t\t\t\t\t\t<div class=\"layout-main-section\"></div>\n\t\t\t\t\t\t<div class=\"layout-footer hide\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`\n\t\t\t);\n\t\t}\n\n\t\tthis.setup_page();\n\t}\n\n\tsetup_page() {\n\t\tthis.$title_area = this.wrapper.find(\".title-area\");\n\n\t\tthis.$sub_title_area = this.wrapper.find(\"h6\");\n\n\t\tif (this.title) this.set_title(this.title);\n\n\t\tif (this.icon) this.get_main_icon(this.icon);\n\n\t\tthis.body = this.main = this.wrapper.find(\".layout-main-section\");\n\t\tthis.container = this.wrapper.find(\".page-body\");\n\t\t// this.sidebar = this.wrapper.find(\".layout-side-section\");\n\t\tthis.footer = this.wrapper.find(\".layout-footer\");\n\t\tthis.indicator = this.wrapper.find(\".indicator-pill\");\n\n\t\tthis.page_actions = this.wrapper.find(\".page-actions\");\n\n\t\tthis.btn_primary = this.page_actions.find(\".primary-action\");\n\t\tthis.btn_secondary = this.page_actions.find(\".btn-secondary\");\n\n\t\tthis.menu = this.page_actions.find(\".menu-btn-group .dropdown-menu\");\n\t\tthis.menu_btn_group = this.page_actions.find(\".menu-btn-group\");\n\n\t\tthis.actions = this.page_actions.find(\".actions-btn-group .dropdown-menu\");\n\t\tthis.actions_btn_group = this.page_actions.find(\".actions-btn-group\");\n\n\t\tthis.standard_actions = this.page_actions.find(\".standard-actions\");\n\t\tthis.custom_actions = this.page_actions.find(\".custom-actions\");\n\n\t\tthis.page_form = $('<div class=\"page-form row hide\"></div>').prependTo(this.main);\n\t\tthis.inner_toolbar = this.custom_actions;\n\t\tthis.icon_group = this.page_actions.find(\".page-icon-group\");\n\n\t\tif (this.make_page) {\n\t\t\tthis.make_page();\n\t\t}\n\n\t\tthis.card_layout && this.main.addClass(\"frappe-card\");\n\n\t\t// keyboard shortcuts\n\t\tlet menu_btn = this.menu_btn_group.find(\"button\");\n\t\tmenu_btn.attr(\"title\", __(\"Menu\")).tooltip({ delay: { show: 600, hide: 100 } });\n\t\tfrappe.ui.keys\n\t\t\t.get_shortcut_group(this.page_actions[0])\n\t\t\t.add(menu_btn, menu_btn.find(\".menu-btn-group-label\"));\n\n\t\tlet action_btn = this.actions_btn_group.find(\"button\");\n\t\tfrappe.ui.keys\n\t\t\t.get_shortcut_group(this.page_actions[0])\n\t\t\t.add(action_btn, action_btn.find(\".actions-btn-group-label\"));\n\t}\n\n\tsetup_sidebar_toggle() {\n\t\tlet sidebar_toggle = $(\".page-head\").find(\".sidebar-toggle-btn\");\n\t\tlet sidebar_wrapper = this.wrapper.find(\".layout-side-section\");\n\t\tif (this.disable_sidebar_toggle || !sidebar_wrapper.length) {\n\t\t\tsidebar_toggle.last().remove();\n\t\t} else {\n\t\t\tsidebar_toggle.attr(\"title\", __(\"Toggle Sidebar\")).tooltip({\n\t\t\t\tdelay: { show: 600, hide: 100 },\n\t\t\t\ttrigger: \"hover\",\n\t\t\t});\n\t\t\tsidebar_toggle.click(() => {\n\t\t\t\tif (frappe.utils.is_xs() || frappe.utils.is_sm()) {\n\t\t\t\t\tthis.setup_overlay_sidebar();\n\t\t\t\t} else {\n\t\t\t\t\tsidebar_wrapper.toggle();\n\t\t\t\t}\n\t\t\t\t$(document.body).trigger(\"toggleSidebar\");\n\t\t\t\tthis.update_sidebar_icon();\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_overlay_sidebar() {\n\t\tthis.sidebar.find(\".close-sidebar\").remove();\n\t\tlet overlay_sidebar = this.sidebar.find(\".overlay-sidebar\").addClass(\"opened\");\n\t\t$('<div class=\"close-sidebar\">').hide().appendTo(this.sidebar).fadeIn();\n\t\tlet scroll_container = $(\"html\").css(\"overflow-y\", \"hidden\");\n\n\t\tthis.sidebar.find(\".close-sidebar\").on(\"click\", (e) => this.close_sidebar(e));\n\t\tthis.sidebar.on(\"click\", \"button:not(.dropdown-toggle)\", (e) => this.close_sidebar(e));\n\n\t\tthis.close_sidebar = () => {\n\t\t\tscroll_container.css(\"overflow-y\", \"\");\n\t\t\tthis.sidebar.find(\"div.close-sidebar\").fadeOut(() => {\n\t\t\t\toverlay_sidebar\n\t\t\t\t\t.removeClass(\"opened\")\n\t\t\t\t\t.find(\".dropdown-toggle\")\n\t\t\t\t\t.removeClass(\"text-muted\");\n\t\t\t});\n\t\t};\n\t}\n\n\tupdate_sidebar_icon() {\n\t\tlet sidebar_toggle = $(\".page-head\").find(\".sidebar-toggle-btn\");\n\t\tlet sidebar_toggle_icon = sidebar_toggle.find(\".sidebar-toggle-icon\");\n\t\tlet sidebar_wrapper = this.wrapper.find(\".layout-side-section\");\n\t\tlet is_sidebar_visible = $(sidebar_wrapper).is(\":visible\");\n\t\tsidebar_toggle_icon.html(\n\t\t\tfrappe.utils.icon(is_sidebar_visible ? \"sidebar-collapse\" : \"sidebar-expand\", \"md\")\n\t\t);\n\t}\n\n\tset_indicator(label, color) {\n\t\tthis.clear_indicator().removeClass(\"hide\").html(`<span>${label}</span>`).addClass(color);\n\t}\n\n\tadd_action_icon(icon, click, css_class = \"\", tooltip_label) {\n\t\tconst button = $(`\n\t\t\t<button class=\"text-muted btn btn-default ${css_class} icon-btn\">\n\t\t\t\t${frappe.utils.icon(icon)}\n\t\t\t</button>\n\t\t`);\n\n\t\tbutton.appendTo(this.icon_group.removeClass(\"hide\"));\n\t\tbutton.click(click);\n\t\tbutton\n\t\t\t.attr(\"title\", __(tooltip_label || frappe.unscrub(icon)))\n\t\t\t.tooltip({ delay: { show: 600, hide: 100 }, trigger: \"hover\" });\n\n\t\treturn button;\n\t}\n\n\tclear_indicator() {\n\t\treturn this.indicator.removeClass().addClass(\"indicator-pill whitespace-nowrap hide\");\n\t}\n\n\tget_icon_label(icon, label) {\n\t\tlet icon_name = icon;\n\t\tlet size = \"xs\";\n\t\tif (typeof icon === \"object\") {\n\t\t\ticon_name = icon.icon;\n\t\t\tsize = icon.size || \"xs\";\n\t\t}\n\t\treturn `${icon ? frappe.utils.icon(icon_name, size) : \"\"} <span class=\"hidden-xs\"> ${__(\n\t\t\tlabel\n\t\t)} </span>`;\n\t}\n\n\tset_action(btn, opts) {\n\t\tlet me = this;\n\t\tif (opts.icon) {\n\t\t\topts.label = this.get_icon_label(opts.icon, opts.label);\n\t\t}\n\n\t\tthis.clear_action_of(btn);\n\n\t\tbtn.removeClass(\"hide\")\n\t\t\t.prop(\"disabled\", false)\n\t\t\t.html(opts.label)\n\t\t\t.on(\"click\", function () {\n\t\t\t\tlet response = opts.click.apply(this, [btn]);\n\t\t\t\tme.btn_disable_enable(btn, response);\n\t\t\t});\n\n\t\tif (opts.working_label) {\n\t\t\tbtn.attr(\"data-working-label\", opts.working_label);\n\t\t}\n\n\t\t// alt shortcuts\n\t\tlet text_span = btn.find(\"span\");\n\t\tfrappe.ui.keys.get_shortcut_group(this).add(btn, text_span.length ? text_span : btn);\n\t}\n\n\tset_primary_action(label, click, icon, working_label) {\n\t\tthis.set_action(this.btn_primary, {\n\t\t\tlabel: label,\n\t\t\tclick: click,\n\t\t\ticon: icon,\n\t\t\tworking_label: working_label,\n\t\t});\n\t\treturn this.btn_primary;\n\t}\n\n\tset_secondary_action(label, click, icon, working_label) {\n\t\tthis.set_action(this.btn_secondary, {\n\t\t\tlabel: label,\n\t\t\tclick: click,\n\t\t\ticon: icon,\n\t\t\tworking_label: working_label,\n\t\t});\n\n\t\treturn this.btn_secondary;\n\t}\n\n\tclear_action_of(btn) {\n\t\tbtn.addClass(\"hide\").unbind(\"click\").removeAttr(\"data-working-label\");\n\t}\n\n\tclear_primary_action() {\n\t\tthis.clear_action_of(this.btn_primary);\n\t}\n\n\tclear_secondary_action() {\n\t\tthis.clear_action_of(this.btn_secondary);\n\t}\n\n\tclear_actions() {\n\t\tthis.clear_primary_action();\n\t\tthis.clear_secondary_action();\n\t}\n\n\tclear_custom_actions() {\n\t\tthis.custom_actions.addClass(\"hide\").empty();\n\t}\n\n\tclear_icons() {\n\t\tthis.icon_group.addClass(\"hide\").empty();\n\t}\n\n\t//--- Menu --//\n\n\tadd_menu_item(label, click, standard, shortcut, show_parent) {\n\t\treturn this.add_dropdown_item({\n\t\t\tlabel,\n\t\t\tclick,\n\t\t\tstandard,\n\t\t\tparent: this.menu,\n\t\t\tshortcut,\n\t\t\tshow_parent,\n\t\t});\n\t}\n\n\tadd_custom_menu_item(parent, label, click, standard, shortcut, icon = null) {\n\t\treturn this.add_dropdown_item({\n\t\t\tlabel,\n\t\t\tclick,\n\t\t\tstandard,\n\t\t\tparent: parent,\n\t\t\tshortcut,\n\t\t\ticon,\n\t\t});\n\t}\n\n\tclear_menu() {\n\t\tthis.clear_btn_group(this.menu);\n\t}\n\n\tshow_menu() {\n\t\tthis.menu_btn_group.removeClass(\"hide\");\n\t}\n\n\thide_menu() {\n\t\tthis.menu_btn_group.addClass(\"hide\");\n\t}\n\n\tshow_icon_group() {\n\t\tthis.icon_group.removeClass(\"hide\");\n\t}\n\n\thide_icon_group() {\n\t\tthis.icon_group.addClass(\"hide\");\n\t}\n\n\t//--- Actions Menu--//\n\n\tshow_actions_menu() {\n\t\tthis.actions_btn_group.removeClass(\"hide\");\n\t}\n\n\thide_actions_menu() {\n\t\tthis.actions_btn_group.addClass(\"hide\");\n\t}\n\n\tadd_action_item(label, click, standard) {\n\t\treturn this.add_dropdown_item({\n\t\t\tlabel,\n\t\t\tclick,\n\t\t\tstandard,\n\t\t\tparent: this.actions,\n\t\t});\n\t}\n\n\tadd_actions_menu_item(label, click, standard, shortcut) {\n\t\treturn this.add_dropdown_item({\n\t\t\tlabel,\n\t\t\tclick,\n\t\t\tstandard,\n\t\t\tshortcut,\n\t\t\tparent: this.actions,\n\t\t\tshow_parent: false,\n\t\t});\n\t}\n\n\tclear_actions_menu() {\n\t\tthis.clear_btn_group(this.actions);\n\t}\n\n\t//-- Generic --//\n\n\t/*\n\t * Add label to given drop down menu. If label, is already contained in the drop\n\t * down menu, it will be ignored.\n\t * @param {string} label - Text for the drop down menu\n\t * @param {function} click - function to be called when `label` is clicked\n\t * @param {Boolean} standard\n\t * @param {object} parent - DOM object representing the parent of the drop down item lists\n\t * @param {string} shortcut - Keyboard shortcut associated with the element\n\t * @param {Boolean} show_parent - Whether to show the dropdown button if dropdown item is added\n\t */\n\tadd_dropdown_item({\n\t\tlabel,\n\t\tclick,\n\t\tstandard,\n\t\tparent,\n\t\tshortcut,\n\t\tshow_parent = true,\n\t\ticon = null,\n\t}) {\n\t\tif (show_parent) {\n\t\t\tparent.parent().removeClass(\"hide hidden-xl\");\n\t\t}\n\n\t\tlet $link = this.is_in_group_button_dropdown(parent, \"li > a.grey-link > span\", label);\n\t\tif ($link) return $link;\n\n\t\tlet $li;\n\t\tlet $icon = ``;\n\n\t\tif (icon) {\n\t\t\t$icon = `<span class=\"menu-item-icon\">${frappe.utils.icon(icon)}</span>`;\n\t\t}\n\n\t\tif (shortcut) {\n\t\t\tlet shortcut_obj = this.prepare_shortcut_obj(shortcut, click, label);\n\t\t\t$li = $(`\n\t\t\t\t<li>\n\t\t\t\t\t<a class=\"grey-link dropdown-item\" href=\"#\" onClick=\"return false;\">\n\t\t\t\t\t\t${$icon}\n\t\t\t\t\t\t<span class=\"menu-item-label\">${label}</span>\n\t\t\t\t\t\t<kbd class=\"pull-right\">\n\t\t\t\t\t\t\t<span>${shortcut_obj.shortcut_label}</span>\n\t\t\t\t\t\t</kbd>\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t`);\n\t\t\tfrappe.ui.keys.add_shortcut(shortcut_obj);\n\t\t} else {\n\t\t\t$li = $(`\n\t\t\t\t<li>\n\t\t\t\t\t<a class=\"grey-link dropdown-item\" href=\"#\" onClick=\"return false;\">\n\t\t\t\t\t\t${$icon}\n\t\t\t\t\t\t<span class=\"menu-item-label\">${label}</span>\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t`);\n\t\t}\n\n\t\t$link = $li.find(\"a\").on(\"click\", (e) => {\n\t\t\tif (e.ctrlKey || e.metaKey) {\n\t\t\t\tfrappe.open_in_new_tab = true;\n\t\t\t}\n\t\t\treturn click();\n\t\t});\n\n\t\tif (standard) {\n\t\t\t$li.appendTo(parent);\n\t\t} else {\n\t\t\tthis.divider = parent.find(\".dropdown-divider\");\n\t\t\tif (!this.divider.length) {\n\t\t\t\tthis.divider = $('<li class=\"dropdown-divider user-action\"></li>').prependTo(\n\t\t\t\t\tparent\n\t\t\t\t);\n\t\t\t}\n\t\t\t$li.addClass(\"user-action\").insertBefore(this.divider);\n\t\t}\n\n\t\t// alt shortcut\n\t\tfrappe.ui.keys\n\t\t\t.get_shortcut_group(parent.get(0))\n\t\t\t.add($link, $link.find(\".menu-item-label\"));\n\n\t\treturn $link;\n\t}\n\n\tprepare_shortcut_obj(shortcut, click, label) {\n\t\tlet shortcut_obj;\n\t\t// convert to object, if shortcut string passed\n\t\tif (typeof shortcut === \"string\") {\n\t\t\tshortcut_obj = { shortcut };\n\t\t} else {\n\t\t\tshortcut_obj = shortcut;\n\t\t}\n\t\t// label\n\t\tif (frappe.utils.is_mac()) {\n\t\t\tshortcut_obj.shortcut_label = shortcut_obj.shortcut.replace(\"Ctrl\", \"\u2318\");\n\t\t} else {\n\t\t\tshortcut_obj.shortcut_label = shortcut_obj.shortcut;\n\t\t}\n\t\t// actual shortcut string\n\t\tshortcut_obj.shortcut = shortcut_obj.shortcut.toLowerCase();\n\t\t// action is button click\n\t\tif (!shortcut_obj.action) {\n\t\t\tshortcut_obj.action = click;\n\t\t}\n\t\t// shortcut description can be button label\n\t\tif (!shortcut_obj.description) {\n\t\t\tshortcut_obj.description = label;\n\t\t}\n\t\t// page\n\t\tshortcut_obj.page = this;\n\t\treturn shortcut_obj;\n\t}\n\n\t/*\n\t * Check if there already exists a button with a specified label in a specified button group\n\t * @param {object} parent - This should be the `ul` of the button group.\n\t * @param {string} selector - CSS Selector of the button to be searched for. By default, it is `li`.\n\t * @param {string} label - Label of the button\n\t */\n\tis_in_group_button_dropdown(parent, selector, label) {\n\t\tif (!selector) selector = \"li\";\n\n\t\tif (!label || !parent) return false;\n\n\t\tconst item_selector = `${selector}[data-label=\"${encodeURIComponent(label)}\"]`;\n\n\t\tconst existing_items = $(parent).find(item_selector);\n\t\treturn existing_items?.length > 0 && existing_items;\n\t}\n\n\tclear_btn_group(parent) {\n\t\tparent.empty();\n\t\tparent.parent().addClass(\"hide\");\n\t}\n\n\tadd_divider() {\n\t\treturn $('<li class=\"dropdown-divider\"></li>').appendTo(this.menu);\n\t}\n\n\tget_or_add_inner_group_button(label) {\n\t\tvar $group = this.inner_toolbar.find(\n\t\t\t`.inner-group-button[data-label=\"${encodeURIComponent(label)}\"]`\n\t\t);\n\t\tif (!$group.length) {\n\t\t\t$group = $(\n\t\t\t\t`<div class=\"inner-group-button\" data-label=\"${encodeURIComponent(label)}\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-default ellipsis\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n\t\t\t\t\t\t${label}\n\t\t\t\t\t\t${frappe.utils.icon(\"select\", \"xs\")}\n\t\t\t\t\t</button>\n\t\t\t\t\t<div role=\"menu\" class=\"dropdown-menu\"></div>\n\t\t\t\t</div>`\n\t\t\t).appendTo(this.inner_toolbar);\n\t\t}\n\t\treturn $group;\n\t}\n\n\tget_inner_group_button(label) {\n\t\treturn this.inner_toolbar.find(\n\t\t\t`.inner-group-button[data-label=\"${encodeURIComponent(label)}\"]`\n\t\t);\n\t}\n\n\tset_inner_btn_group_as_primary(label) {\n\t\tthis.get_or_add_inner_group_button(label)\n\t\t\t.find(\"button\")\n\t\t\t.removeClass(\"btn-default\")\n\t\t\t.addClass(\"btn-primary\");\n\t}\n\n\tbtn_disable_enable(btn, response) {\n\t\tif (response && response.then) {\n\t\t\tbtn.prop(\"disabled\", true);\n\t\t\tresponse.then(() => {\n\t\t\t\tbtn.prop(\"disabled\", false);\n\t\t\t});\n\t\t} else if (response && response.always) {\n\t\t\tbtn.prop(\"disabled\", true);\n\t\t\tresponse.always(() => {\n\t\t\t\tbtn.prop(\"disabled\", false);\n\t\t\t});\n\t\t}\n\t}\n\n\t/*\n\t * Add button to button group. If there exists another button with the same label,\n\t * `add_inner_button` will not add the new button to the button group even if the callback\n\t * function is different.\n\t *\n\t * @param {string} label - Label of the button to be added to the group\n\t * @param {object} action - function to be called when button is clicked\n\t * @param {string} group - Label of the group button\n\t */\n\tadd_inner_button(label, action, group, type = \"default\") {\n\t\tvar me = this;\n\t\tlet _action = function () {\n\t\t\tlet btn = $(this);\n\t\t\tlet response = action();\n\t\t\tme.btn_disable_enable(btn, response);\n\t\t};\n\t\t// Add actions as menu item in Mobile View\n\t\tlet menu_item_label = group ? `${group} > ${label}` : label;\n\t\tlet menu_item = this.add_menu_item(menu_item_label, _action, false, false, false);\n\t\tmenu_item.parent().addClass(\"hidden-xl\");\n\t\tif (this.menu_btn_group.hasClass(\"hide\")) {\n\t\t\tthis.menu_btn_group.removeClass(\"hide\").addClass(\"hidden-xl\");\n\t\t}\n\n\t\tif (group) {\n\t\t\tvar $group = this.get_or_add_inner_group_button(group);\n\t\t\t$(this.inner_toolbar).removeClass(\"hide\");\n\n\t\t\tif (!this.is_in_group_button_dropdown($group.find(\".dropdown-menu\"), \"a\", label)) {\n\t\t\t\treturn $(\n\t\t\t\t\t`<a class=\"dropdown-item\" href=\"#\" onclick=\"return false;\" data-label=\"${encodeURIComponent(\n\t\t\t\t\t\tlabel\n\t\t\t\t\t)}\">${label}</a>`\n\t\t\t\t)\n\t\t\t\t\t.on(\"click\", _action)\n\t\t\t\t\t.appendTo($group.find(\".dropdown-menu\"));\n\t\t\t}\n\t\t} else {\n\t\t\tlet button = this.inner_toolbar.find(\n\t\t\t\t`button[data-label=\"${encodeURIComponent(label)}\"]`\n\t\t\t);\n\t\t\tif (button.length == 0) {\n\t\t\t\tbutton = $(`<button data-label=\"${encodeURIComponent(\n\t\t\t\t\tlabel\n\t\t\t\t)}\" class=\"btn btn-${type} ellipsis\">\n\t\t\t\t\t${__(label)}\n\t\t\t\t</button>`);\n\t\t\t\tbutton.on(\"click\", _action);\n\t\t\t\tbutton.appendTo(this.inner_toolbar.removeClass(\"hide\"));\n\t\t\t}\n\t\t\treturn button;\n\t\t}\n\t}\n\n\tremove_inner_button(label, group) {\n\t\tif (typeof label === \"string\") {\n\t\t\tlabel = [label];\n\t\t}\n\t\t// translate\n\t\tlabel = label.map((l) => __(l));\n\n\t\tif (group) {\n\t\t\tvar $group = this.get_inner_group_button(__(group));\n\t\t\tif ($group.length) {\n\t\t\t\t$group.find(`.dropdown-item[data-label=\"${encodeURIComponent(label)}\"]`).remove();\n\t\t\t}\n\t\t\tif ($group.find(\".dropdown-item\").length === 0) $group.remove();\n\t\t} else {\n\t\t\tthis.inner_toolbar.find(`button[data-label=\"${encodeURIComponent(label)}\"]`).remove();\n\t\t}\n\t}\n\n\tchange_inner_button_type(label, group, type) {\n\t\tlet btn;\n\n\t\tif (group) {\n\t\t\tvar $group = this.get_inner_group_button(__(group));\n\t\t\tif ($group.length) {\n\t\t\t\tbtn = $group.find(`.dropdown-item[data-label=\"${encodeURIComponent(label)}\"]`);\n\t\t\t}\n\t\t} else {\n\t\t\tbtn = this.inner_toolbar.find(`button[data-label=\"${encodeURIComponent(label)}\"]`);\n\t\t}\n\n\t\tif (btn) {\n\t\t\tbtn.removeClass().addClass(`btn btn-${type} ellipsis`);\n\t\t}\n\t}\n\n\tadd_inner_message(message) {\n\t\tlet $message = $(`<span class='inner-page-message text-muted small'>${message}</div>`);\n\t\tthis.inner_toolbar.find(\".inner-page-message\").remove();\n\t\tthis.inner_toolbar.removeClass(\"hide\").prepend($message);\n\n\t\treturn $message;\n\t}\n\n\tclear_inner_toolbar() {\n\t\tthis.inner_toolbar.empty().addClass(\"hide\");\n\t}\n\n\t//-- Sidebar --//\n\n\tadd_sidebar_item(label, action, insert_after, prepend) {\n\t\tvar parent = this.sidebar.find(\".sidebar-menu.standard-actions\");\n\t\tvar li = $(\"<li>\");\n\t\tvar link = $(\"<a>\").html(label).on(\"click\", action).appendTo(li);\n\n\t\tif (insert_after) {\n\t\t\tli.insertAfter(parent.find(insert_after));\n\t\t} else {\n\t\t\tif (prepend) {\n\t\t\t\tli.prependTo(parent);\n\t\t\t} else {\n\t\t\t\tli.appendTo(parent);\n\t\t\t}\n\t\t}\n\t\treturn link;\n\t}\n\n\t//---//\n\n\tclear_user_actions() {\n\t\tthis.menu.find(\".user-action\").remove();\n\t}\n\n\t// page::title\n\tget_title_area() {\n\t\treturn this.$title_area;\n\t}\n\n\tset_title(title, icon = null, strip = true, tab_title = \"\") {\n\t\tif (!title) title = \"\";\n\t\tif (strip) {\n\t\t\ttitle = strip_html(title);\n\t\t}\n\t\tthis.title = title;\n\t\tfrappe.utils.set_title(tab_title || title);\n\t\tif (icon) {\n\t\t\ttitle = `${frappe.utils.icon(icon)} ${title}`;\n\t\t}\n\t\tlet title_wrapper = this.$title_area.find(\".title-text\");\n\t\ttitle_wrapper.html(title);\n\t\ttitle_wrapper.attr(\"title\", this.title);\n\t}\n\n\tset_title_sub(txt) {\n\t\t// strip icon\n\t\tthis.$sub_title_area.html(txt).toggleClass(\"hide\", !!!txt);\n\t}\n\n\tget_main_icon(icon) {\n\t\treturn this.$title_area\n\t\t\t.find(\".title-icon\")\n\t\t\t.html('<i class=\"' + icon + ' fa-fw\"></i> ')\n\t\t\t.toggle(true);\n\t}\n\n\tadd_help_button(txt) {\n\t\t//\n\t}\n\n\tadd_button(label, click, opts) {\n\t\tif (!opts) opts = {};\n\t\tlet button = $(`<button\n\t\t\tclass=\"btn ${opts.btn_class || \"btn-default\"} ${opts.btn_size || \"btn-sm\"} ellipsis\">\n\t\t\t\t${opts.icon ? frappe.utils.icon(opts.icon) : \"\"}\n\t\t\t\t${label}\n\t\t</button>`);\n\t\t// Add actions as menu item in Mobile View (similar to \"add_custom_button\" in forms.js)\n\t\tlet menu_item = this.add_menu_item(label, click, false);\n\t\tmenu_item.parent().addClass(\"hidden-xl\");\n\n\t\tbutton.appendTo(this.custom_actions);\n\t\tbutton.on(\"click\", click);\n\t\tthis.custom_actions.removeClass(\"hide\");\n\n\t\treturn button;\n\t}\n\n\tadd_custom_button_group(label, icon, parent) {\n\t\tlet dropdown_label = `<span class=\"hidden-xs\">\n\t\t\t<span class=\"custom-btn-group-label\">${__(label)}</span>\n\t\t\t${frappe.utils.icon(\"select\", \"xs\")}\n\t\t</span>`;\n\n\t\tif (icon) {\n\t\t\tdropdown_label = `<span class=\"hidden-xs\">\n\t\t\t\t${frappe.utils.icon(icon)}\n\t\t\t\t<span class=\"custom-btn-group-label\">${__(label)}</span>\n\t\t\t\t${frappe.utils.icon(\"select\", \"xs\")}\n\t\t\t</span>\n\t\t\t<span class=\"visible-xs\">\n\t\t\t\t${frappe.utils.icon(icon)}\n\t\t\t</span>`;\n\t\t}\n\n\t\tlet custom_btn_group = $(`\n\t\t\t<div class=\"custom-btn-group\">\n\t\t\t\t<button type=\"button\" class=\"btn btn-default btn-sm ellipsis\" data-toggle=\"dropdown\" aria-expanded=\"false\">\n\t\t\t\t\t${dropdown_label}\n\t\t\t\t</button>\n\t\t\t\t<ul class=\"dropdown-menu\" role=\"menu\"></ul>\n\t\t\t</div>\n\t\t`);\n\n\t\tif (!parent) parent = this.custom_actions;\n\t\tparent.removeClass(\"hide\").append(custom_btn_group);\n\n\t\treturn custom_btn_group.find(\".dropdown-menu\");\n\t}\n\n\tadd_dropdown_button(parent, label, click, icon) {\n\t\tfrappe.ui.toolbar.add_dropdown_button(parent, label, click, icon);\n\t}\n\n\t// page::form\n\tadd_label(label) {\n\t\tthis.show_form();\n\t\treturn $(\"<label class='col-md-1 page-only-label'>\" + label + \" </label>\").appendTo(\n\t\t\tthis.page_form\n\t\t);\n\t}\n\tadd_select(label, options) {\n\t\tvar field = this.add_field({ label: label, fieldtype: \"Select\" });\n\t\treturn field.$wrapper.find(\"select\").empty().add_options(options);\n\t}\n\tadd_data(label) {\n\t\tvar field = this.add_field({ label: label, fieldtype: \"Data\" });\n\t\treturn field.$wrapper.find(\"input\").attr(\"placeholder\", label);\n\t}\n\tadd_date(label, date) {\n\t\tvar field = this.add_field({ label: label, fieldtype: \"Date\", default: date });\n\t\treturn field.$wrapper.find(\"input\").attr(\"placeholder\", label);\n\t}\n\tadd_check(label) {\n\t\treturn $(\"<div class='checkbox'><label><input type='checkbox'>\" + label + \"</label></div>\")\n\t\t\t.appendTo(this.page_form)\n\t\t\t.find(\"input\");\n\t}\n\tadd_break() {\n\t\t// add further fields in the next line\n\t\tthis.page_form.append('<div class=\"clearfix invisible-xs\"></div>');\n\t}\n\tadd_field(df, parent) {\n\t\tthis.show_form();\n\n\t\tif (!df.placeholder) {\n\t\t\tdf.placeholder = df.label;\n\t\t}\n\n\t\tdf.input_class = \"input-xs\";\n\n\t\tvar f = frappe.ui.form.make_control({\n\t\t\tdf: df,\n\t\t\tparent: parent || this.page_form,\n\t\t\tonly_input: df.fieldtype == \"Check\" ? false : true,\n\t\t});\n\t\tf.refresh();\n\t\t$(f.wrapper)\n\t\t\t.addClass(\"col-md-2\")\n\t\t\t.attr(\"title\", __(df.label))\n\t\t\t.tooltip({\n\t\t\t\tdelay: { show: 600, hide: 100 },\n\t\t\t\ttrigger: \"hover\",\n\t\t\t});\n\n\t\t// html fields in toolbar are only for display\n\t\tif (df.fieldtype == \"HTML\") {\n\t\t\treturn;\n\t\t}\n\n\t\t// hidden fields dont have $input\n\t\tif (!f.$input) f.make_input();\n\n\t\tf.$input.attr(\"placeholder\", __(df.label));\n\n\t\tif (df.fieldtype === \"Check\") {\n\t\t\t$(f.wrapper).find(\":first-child\").removeClass(\"col-md-offset-4 col-md-8\");\n\t\t}\n\n\t\tif (df.fieldtype == \"Button\") {\n\t\t\t$(f.wrapper).find(\".page-control-label\").html(\"&nbsp;\");\n\t\t\tf.$input.addClass(\"btn-xs\").css({ width: \"100%\", \"margin-top\": \"-1px\" });\n\t\t}\n\n\t\tif (df[\"default\"]) f.set_input(df[\"default\"]);\n\t\tthis.fields_dict[df.fieldname || df.label] = f;\n\t\treturn f;\n\t}\n\tclear_fields() {\n\t\tthis.page_form.empty();\n\t}\n\tshow_form() {\n\t\tthis.page_form.removeClass(\"hide\");\n\t}\n\thide_form() {\n\t\tthis.page_form.addClass(\"hide\");\n\t}\n\tget_form_values() {\n\t\tvar values = {};\n\t\tfor (let fieldname in this.fields_dict) {\n\t\t\tlet field = this.fields_dict[fieldname];\n\t\t\tvalues[fieldname] = field.get_value();\n\t\t}\n\t\treturn values;\n\t}\n\tadd_view(name, html) {\n\t\tlet element = html;\n\t\tif (typeof html === \"string\") {\n\t\t\telement = $(html);\n\t\t}\n\t\tthis.views[name] = element.appendTo($(this.wrapper).find(\".page-content\"));\n\t\tif (!this.current_view) {\n\t\t\tthis.current_view = this.views[name];\n\t\t} else {\n\t\t\tthis.views[name].toggle(false);\n\t\t}\n\t\treturn this.views[name];\n\t}\n\tset_view(name) {\n\t\tif (this.current_view_name === name) return;\n\t\tthis.current_view && this.current_view.toggle(false);\n\t\tthis.current_view = this.views[name];\n\n\t\tthis.previous_view_name = this.current_view_name;\n\t\tthis.current_view_name = name;\n\n\t\tthis.views[name].toggle(true);\n\n\t\tthis.wrapper.trigger(\"view-change\");\n\t}\n};\n", "frappe.provide(\"frappe.ui.form\");\n\nfrappe.quick_edit = function (doctype, name) {\n\tfrappe.db.get_doc(doctype, name).then((doc) => {\n\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, doc);\n\t});\n};\n\nfrappe.ui.form.make_quick_entry = (doctype, after_insert, init_callback, doc, force) => {\n\tvar trimmed_doctype = doctype.replace(/ /g, \"\");\n\tvar controller_name = \"QuickEntryForm\";\n\n\tif (frappe.ui.form[trimmed_doctype + \"QuickEntryForm\"]) {\n\t\tcontroller_name = trimmed_doctype + \"QuickEntryForm\";\n\t}\n\n\tfrappe.quick_entry = new frappe.ui.form[controller_name](\n\t\tdoctype,\n\t\tafter_insert,\n\t\tinit_callback,\n\t\tdoc,\n\t\tforce\n\t);\n\treturn frappe.quick_entry.setup();\n};\n\nfrappe.ui.form.QuickEntryForm = class QuickEntryForm {\n\tconstructor(doctype, after_insert, init_callback, doc, force) {\n\t\tthis.doctype = doctype;\n\t\tthis.after_insert = after_insert;\n\t\tthis.init_callback = init_callback;\n\t\tthis.doc = doc;\n\t\tthis.force = force ? force : false;\n\t}\n\n\tsetup() {\n\t\treturn new Promise((resolve) => {\n\t\t\tfrappe.model.with_doctype(this.doctype, () => {\n\t\t\t\tthis.check_quick_entry_doc();\n\t\t\t\tthis.set_meta_and_mandatory_fields();\n\t\t\t\tif (this.is_quick_entry() || this.force) {\n\t\t\t\t\tthis.render_dialog();\n\t\t\t\t\tresolve(this);\n\t\t\t\t} else {\n\t\t\t\t\t// no quick entry, open full form\n\t\t\t\t\tfrappe.quick_entry = null;\n\t\t\t\t\tfrappe\n\t\t\t\t\t\t.set_route(\"Form\", this.doctype, this.doc.name)\n\t\t\t\t\t\t.then(() => resolve(this));\n\t\t\t\t\t// call init_callback for consistency\n\t\t\t\t\tif (this.init_callback) {\n\t\t\t\t\t\tthis.init_callback(this.doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tset_meta_and_mandatory_fields() {\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tlet fields = this.meta.fields;\n\n\t\t// prepare a list of mandatory, bold and allow in quick entry fields\n\t\tthis.mandatory = fields.filter((df) => {\n\t\t\treturn (\n\t\t\t\t(df.reqd || df.bold || df.allow_in_quick_entry) && !df.read_only && !df.is_virtual\n\t\t\t);\n\t\t});\n\t}\n\n\tcheck_quick_entry_doc() {\n\t\tif (!this.doc) {\n\t\t\tthis.doc = frappe.model.get_new_doc(this.doctype, null, null, true);\n\t\t}\n\t}\n\n\tis_quick_entry() {\n\t\tif (this.meta.quick_entry != 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.validate_for_prompt_autoname();\n\n\t\tif (this.has_child_table() || !this.mandatory.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\ttoo_many_mandatory_fields() {\n\t\tif (this.mandatory.length > 7) {\n\t\t\t// too many fields, show form\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\thas_child_table() {\n\t\tif (\n\t\t\t$.map(this.mandatory, function (d) {\n\t\t\t\treturn d.fieldtype === \"Table\" ? d : null;\n\t\t\t}).length\n\t\t) {\n\t\t\t// has mandatory table, quit!\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvalidate_for_prompt_autoname() {\n\t\tif (this.meta.autoname && this.meta.autoname.toLowerCase() === \"prompt\") {\n\t\t\tthis.mandatory = [\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"__newname\",\n\t\t\t\t\tlabel: __(\"{0} Name\", [__(this.meta.name)]),\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t},\n\t\t\t].concat(this.mandatory);\n\t\t}\n\t}\n\n\trender_dialog() {\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [__(this.doctype)]),\n\t\t\tfields: this.mandatory,\n\t\t\tdoc: this.doc,\n\t\t});\n\n\t\tthis.register_primary_action();\n\t\t!this.force && this.render_edit_in_full_page_link();\n\t\t// ctrl+enter to save\n\t\tthis.dialog.wrapper.keydown(function (e) {\n\t\t\tif ((e.ctrlKey || e.metaKey) && e.which == 13) {\n\t\t\t\tif (!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tme.dialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.dialog.onhide = () => (frappe.quick_entry = null);\n\t\tthis.dialog.show();\n\n\t\tthis.dialog.refresh_dependency();\n\t\tthis.set_defaults();\n\n\t\tif (this.init_callback) {\n\t\t\tthis.init_callback(this.dialog);\n\t\t}\n\t}\n\n\tregister_primary_action() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__(\"Save\"), function () {\n\t\t\tif (me.dialog.working) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar data = me.dialog.get_values();\n\n\t\t\tif (data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tme.dialog.set_message(__(\"Saving...\"));\n\t\t\t\tme.insert().then(() => {\n\t\t\t\t\tme.dialog.clear_message();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tinsert() {\n\t\tlet me = this;\n\t\treturn new Promise((resolve) => {\n\t\t\tme.update_doc();\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.save\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.dialog.doc,\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (frappe.model.is_submittable(me.doctype)) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => (me.dialog.working = true),\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tme.dialog.set_primary_action(__(\"Submit\"), function () {\n\t\t\t\t\t\t\t\t\tme.submit(r.message);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t// delete the old doc\n\t\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function () {\n\t\t\t\t\tif (!me.skip_redirect_on_error) {\n\t\t\t\t\t\tme.open_doc(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\talways: function () {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tsubmit(doc) {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.submit\",\n\t\t\targs: {\n\t\t\t\tdoc: doc,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tme.dialog.hide();\n\t\t\t\t// delete the old doc\n\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t} else {\n\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcur_frm && cur_frm.reload_doc();\n\t\t\t},\n\t\t});\n\t}\n\n\topen_form_if_not_list() {\n\t\tlet route = frappe.get_route();\n\t\tlet doc = this.dialog.doc;\n\t\tif (route && !(route[0] === \"List\" && route[1] === doc.doctype)) {\n\t\t\tfrappe.run_serially([() => frappe.set_route(\"Form\", doc.doctype, doc.name)]);\n\t\t}\n\t}\n\n\tupdate_doc() {\n\t\tvar me = this;\n\t\tvar data = this.dialog.get_values(true);\n\t\t$.each(data, function (key, value) {\n\t\t\tif (!is_null(value)) {\n\t\t\t\tme.dialog.doc[key] = value;\n\t\t\t}\n\t\t});\n\t\treturn this.dialog.doc;\n\t}\n\n\topen_doc(set_hooks) {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (set_hooks && this.after_insert) {\n\t\t\tfrappe.route_options = frappe.route_options || {};\n\t\t\tfrappe.route_options.after_save = (frm) => {\n\t\t\t\tthis.after_insert(frm);\n\t\t\t};\n\t\t}\n\t\tfrappe.set_route(\"Form\", this.doctype, this.doc.name);\n\t}\n\n\trender_edit_in_full_page_link() {\n\t\tvar me = this;\n\t\tthis.dialog.add_custom_action(__(\"Edit Full Form\"), () => me.open_doc(true));\n\t}\n\n\tset_defaults() {\n\t\tvar me = this;\n\t\t// set defaults\n\t\t$.each(this.dialog.fields_dict, function (fieldname, field) {\n\t\t\tfield.doctype = me.doc.doctype;\n\t\t\tfield.docname = me.doc.name;\n\n\t\t\tif (!is_null(me.doc[fieldname])) {\n\t\t\t\tfield.set_input(me.doc[fieldname]);\n\t\t\t}\n\t\t});\n\t}\n};\n", "// Copyright (c) 2022, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See LICENSE\n\nfrappe.ui.form.LinkedWith = class LinkedWith {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tshow() {\n\t\tif (!this.dialog) this.make_dialog();\n\n\t\t$(this.dialog.body).html(\n\t\t\t`<div class=\"text-muted text-center\" style=\"padding: 30px 0px\">\n\t\t\t\t${__(\"Loading\")}...\n\t\t\t</div>`\n\t\t);\n\n\t\tthis.dialog.show();\n\t}\n\n\tmake_dialog() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Linked With\"),\n\t\t});\n\n\t\tthis.dialog.on_page_show = () => {\n\t\t\tfrappe\n\t\t\t\t.xcall(\"frappe.desk.form.linked_with.get\", {\n\t\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\t\tdocname: this.frm.docname,\n\t\t\t\t})\n\t\t\t\t.then((r) => {\n\t\t\t\t\tthis.frm.__linked_docs = r;\n\t\t\t\t})\n\t\t\t\t.then(() => this.make_html());\n\t\t};\n\t}\n\n\tmake_html() {\n\t\tlet html = \"\";\n\t\tconst linked_docs = this.frm.__linked_docs;\n\t\tconst linked_doctypes = Object.keys(linked_docs);\n\n\t\tif (linked_doctypes.length === 0) {\n\t\t\thtml = __(\"Not Linked to any record\");\n\t\t} else {\n\t\t\thtml = linked_doctypes\n\t\t\t\t.map((doctype) => {\n\t\t\t\t\tconst docs = linked_docs[doctype];\n\t\t\t\t\treturn `\n\t\t\t\t\t<div class=\"list-item-table margin-bottom\">\n\t\t\t\t\t\t${this.make_doc_head(doctype)}\n\t\t\t\t\t\t${docs.map((doc) => this.make_doc_row(doc, doctype)).join(\"\")}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\t})\n\t\t\t\t.join(\"\");\n\t\t}\n\n\t\t$(this.dialog.body).html(html);\n\t}\n\n\tmake_doc_head(heading) {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div>${__(heading)}</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tmake_doc_row(doc, doctype) {\n\t\treturn `<div class=\"list-row-container\">\n\t\t\t<div class=\"level list-row small\">\n\t\t\t\t<div class=\"level-left bold\">\n\t\t\t\t\t<a href=\"/app/${frappe.router.slug(doctype)}/${doc.name}\">${doc.name}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n};\n", "frappe.ui.form.FormViewers = class FormViewers {\n\tconstructor({ frm, parent }) {\n\t\tthis.frm = frm;\n\t\tthis.parent = parent;\n\t\tthis.parent.tooltip({ title: __(\"Currently Viewing\") });\n\t}\n\n\trefresh() {\n\t\tlet users = this.frm.get_docinfo()[\"viewers\"];\n\t\tif (!users || !users.current || !users.current.length) {\n\t\t\tthis.parent.empty();\n\t\t\treturn;\n\t\t}\n\n\t\tlet currently_viewing = users.current.filter((user) => user != frappe.session.user);\n\t\tlet avatar_group = frappe.avatar_group(currently_viewing, 5, {\n\t\t\talign: \"left\",\n\t\t\toverlap: true,\n\t\t});\n\t\tthis.parent.empty().append(avatar_group);\n\t}\n};\n\nfrappe.ui.form.FormViewers.set_users = function (data, type) {\n\tconst doctype = data.doctype;\n\tconst docname = data.docname;\n\tconst docinfo = frappe.model.get_docinfo(doctype, docname);\n\n\tconst past_users = ((docinfo && docinfo[type]) || {}).past || [];\n\tconst users = data.users || [];\n\tconst new_users = users.filter((user) => !past_users.includes(user));\n\n\tif (new_users.length === 0) return;\n\n\tconst set_and_refresh = () => {\n\t\tconst info = {\n\t\t\tpast: past_users.concat(new_users),\n\t\t\tnew: new_users,\n\t\t\tcurrent: users,\n\t\t};\n\n\t\tfrappe.model.set_docinfo(doctype, docname, type, info);\n\n\t\tif (\n\t\t\tcur_frm &&\n\t\t\tcur_frm.doc &&\n\t\t\tcur_frm.doc.doctype === doctype &&\n\t\t\tcur_frm.doc.name == docname &&\n\t\t\tcur_frm.viewers\n\t\t) {\n\t\t\tcur_frm.viewers.refresh(true, type);\n\t\t}\n\t};\n\n\tlet unknown_users = [];\n\tfor (let user of users) {\n\t\tif (!frappe.boot.user_info[user]) unknown_users.push(user);\n\t}\n\n\tif (unknown_users.length === 0) {\n\t\tset_and_refresh();\n\t} else {\n\t\t// load additional user info\n\t\tfrappe\n\t\t\t.xcall(\"frappe.desk.form.load.get_user_info_for_viewers\", { users: unknown_users })\n\t\t\t.then((data) => {\n\t\t\t\tObject.assign(frappe.boot.user_info, data);\n\t\t\t\tset_and_refresh();\n\t\t\t});\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport \"./linked_with\";\nimport \"./form_viewers\";\n\nfrappe.ui.form.Toolbar = class Toolbar {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.refresh();\n\t\tthis.add_update_button_on_dirty();\n\t\tthis.setup_editable_title();\n\t}\n\trefresh() {\n\t\tthis.make_menu();\n\t\tthis.make_viewers();\n\t\tthis.set_title();\n\t\tthis.page.clear_user_actions();\n\t\tthis.show_title_as_dirty();\n\t\tthis.set_primary_action();\n\n\t\tif (this.frm.meta.hide_toolbar) {\n\t\t\tthis.page.hide_menu();\n\t\t} else {\n\t\t\tif (this.frm.doc.__islocal) {\n\t\t\t\tthis.page.hide_menu();\n\t\t\t\tthis.print_icon && this.print_icon.addClass(\"hide\");\n\t\t\t} else {\n\t\t\t\tthis.page.show_menu();\n\t\t\t\tthis.print_icon && this.print_icon.removeClass(\"hide\");\n\t\t\t}\n\t\t}\n\t}\n\tset_title() {\n\t\tif (this.frm.is_new()) {\n\t\t\tvar title = __(\"New {0}\", [__(this.frm.meta.name)]);\n\t\t} else if (this.frm.meta.title_field) {\n\t\t\tlet title_field = (this.frm.doc[this.frm.meta.title_field] || \"\").toString().trim();\n\t\t\tvar title = strip_html(title_field || this.frm.docname);\n\t\t\tif (\n\t\t\t\tthis.frm.doc.__islocal ||\n\t\t\t\ttitle === this.frm.docname ||\n\t\t\t\tthis.frm.meta.autoname === \"hash\"\n\t\t\t) {\n\t\t\t\tthis.page.set_title_sub(\"\");\n\t\t\t} else {\n\t\t\t\tthis.page.set_title_sub(this.frm.docname);\n\t\t\t\tthis.page.$sub_title_area.css(\"cursor\", \"copy\");\n\t\t\t\tthis.page.$sub_title_area.on(\"click\", (event) => {\n\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t\tfrappe.utils.copy_to_clipboard(this.frm.docname);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tvar title = this.frm.docname;\n\t\t}\n\n\t\tvar me = this;\n\t\ttitle = __(title);\n\t\tthis.page.set_title(title);\n\t\tif (this.frm.meta.title_field) {\n\t\t\tfrappe.utils.set_title(title + \" - \" + this.frm.docname);\n\t\t}\n\t\tthis.page.$title_area.toggleClass(\n\t\t\t\"editable-title\",\n\t\t\t!!(this.is_title_editable() || this.can_rename())\n\t\t);\n\n\t\tthis.set_indicator();\n\t}\n\tis_title_editable() {\n\t\tlet title_field = this.frm.meta.title_field;\n\t\tlet doc_field = this.frm.get_docfield(title_field);\n\n\t\tif (\n\t\t\ttitle_field &&\n\t\t\tthis.frm.perm[0].write &&\n\t\t\t!this.frm.doc.__islocal &&\n\t\t\tdoc_field.fieldtype === \"Data\" &&\n\t\t\t!doc_field.read_only\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tcan_rename() {\n\t\treturn this.frm.perm[0].write && this.frm.meta.allow_rename && !this.frm.doc.__islocal;\n\t}\n\tshow_unchanged_document_alert() {\n\t\tfrappe.show_alert({\n\t\t\tindicator: \"info\",\n\t\t\tmessage: __(\"Unchanged\"),\n\t\t});\n\t}\n\trename_document_title(input_name, input_title, merge = false) {\n\t\tlet confirm_message = null;\n\t\tconst docname = this.frm.doc.name;\n\t\tconst title_field = this.frm.meta.title_field || \"\";\n\t\tconst doctype = this.frm.doctype;\n\t\tlet queue;\n\t\tif (this.frm.__rename_queue) {\n\t\t\tqueue = this.frm.__rename_queue;\n\t\t}\n\n\t\tif (input_name) {\n\t\t\tconst warning = __(\"This cannot be undone\");\n\t\t\tconst message = __(\"Are you sure you want to merge {0} with {1}?\", [\n\t\t\t\tdocname.bold(),\n\t\t\t\tinput_name.bold(),\n\t\t\t]);\n\t\t\tconfirm_message = `${message}<br><b>${warning}<b>`;\n\t\t}\n\n\t\tlet rename_document = () => {\n\t\t\treturn frappe\n\t\t\t\t.xcall(\"frappe.model.rename_doc.update_document_title\", {\n\t\t\t\t\tdoctype,\n\t\t\t\t\tdocname,\n\t\t\t\t\tname: input_name,\n\t\t\t\t\ttitle: input_title,\n\t\t\t\t\tenqueue: true,\n\t\t\t\t\tmerge,\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tfreeze_message: __(\"Updating related fields...\"),\n\t\t\t\t\tqueue,\n\t\t\t\t})\n\t\t\t\t.then((new_docname) => {\n\t\t\t\t\tconst reload_form = (input_name) => {\n\t\t\t\t\t\t$(document).trigger(\"rename\", [doctype, docname, input_name]);\n\t\t\t\t\t\tif (locals[doctype] && locals[doctype][docname])\n\t\t\t\t\t\t\tdelete locals[doctype][docname];\n\t\t\t\t\t\tthis.frm.reload_doc();\n\t\t\t\t\t};\n\n\t\t\t\t\t// handle document renaming queued action\n\t\t\t\t\tif (input_name && new_docname == docname) {\n\t\t\t\t\t\tfrappe.socketio.doc_subscribe(doctype, input_name);\n\t\t\t\t\t\tfrappe.realtime.on(\"doc_update\", (data) => {\n\t\t\t\t\t\t\tif (data.doctype == doctype && data.name == input_name) {\n\t\t\t\t\t\t\t\treload_form(input_name);\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: __(\"Document renamed from {0} to {1}\", [\n\t\t\t\t\t\t\t\t\t\tdocname.bold(),\n\t\t\t\t\t\t\t\t\t\tinput_name.bold(),\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\tindicator: \"success\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t\t__(\"Document renaming from {0} to {1} has been queued\", [\n\t\t\t\t\t\t\t\tdocname.bold(),\n\t\t\t\t\t\t\t\tinput_name.bold(),\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// handle document sync rename action\n\t\t\t\t\tif (input_name && (new_docname || input_name) != docname) {\n\t\t\t\t\t\treload_form(new_docname || input_name);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (input_title === this.frm.doc[title_field] && input_name === docname) {\n\t\t\t\tthis.show_unchanged_document_alert();\n\t\t\t\tresolve();\n\t\t\t} else if (merge) {\n\t\t\t\tfrappe.confirm(\n\t\t\t\t\tconfirm_message,\n\t\t\t\t\t() => {\n\t\t\t\t\t\trename_document().then(resolve).catch(reject);\n\t\t\t\t\t},\n\t\t\t\t\treject\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\trename_document().then(resolve).catch(reject);\n\t\t\t}\n\t\t});\n\t}\n\tsetup_editable_title() {\n\t\tlet me = this;\n\n\t\tthis.page.$title_area.find(\".title-text\").on(\"click\", () => {\n\t\t\tlet fields = [];\n\t\t\tlet docname = me.frm.doc.name;\n\t\t\tlet title_field = me.frm.meta.title_field || \"\";\n\n\t\t\t// check if title is updatable\n\t\t\tif (me.is_title_editable()) {\n\t\t\t\tlet title_field_label = me.frm.get_docfield(title_field).label;\n\n\t\t\t\tfields.push({\n\t\t\t\t\tlabel: __(\"New {0}\", [__(title_field_label)]),\n\t\t\t\t\tfieldname: \"title\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdefault: me.frm.doc[title_field],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// check if docname is updatable\n\t\t\tif (me.can_rename()) {\n\t\t\t\tlet label = __(\"New Name\");\n\t\t\t\tif (me.frm.meta.autoname && me.frm.meta.autoname.startsWith(\"field:\")) {\n\t\t\t\t\tlet fieldname = me.frm.meta.autoname.split(\":\")[1];\n\t\t\t\t\tlabel = __(\"New {0}\", [me.frm.get_docfield(fieldname).label]);\n\t\t\t\t}\n\n\t\t\t\tfields.push(\n\t\t\t\t\t...[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: label,\n\t\t\t\t\t\t\tfieldname: \"name\",\n\t\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\t\tdefault: docname,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __(\"Merge with existing\"),\n\t\t\t\t\t\t\tfieldname: \"merge\",\n\t\t\t\t\t\t\tfieldtype: \"Check\",\n\t\t\t\t\t\t\tdefault: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t]\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// create dialog\n\t\t\tif (fields.length > 0) {\n\t\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __(\"Rename\"),\n\t\t\t\t\tfields: fields,\n\t\t\t\t});\n\t\t\t\td.show();\n\t\t\t\td.set_primary_action(__(\"Rename\"), (values) => {\n\t\t\t\t\td.disable_primary_action();\n\t\t\t\t\td.hide();\n\t\t\t\t\tthis.rename_document_title(values.name, values.title, values.merge)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\td.enable_primary_action();\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tget_dropdown_menu(label) {\n\t\treturn this.page.add_dropdown(label);\n\t}\n\tset_indicator() {\n\t\tvar indicator = frappe.get_indicator(this.frm.doc);\n\t\tif (\n\t\t\tthis.frm.save_disabled &&\n\t\t\tindicator &&\n\t\t\t[__(\"Saved\"), __(\"Not Saved\")].includes(indicator[0])\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tif (indicator) {\n\t\t\tthis.page.set_indicator(indicator[0], indicator[1]);\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t}\n\tmake_menu() {\n\t\tthis.page.clear_icons();\n\t\tthis.page.clear_menu();\n\n\t\tif (frappe.boot.desk_settings.form_sidebar) {\n\t\t\tthis.make_navigation();\n\t\t\tthis.make_menu_items();\n\t\t}\n\t}\n\n\tmake_viewers() {\n\t\tif (this.frm.viewers) {\n\t\t\treturn;\n\t\t}\n\t\tthis.frm.viewers = new frappe.ui.form.FormViewers({\n\t\t\tfrm: this.frm,\n\t\t\tparent: $('<div class=\"form-viewers d-flex\"></div>').prependTo(\n\t\t\t\tthis.frm.page.page_actions\n\t\t\t),\n\t\t});\n\t}\n\n\tmake_navigation() {\n\t\t// Navigate\n\t\tif (!this.frm.is_new() && !this.frm.meta.issingle) {\n\t\t\tthis.page.add_action_icon(\n\t\t\t\t\"left\",\n\t\t\t\t() => {\n\t\t\t\t\tthis.frm.navigate_records(1);\n\t\t\t\t},\n\t\t\t\t\"prev-doc\",\n\t\t\t\t__(\"Previous Document\")\n\t\t\t);\n\t\t\tthis.page.add_action_icon(\n\t\t\t\t\"right\",\n\t\t\t\t() => {\n\t\t\t\t\tthis.frm.navigate_records(0);\n\t\t\t\t},\n\t\t\t\t\"next-doc\",\n\t\t\t\t__(\"Next Document\")\n\t\t\t);\n\t\t}\n\t}\n\n\tmake_menu_items() {\n\t\t// Print\n\t\tconst me = this;\n\t\tconst p = this.frm.perm[0];\n\t\tconst docstatus = cint(this.frm.doc.docstatus);\n\t\tconst is_submittable = frappe.model.is_submittable(this.frm.doc.doctype);\n\n\t\tconst print_settings = frappe.model.get_doc(\":Print Settings\", \"Print Settings\");\n\t\tconst allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tconst allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\tif (\n\t\t\t!is_submittable ||\n\t\t\tdocstatus == 1 ||\n\t\t\t(allow_print_for_cancelled && docstatus == 2) ||\n\t\t\t(allow_print_for_draft && docstatus == 0)\n\t\t) {\n\t\t\tif (frappe.model.can_print(null, me.frm) && !this.frm.meta.issingle) {\n\t\t\t\tthis.page.add_menu_item(\n\t\t\t\t\t__(\"Print\"),\n\t\t\t\t\tfunction () {\n\t\t\t\t\t\tme.frm.print_doc();\n\t\t\t\t\t},\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t\tthis.print_icon = this.page.add_action_icon(\n\t\t\t\t\t\"printer\",\n\t\t\t\t\tfunction () {\n\t\t\t\t\t\tme.frm.print_doc();\n\t\t\t\t\t},\n\t\t\t\t\t\"\",\n\t\t\t\t\t__(\"Print\")\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// email\n\t\tif (frappe.model.can_email(null, me.frm) && me.frm.doc.docstatus < 2) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Email\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.frm.email_doc();\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{\n\t\t\t\t\tshortcut: \"Ctrl+E\",\n\t\t\t\t\tcondition: () => !this.frm.is_new(),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\t// go to field modal\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Jump to field\"),\n\t\t\tfunction () {\n\t\t\t\tme.show_jump_to_field_dialog();\n\t\t\t},\n\t\t\ttrue,\n\t\t\t\"Ctrl+J\"\n\t\t);\n\n\t\t// Linked With\n\t\tif (!me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Links\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.show_linked_with();\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\t// duplicate\n\t\tif (in_list(frappe.boot.user.can_create, me.frm.doctype) && !me.frm.meta.allow_copy) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Duplicate\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.frm.copy_doc();\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\t// copy doc to clipboard\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Copy to Clipboard\"),\n\t\t\tfunction () {\n\t\t\t\tfrappe.utils.copy_to_clipboard(JSON.stringify(me.frm.doc));\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\t// rename\n\t\tif (this.can_rename()) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Rename\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.frm.rename_doc();\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\t// reload\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Reload\"),\n\t\t\tfunction () {\n\t\t\t\tme.frm.reload_doc();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\t// delete\n\t\tif (\n\t\t\tcint(me.frm.doc.docstatus) != 1 &&\n\t\t\t!me.frm.doc.__islocal &&\n\t\t\tfrappe.model.can_delete(me.frm.doctype)\n\t\t) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Delete\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.frm.savetrash();\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{\n\t\t\t\t\tshortcut: \"Shift+Ctrl+D\",\n\t\t\t\t\tcondition: () => !this.frm.is_new(),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.make_customize_buttons();\n\n\t\t// Auto Repeat\n\t\tif (this.can_repeat()) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"Repeat\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.utils.new_auto_repeat_prompt(me.frm);\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\t// New\n\t\tif (p[CREATE] && !this.frm.meta.issingle && !this.frm.meta.in_create) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"New {0}\", [__(me.frm.doctype)]),\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.new_doc(me.frm.doctype, true);\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{\n\t\t\t\t\tshortcut: \"Ctrl+B\",\n\t\t\t\t\tcondition: () => !this.frm.is_new(),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tif (\n\t\t\tthis.frm.doc.amended_from &&\n\t\t\tfrappe.model.get_value(\"DocType\", this.frm.doc.doctype, \"track_changes\")\n\t\t) {\n\t\t\tthis.page.add_menu_item(\n\t\t\t\t__(\"View Audit Trail\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.set_route(\"audit-trail\");\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t}\n\n\tmake_customize_buttons() {\n\t\tlet is_doctype_form = this.frm.doctype === \"DocType\";\n\t\tif (\n\t\t\tfrappe.model.can_create(\"Custom Field\") &&\n\t\t\tfrappe.model.can_create(\"Property Setter\")\n\t\t) {\n\t\t\tlet doctype = is_doctype_form ? this.frm.docname : this.frm.doctype;\n\t\t\tlet is_doctype_custom = is_doctype_form ? this.frm.doc.custom : false;\n\n\t\t\tif (doctype != \"DocType\" && !is_doctype_custom && this.frm.meta.issingle === 0) {\n\t\t\t\tthis.page.add_menu_item(\n\t\t\t\t\t__(\"Customize\"),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tif (this.frm.meta && this.frm.meta.custom) {\n\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"DocType\", doctype);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Customize Form\", {\n\t\t\t\t\t\t\t\tdoc_type: doctype,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (frappe.model.can_create(\"DocType\")) {\n\t\t\tif (frappe.boot.developer_mode === 1 && !is_doctype_form) {\n\t\t\t\t// edit doctype\n\t\t\t\tthis.page.add_menu_item(\n\t\t\t\t\t__(\"Edit DocType\"),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrappe.set_route(\"Form\", \"DocType\", this.frm.doctype);\n\t\t\t\t\t},\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tcan_repeat() {\n\t\treturn this.frm.meta.allow_auto_repeat && !this.frm.is_new() && !this.frm.doc.auto_repeat;\n\t}\n\tcan_save() {\n\t\treturn this.get_docstatus() === 0;\n\t}\n\tcan_submit() {\n\t\treturn (\n\t\t\tthis.get_docstatus() === 0 &&\n\t\t\t!this.frm.doc.__islocal &&\n\t\t\t!this.frm.doc.__unsaved &&\n\t\t\tthis.frm.perm[0].submit &&\n\t\t\t!this.has_workflow()\n\t\t);\n\t}\n\tcan_update() {\n\t\treturn (\n\t\t\tthis.get_docstatus() === 1 &&\n\t\t\t!this.frm.doc.__islocal &&\n\t\t\tthis.frm.perm[0].submit &&\n\t\t\tthis.frm.doc.__unsaved\n\t\t);\n\t}\n\tcan_cancel() {\n\t\treturn this.get_docstatus() === 1 && this.frm.perm[0].cancel && !this.read_only;\n\t}\n\tcan_amend() {\n\t\treturn this.get_docstatus() === 2 && this.frm.perm[0].amend && !this.read_only;\n\t}\n\thas_workflow() {\n\t\tif (this._has_workflow === undefined)\n\t\t\tthis._has_workflow = frappe.get_list(\"Workflow\", {\n\t\t\t\tdocument_type: this.frm.doctype,\n\t\t\t}).length;\n\t\treturn this._has_workflow;\n\t}\n\tget_docstatus() {\n\t\treturn cint(this.frm.doc.docstatus);\n\t}\n\tshow_linked_with() {\n\t\tif (!this.frm.linked_with) {\n\t\t\tthis.frm.linked_with = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm,\n\t\t\t});\n\t\t}\n\t\tthis.frm.linked_with.show();\n\t}\n\tset_primary_action(dirty) {\n\t\tif (!dirty) {\n\t\t\t// don't clear actions menu if dirty\n\t\t\tthis.page.clear_user_actions();\n\t\t}\n\n\t\tvar status = this.get_action_status();\n\t\tif (status) {\n\t\t\t// When moving from a page with status amend to another page with status amend\n\t\t\t// We need to check if document is already amend specifically and hide\n\t\t\t// or clear the menu actions accordingly\n\n\t\t\tif (status !== this.current_status && status === \"Amend\") {\n\t\t\t\tlet doc = this.frm.doc;\n\t\t\t\tfrappe\n\t\t\t\t\t.xcall(\"frappe.client.is_document_amended\", {\n\t\t\t\t\t\tdoctype: doc.doctype,\n\t\t\t\t\t\tdocname: doc.name,\n\t\t\t\t\t})\n\t\t\t\t\t.then((is_amended) => {\n\t\t\t\t\t\tif (is_amended) {\n\t\t\t\t\t\t\tthis.page.clear_actions();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.set_page_actions(status);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.set_page_actions(status);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.page.clear_actions();\n\t\t\tthis.current_status = null;\n\t\t}\n\t}\n\tget_action_status() {\n\t\tvar status = null;\n\t\tif (this.frm.page.current_view_name === \"print\" || this.frm.hidden) {\n\t\t\tstatus = \"Edit\";\n\t\t} else if (this.can_submit()) {\n\t\t\tstatus = \"Submit\";\n\t\t} else if (this.can_save()) {\n\t\t\tif (!this.frm.save_disabled) {\n\t\t\t\t//Show the save button if there is no workflow or if there is a workflow and there are changes\n\t\t\t\tif (this.has_workflow() ? this.frm.doc.__unsaved : true) {\n\t\t\t\t\tstatus = \"Save\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this.can_update()) {\n\t\t\tstatus = \"Update\";\n\t\t} else if (this.can_cancel()) {\n\t\t\tstatus = \"Cancel\";\n\t\t} else if (this.can_amend()) {\n\t\t\tstatus = \"Amend\";\n\t\t}\n\t\treturn status;\n\t}\n\tset_page_actions(status) {\n\t\tvar me = this;\n\t\tthis.page.clear_actions();\n\n\t\tif (status !== \"Edit\") {\n\t\t\tvar perm_to_check = this.frm.action_perm_type_map[status];\n\t\t\tif (!this.frm.perm[0][perm_to_check]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (status === \"Edit\") {\n\t\t\tthis.page.set_primary_action(\n\t\t\t\t__(\"Edit\"),\n\t\t\t\tfunction () {\n\t\t\t\t\tme.frm.page.set_view(\"main\");\n\t\t\t\t},\n\t\t\t\t\"edit\"\n\t\t\t);\n\t\t} else if (status === \"Cancel\") {\n\t\t\tlet add_cancel_button = () => {\n\t\t\t\tthis.page.set_secondary_action(__(status), function () {\n\t\t\t\t\tme.frm.savecancel(this);\n\t\t\t\t});\n\t\t\t};\n\t\t\tif (this.has_workflow()) {\n\t\t\t\tfrappe\n\t\t\t\t\t.xcall(\"frappe.model.workflow.can_cancel_document\", {\n\t\t\t\t\t\tdoctype: this.frm.doc.doctype,\n\t\t\t\t\t})\n\t\t\t\t\t.then((can_cancel) => {\n\t\t\t\t\t\tif (can_cancel) {\n\t\t\t\t\t\t\tadd_cancel_button();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tadd_cancel_button();\n\t\t\t}\n\t\t} else {\n\t\t\tvar click = {\n\t\t\t\tSave: function () {\n\t\t\t\t\treturn me.frm.save(\"Save\", null, this);\n\t\t\t\t},\n\t\t\t\tSubmit: function () {\n\t\t\t\t\treturn me.frm.savesubmit(this);\n\t\t\t\t},\n\t\t\t\tUpdate: function () {\n\t\t\t\t\treturn me.frm.save(\"Update\", null, this);\n\t\t\t\t},\n\t\t\t\tAmend: function () {\n\t\t\t\t\treturn me.frm.amend_doc();\n\t\t\t\t},\n\t\t\t}[status];\n\n\t\t\tvar icon = {\n\t\t\t\tUpdate: \"edit\",\n\t\t\t}[status];\n\n\t\t\tthis.page.set_primary_action(__(status), click, icon);\n\t\t}\n\n\t\tthis.current_status = status;\n\t}\n\tadd_update_button_on_dirty() {\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).on(\"dirty\", function () {\n\t\t\tme.show_title_as_dirty();\n\n\t\t\t// clear workflow actions\n\t\t\tme.frm.page.clear_actions_menu();\n\n\t\t\t// enable save action\n\t\t\tif (!me.frm.save_disabled) {\n\t\t\t\tme.set_primary_action(true);\n\t\t\t}\n\t\t});\n\t}\n\tshow_title_as_dirty() {\n\t\tif (this.frm.save_disabled && !this.frm.set_dirty) return;\n\n\t\tif (this.frm.is_dirty()) {\n\t\t\tthis.page.set_indicator(__(\"Not Saved\"), \"orange\");\n\t\t}\n\n\t\t$(this.frm.wrapper).attr(\"data-state\", this.frm.is_dirty() ? \"dirty\" : \"clean\");\n\t}\n\n\tshow_jump_to_field_dialog() {\n\t\tlet visible_fields_filter = (f) =>\n\t\t\t![\"Section Break\", \"Column Break\", \"Tab Break\"].includes(f.df.fieldtype) &&\n\t\t\t!f.df.hidden &&\n\t\t\tf.disp_status !== \"None\";\n\n\t\tlet fields = this.frm.fields\n\t\t\t.filter(visible_fields_filter)\n\t\t\t.map((f) => ({ label: __(f.df.label), value: f.df.fieldname }));\n\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Jump to field\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Autocomplete\",\n\t\t\t\t\tfieldname: \"fieldname\",\n\t\t\t\t\tlabel: __(\"Select Field\"),\n\t\t\t\t\toptions: fields,\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __(\"Go\"),\n\t\t\tprimary_action: ({ fieldname }) => {\n\t\t\t\tdialog.hide();\n\t\t\t\tthis.frm.scroll_to_field(fieldname);\n\t\t\t},\n\t\t\tanimate: false,\n\t\t});\n\n\t\tdialog.show();\n\t}\n};\n", "export default class Section {\n\tconstructor(parent, df, card_layout, layout) {\n\t\tthis.layout = layout;\n\t\tthis.card_layout = card_layout;\n\t\tthis.parent = parent;\n\t\tthis.df = df || {};\n\t\tthis.fields_list = [];\n\t\tthis.fields_dict = {};\n\n\t\tthis.make();\n\n\t\tif (\n\t\t\tthis.df.label &&\n\t\t\tthis.df.collapsible &&\n\t\t\tlocalStorage.getItem(df.css_class + \"-closed\")\n\t\t) {\n\t\t\tthis.collapse();\n\t\t}\n\n\t\tthis.row = {\n\t\t\twrapper: this.wrapper,\n\t\t};\n\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\tlet make_card = this.card_layout;\n\t\tthis.wrapper = $(`<div class=\"row\n\t\t\t\t${this.df.is_dashboard_section ? \"form-dashboard-section\" : \"form-section\"}\n\t\t\t\t${make_card ? \"card-section\" : \"\"}\">\n\t\t\t`).appendTo(this.parent);\n\t\tthis.layout && this.layout.sections.push(this);\n\n\t\tif (this.df) {\n\t\t\tif (this.df.label) {\n\t\t\t\tthis.make_head();\n\t\t\t}\n\t\t\tif (this.df.description) {\n\t\t\t\tthis.description_wrapper = $(\n\t\t\t\t\t`<div class=\"col-sm-12 form-section-description\">\n\t\t\t\t\t\t${__(this.df.description)}\n\t\t\t\t\t</div>`\n\t\t\t\t);\n\n\t\t\t\tthis.wrapper.append(this.description_wrapper);\n\t\t\t}\n\t\t\tif (this.df.css_class) {\n\t\t\t\tthis.wrapper.addClass(this.df.css_class);\n\t\t\t}\n\t\t\tif (this.df.hide_border) {\n\t\t\t\tthis.wrapper.toggleClass(\"hide-border\", true);\n\t\t\t}\n\t\t}\n\n\t\tthis.body = $('<div class=\"section-body\">').appendTo(this.wrapper);\n\n\t\tif (this.df.body_html) {\n\t\t\tthis.body.append(this.df.body_html);\n\t\t}\n\t}\n\n\tmake_head() {\n\t\tthis.head = $(`\n\t\t\t<div class=\"section-head\">\n\t\t\t\t${__(this.df.label)}\n\t\t\t\t<span class=\"ml-2 collapse-indicator mb-1\"></span>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.head.appendTo(this.wrapper);\n\t\tthis.indicator = this.head.find(\".collapse-indicator\");\n\t\tthis.indicator.hide();\n\n\t\tif (this.df.collapsible) {\n\t\t\tthis.head.addClass(\"collapsible\");\n\t\t\t// show / hide based on status\n\t\t\tthis.collapse_link = this.head.on(\"click\", () => {\n\t\t\t\tthis.collapse();\n\t\t\t});\n\t\t\tthis.set_icon();\n\t\t\tthis.indicator.show();\n\t\t}\n\t}\n\n\treplace_field(fieldname, fieldobj) {\n\t\tif (this.fields_dict[fieldname]?.df) {\n\t\t\tconst olfldobj = this.fields_dict[fieldname];\n\t\t\tconst idx = this.fields_list.findIndex((e) => e == olfldobj);\n\t\t\tthis.fields_list.splice(idx, 1, fieldobj);\n\t\t\tthis.fields_dict[fieldname] = fieldobj;\n\t\t\tfieldobj.section = this;\n\t\t}\n\t}\n\n\trefresh(hide) {\n\t\tif (!this.df) return;\n\t\t// hide if explicitly hidden\n\t\thide = hide || this.df.hidden || this.df.hidden_due_to_dependency;\n\t\tthis.wrapper.toggleClass(\"hide-control\", !!hide);\n\t}\n\n\tcollapse(hide) {\n\t\t// unknown edge case\n\t\tif (!(this.head && this.body)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (hide === undefined) {\n\t\t\thide = !this.body.hasClass(\"hide\");\n\t\t}\n\n\t\tthis.body.toggleClass(\"hide\", hide);\n\t\tthis.head && this.head.toggleClass(\"collapsed\", hide);\n\n\t\tthis.set_icon(hide);\n\n\t\tthis.fields_list.forEach((f) => f.on_section_collapse && f.on_section_collapse(hide));\n\n\t\t// save state for next reload ('' is falsy)\n\t\tif (this.df.css_class)\n\t\t\tlocalStorage.setItem(this.df.css_class + \"-closed\", hide ? \"1\" : \"\");\n\t}\n\n\tset_icon(hide) {\n\t\tlet indicator_icon = hide ? \"down\" : \"up-line\";\n\t\tthis.indicator && this.indicator.html(frappe.utils.icon(indicator_icon, \"sm\", \"mb-1\"));\n\t}\n\n\tis_collapsed() {\n\t\treturn this.body.hasClass(\"hide\");\n\t}\n\n\thas_missing_mandatory() {\n\t\tlet missing_mandatory = false;\n\t\tfor (let j = 0, l = this.fields_list.length; j < l; j++) {\n\t\t\tconst section_df = this.fields_list[j].df;\n\t\t\tif (section_df.reqd && this.layout.doc[section_df.fieldname] == null) {\n\t\t\t\tmissing_mandatory = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn missing_mandatory;\n\t}\n\n\thide() {\n\t\tthis.on_section_toggle(false);\n\t}\n\n\tshow() {\n\t\tthis.on_section_toggle(true);\n\t}\n\n\ton_section_toggle(show) {\n\t\tthis.wrapper.toggleClass(\"hide-control\", !show);\n\t\t// this.on_section_toggle && this.on_section_toggle(show);\n\t}\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nimport Section from \"./section.js\";\n\nfrappe.ui.form.Dashboard = class FormDashboard {\n\tconstructor(parent, frm) {\n\t\tthis.parent = parent;\n\t\tthis.frm = frm;\n\t\tthis.setup_dashboard_sections();\n\t}\n\n\tsetup_dashboard_sections() {\n\t\tthis.progress_area = this.make_section({\n\t\t\tcss_class: \"progress-area\",\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t});\n\n\t\tthis.heatmap_area = this.make_section({\n\t\t\tlabel: __(\"Activity\"),\n\t\t\tcss_class: \"form-heatmap\",\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t\tbody_html: `\n\t\t\t\t<div id=\"heatmap-${frappe.model.scrub(this.frm.doctype)}\" class=\"heatmap\"></div>\n\t\t\t\t<div class=\"text-muted small heatmap-message hidden\"></div>\n\t\t\t`,\n\t\t});\n\n\t\tthis.chart_area = this.make_section({\n\t\t\tlabel: __(\"Graph\"),\n\t\t\tcss_class: \"form-graph\",\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t});\n\n\t\tthis.stats_area_row = $(`<div class=\"row\"></div>`);\n\t\tthis.stats_area = this.make_section({\n\t\t\tlabel: __(\"Stats\"),\n\t\t\tcss_class: \"form-stats\",\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t\tbody_html: this.stats_area_row,\n\t\t});\n\n\t\tthis.transactions_area = $(`<div class=\"transactions\"></div>`);\n\n\t\tthis.links_area = this.make_section({\n\t\t\tlabel: __(\"Connections\"),\n\t\t\tcss_class: \"form-links\",\n\t\t\thidden: 1,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t\tbody_html: this.transactions_area,\n\t\t});\n\t}\n\n\tmake_section(df) {\n\t\treturn new Section(this.parent, df);\n\t}\n\n\treset() {\n\t\t// clear progress\n\t\tthis.progress_area.body.empty();\n\t\tthis.progress_area.hide();\n\n\t\t// clear heatmap\n\t\tthis.heatmap_area.hide();\n\n\t\t// clear chart\n\t\tthis.chart_area.hide();\n\n\t\t// clear links\n\t\tthis.links_area.body.find(\".count, .open-notification\").addClass(\"hidden\");\n\t\tthis.links_area.hide();\n\n\t\t// clear stats\n\t\tthis.stats_area_row.empty();\n\t\tthis.stats_area.hide();\n\n\t\t// clear custom\n\t\tthis.parent.find(\".custom\").remove();\n\t\t// this.hide();\n\t}\n\n\tadd_section(body_html, label = null, css_class = \"custom\", hidden = false) {\n\t\tlet options = {\n\t\t\tlabel,\n\t\t\tcss_class,\n\t\t\thidden,\n\t\t\tbody_html,\n\t\t\tmake_card: true,\n\t\t\tcollapsible: 1,\n\t\t\tis_dashboard_section: 1,\n\t\t};\n\t\treturn new Section(this.parent, options).body;\n\t}\n\n\tadd_progress(title, percent, message) {\n\t\tlet progress_chart = this.make_progress_chart(title);\n\n\t\tif (!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\n\t\tlet progress = $('<div class=\"progress\"></div>').appendTo(progress_chart);\n\n\t\t$.each(percent, function (i, opts) {\n\t\t\t$(\n\t\t\t\t`<div class=\"progress-bar ${opts.progress_class}\" style=\"width: ${opts.width}\" title=\"${opts.title}\"></div>`\n\t\t\t).appendTo(progress);\n\t\t});\n\n\t\tif (!message) message = \"\";\n\t\t$(`<p class=\"progress-message text-muted small\">${message}</p>`).appendTo(progress_chart);\n\n\t\tthis.show();\n\n\t\treturn progress_chart;\n\t}\n\n\tshow_progress(title, percent, message) {\n\t\tthis._progress_map = this._progress_map || {};\n\t\tlet progress_chart = this._progress_map[title];\n\t\t// create a new progress chart if it doesnt exist\n\t\t// or the previous one got detached from the DOM\n\t\tif (!progress_chart || progress_chart.parent().length == 0) {\n\t\t\tprogress_chart = this.add_progress(title, percent, message);\n\t\t\tthis._progress_map[title] = progress_chart;\n\t\t}\n\n\t\tif (!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\t\tprogress_chart.find(\".progress-bar\").each((i, progress_bar) => {\n\t\t\tconst { progress_class, width } = percent[i];\n\t\t\t$(progress_bar)\n\t\t\t\t.css(\"width\", width)\n\t\t\t\t.removeClass(\"progress-bar-danger progress-bar-success\")\n\t\t\t\t.addClass(progress_class);\n\t\t});\n\n\t\tif (!message) message = \"\";\n\t\tprogress_chart.find(\".progress-message\").text(message);\n\t}\n\n\thide_progress(title) {\n\t\tif (title) {\n\t\t\tthis._progress_map[title].remove();\n\t\t\tdelete this._progress_map[title];\n\t\t} else {\n\t\t\tthis._progress_map = {};\n\t\t\tthis.progress_area.hide();\n\t\t}\n\t}\n\n\tformat_percent(title, percent) {\n\t\tconst percentage = cint(percent);\n\t\tconst width = percentage < 0 ? 100 : percentage;\n\t\tconst progress_class = percentage < 0 ? \"progress-bar-danger\" : \"progress-bar-success\";\n\n\t\treturn [\n\t\t\t{\n\t\t\t\ttitle: title,\n\t\t\t\twidth: width + \"%\",\n\t\t\t\tprogress_class: progress_class,\n\t\t\t},\n\t\t];\n\t}\n\n\tmake_progress_chart(title) {\n\t\tthis.progress_area.show();\n\t\tlet progress_chart = $(\n\t\t\t'<div class=\"progress-chart\" title=\"' + (title || \"\") + '\"></div>'\n\t\t).appendTo(this.progress_area.body);\n\t\treturn progress_chart;\n\t}\n\n\trefresh() {\n\t\tthis.reset();\n\t\tif (this.frm.doc.__islocal || !frappe.boot.desk_settings.dashboard) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tlet show = false;\n\n\t\tif (\n\t\t\tthis.data &&\n\t\t\t((this.data.transactions || []).length || (this.data.reports || []).length)\n\t\t) {\n\t\t\tif (this.data.docstatus && this.frm.doc.docstatus !== this.data.docstatus) {\n\t\t\t\t// limited docstatus\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render_links();\n\t\t\tshow = true;\n\t\t}\n\n\t\tthis._fetched_counts = false;\n\n\t\tif (this.data.heatmap) {\n\t\t\tthis.render_heatmap();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif (this.data.graph) {\n\t\t\tthis.setup_graph();\n\t\t\t// show = true;\n\t\t}\n\n\t\tif (show) {\n\t\t\tthis.show();\n\t\t}\n\t}\n\n\tafter_refresh() {\n\t\t// show / hide new buttons (if allowed)\n\t\tthis.links_area.body.find(\".btn-new\").each((i, el) => {\n\t\t\tif (this.frm.can_create($(el).attr(\"data-doctype\"))) {\n\t\t\t\t$(el).removeClass(\"hidden\");\n\t\t\t}\n\t\t});\n\t\tthis.observe_link_render();\n\t}\n\n\tobserve_link_render() {\n\t\tlet me = this;\n\t\tlet element = this.links_area.wrapper[0];\n\n\t\tnew IntersectionObserver((entries, observer) => {\n\t\t\tentries.forEach((entry) => {\n\t\t\t\tif (entry.intersectionRatio > 0) {\n\t\t\t\t\tme.set_open_count();\n\t\t\t\t\tobserver.disconnect(); // only required for first load.\n\t\t\t\t}\n\t\t\t});\n\t\t}).observe(element);\n\t}\n\n\tinit_data() {\n\t\tthis.data = this.frm.meta.__dashboard || {};\n\t\tif (!this.data.transactions) this.data.transactions = [];\n\t\tif (!this.data.internal_links) this.data.internal_links = {};\n\t\tif (!this.data.internal_and_external_links) this.data.internal_and_external_links = {};\n\t\tthis.filter_permissions();\n\t}\n\n\tadd_transactions(opts) {\n\t\t// add additional data on dashboard\n\t\tlet group_added = [];\n\n\t\tif (!Array.isArray(opts)) opts = [opts];\n\n\t\tif (!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tif (this.data && (this.data.transactions || []).length) {\n\t\t\t// check if label already exists, add items to it\n\t\t\tthis.data.transactions.map((group) => {\n\t\t\t\topts.map((d) => {\n\t\t\t\t\tif (d.label == group.label) {\n\t\t\t\t\t\tgroup_added.push(d.label);\n\t\t\t\t\t\tgroup.items.push(...d.items);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// if label not already present, add new label and items under it\n\t\t\topts.map((d) => {\n\t\t\t\tif (!group_added.includes(d.label)) {\n\t\t\t\t\tthis.data.transactions.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.filter_permissions();\n\t\t}\n\t}\n\n\tfilter_permissions() {\n\t\t// filter out transactions for which the user\n\t\t// does not have permission\n\t\tlet transactions = [];\n\t\t(this.data.transactions || []).forEach(function (group) {\n\t\t\tlet items = [];\n\t\t\tgroup.items.forEach(function (doctype) {\n\t\t\t\tif (frappe.model.can_read(doctype)) {\n\t\t\t\t\titems.push(doctype);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// only add this group, if there is at-least\n\t\t\t// one item with permission\n\t\t\tif (items.length) {\n\t\t\t\tgroup.items = items;\n\t\t\t\ttransactions.push(group);\n\t\t\t}\n\t\t});\n\t\tthis.data.transactions = transactions;\n\t}\n\n\trender_links() {\n\t\tlet me = this;\n\t\tthis.links_area.show();\n\t\tthis.links_area.body.find(\".btn-new\").addClass(\"hidden\");\n\t\tif (this.data_rendered) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.data.frm = this.frm;\n\n\t\tlet transactions_area_body = this.transactions_area;\n\n\t\t$(frappe.render_template(\"form_links\", this.data)).appendTo(transactions_area_body);\n\n\t\tthis.render_report_links();\n\n\t\t// bind links\n\t\ttransactions_area_body.find(\".badge-link\").on(\"click\", function () {\n\t\t\tme.open_document_list($(this).closest(\".document-link\"));\n\t\t});\n\n\t\t// bind open notifications\n\t\ttransactions_area_body.find(\".open-notification\").on(\"click\", function () {\n\t\t\tme.open_document_list($(this).parent(), true);\n\t\t});\n\n\t\t// bind new\n\t\ttransactions_area_body.find(\".btn-new\").on(\"click\", function () {\n\t\t\tme.frm.make_new($(this).attr(\"data-doctype\"));\n\t\t});\n\n\t\tthis.data_rendered = true;\n\t}\n\n\trender_report_links() {\n\t\tlet parent = this.transactions_area;\n\t\tif (this.data.reports && this.data.reports.length) {\n\t\t\t$(frappe.render_template(\"report_links\", this.data)).appendTo(parent);\n\t\t\t// bind reports\n\t\t\tparent.find(\".report-link\").on(\"click\", (e) => {\n\t\t\t\tthis.open_report($(e.target).parent());\n\t\t\t});\n\t\t}\n\t}\n\n\topen_report($link) {\n\t\tlet report = $link.attr(\"data-report\");\n\n\t\tlet fieldname = this.data.non_standard_fieldnames\n\t\t\t? this.data.non_standard_fieldnames[report] || this.data.fieldname\n\t\t\t: this.data.fieldname;\n\n\t\tfrappe.provide(\"frappe.route_options\");\n\t\tfrappe.route_options[fieldname] = this.frm.doc.name;\n\t\tfrappe.set_route(\"query-report\", report);\n\t}\n\n\topen_document_list($link, show_open) {\n\t\t// show document list with filters\n\t\tlet doctype = $link.attr(\"data-doctype\"),\n\t\t\tnames = $link.attr(\"data-names\") || [];\n\n\t\tif (\n\t\t\tthis.internal_links_found &&\n\t\t\tthis.internal_links_found.find((d) => d.doctype === doctype)\n\t\t) {\n\t\t\tif (names.length) {\n\t\t\t\tfrappe.route_options = { name: [\"in\", names] };\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else if (this.data.fieldname) {\n\t\t\tfrappe.route_options = this.get_document_filter(doctype);\n\t\t\tif (show_open && frappe.ui.notifications) {\n\t\t\t\tfrappe.ui.notifications.show_open_count_list(doctype);\n\t\t\t}\n\t\t}\n\n\t\tfrappe.set_route(\"List\", doctype, \"List\");\n\t}\n\n\tget_document_filter(doctype) {\n\t\t// return the default filter for the given document\n\t\t// like {\"customer\": frm.doc.name}\n\t\tlet filter = {};\n\t\tlet fieldname = this.data.non_standard_fieldnames\n\t\t\t? this.data.non_standard_fieldnames[doctype] || this.data.fieldname\n\t\t\t: this.data.fieldname;\n\n\t\tif (this.data.dynamic_links && this.data.dynamic_links[fieldname]) {\n\t\t\tlet dynamic_fieldname = this.data.dynamic_links[fieldname][1];\n\t\t\tfilter[dynamic_fieldname] = this.data.dynamic_links[fieldname][0];\n\t\t}\n\n\t\tfilter[fieldname] = this.frm.doc.name;\n\t\treturn filter;\n\t}\n\n\tset_open_count() {\n\t\tif (\n\t\t\t!this.data ||\n\t\t\t!this.data.transactions ||\n\t\t\t!this.data.fieldname ||\n\t\t\tthis.frm.is_new() ||\n\t\t\tthis._fetched_counts\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\t// list all items from the transaction list\n\t\tlet items = [],\n\t\t\tme = this;\n\n\t\tthis.data.transactions.forEach(function (group) {\n\t\t\tgroup.items.forEach(function (item) {\n\t\t\t\titems.push(item);\n\t\t\t});\n\t\t});\n\n\t\tlet method = this.data.method || \"frappe.desk.notifications.get_open_count\";\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\titems: items,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message.timeline_data) {\n\t\t\t\t\tme.update_heatmap(r.message.timeline_data);\n\t\t\t\t}\n\n\t\t\t\tme.update_badges(r.message.count);\n\n\t\t\t\tme.frm.dashboard_data = r.message;\n\t\t\t\tme._fetched_counts = true;\n\t\t\t\tme.frm.trigger(\"dashboard_update\");\n\t\t\t},\n\t\t});\n\t}\n\n\tupdate_badges(count) {\n\t\tlet me = this;\n\n\t\tthis.internal_links_found = count.internal_links_found;\n\n\t\t$.each(count.internal_links_found, function (i, d) {\n\t\t\tme.frm.dashboard.set_badge_count_for_internal_link(\n\t\t\t\td.doctype,\n\t\t\t\tcint(d.open_count),\n\t\t\t\tcint(d.count),\n\t\t\t\td.names\n\t\t\t);\n\t\t});\n\n\t\t$.each(count.external_links_found, function (i, d) {\n\t\t\tme.frm.dashboard.set_badge_count_for_external_link(\n\t\t\t\td.doctype,\n\t\t\t\tcint(d.open_count),\n\t\t\t\tcint(d.count)\n\t\t\t);\n\t\t});\n\t}\n\n\tset_badge_count_for_external_link(doctype, open_count, count) {\n\t\tlet $link = $(this.transactions_area).find(\n\t\t\t'.document-link[data-doctype=\"' + doctype + '\"]'\n\t\t);\n\n\t\tthis.set_badge_count_common(open_count, count, $link);\n\t}\n\n\tset_badge_count_for_internal_link(doctype, open_count, count, names) {\n\t\tlet $link = $(this.transactions_area).find(\n\t\t\t'.document-link[data-doctype=\"' + doctype + '\"]'\n\t\t);\n\n\t\tthis.set_badge_count_common(open_count, count, $link);\n\n\t\tif (names && names.length) {\n\t\t\t$link.attr(\"data-names\", names ? names.join(\",\") : \"\");\n\t\t} else {\n\t\t\t$link.find(\"a\").attr(\"disabled\", true);\n\t\t}\n\t}\n\n\tset_badge_count_common(open_count, count, $link) {\n\t\tif (open_count) {\n\t\t\t$link\n\t\t\t\t.find(\".open-notification\")\n\t\t\t\t.removeClass(\"hidden\")\n\t\t\t\t.html(open_count > 99 ? \"99+\" : open_count);\n\t\t}\n\n\t\tif (count) {\n\t\t\t$link\n\t\t\t\t.find(\".count\")\n\t\t\t\t.removeClass(\"hidden\")\n\t\t\t\t.text(count > 99 ? \"99+\" : count);\n\t\t}\n\t}\n\n\tupdate_heatmap(data) {\n\t\tif (this.heatmap) {\n\t\t\tthis.heatmap.update({ dataPoints: data });\n\t\t}\n\t}\n\n\t// heatmap\n\trender_heatmap() {\n\t\tthis.heatmap = new frappe.Chart(\"#heatmap-\" + frappe.model.scrub(this.frm.doctype), {\n\t\t\ttype: \"heatmap\",\n\t\t\tstart: new Date(moment().subtract(1, \"year\").toDate()),\n\t\t\tcount_label: \"interactions\",\n\t\t\tdiscreteDomains: 1,\n\t\t\tradius: 3,\n\t\t\tdata: {},\n\t\t});\n\n\t\t// center the heatmap\n\t\tthis.heatmap_area.show();\n\t\tthis.heatmap_area.body.find(\"svg\").css({ margin: \"auto\" });\n\n\t\t// message\n\t\tlet heatmap_message = this.heatmap_area.body.find(\".heatmap-message\");\n\t\tif (this.data.heatmap_message) {\n\t\t\theatmap_message.removeClass(\"hidden\").html(this.data.heatmap_message);\n\t\t} else {\n\t\t\theatmap_message.addClass(\"hidden\");\n\t\t}\n\t}\n\n\tadd_indicator(label, color) {\n\t\tthis.show();\n\t\tthis.stats_area.show();\n\n\t\t// set colspan\n\t\tlet indicators = this.stats_area_row.find(\".indicator-column\");\n\t\tlet n_indicators = indicators.length + 1;\n\t\tlet colspan;\n\t\tif (n_indicators > 4) {\n\t\t\tcolspan = 3;\n\t\t} else {\n\t\t\tcolspan = 12 / n_indicators;\n\t\t}\n\n\t\t// reset classes in existing indicators\n\t\tif (indicators.length) {\n\t\t\tindicators\n\t\t\t\t.removeClass()\n\t\t\t\t.addClass(\"col-sm-\" + colspan)\n\t\t\t\t.addClass(\"indicator-column\");\n\t\t}\n\n\t\tlet indicator = $(\n\t\t\t'<div class=\"col-sm-' +\n\t\t\t\tcolspan +\n\t\t\t\t' indicator-column\"><span class=\"indicator ' +\n\t\t\t\tcolor +\n\t\t\t\t'\">' +\n\t\t\t\tlabel +\n\t\t\t\t\"</span></div>\"\n\t\t).appendTo(this.stats_area_row);\n\n\t\treturn indicator;\n\t}\n\n\t// graphs\n\tsetup_graph() {\n\t\tlet me = this;\n\t\tlet method = this.data.graph_method;\n\t\tlet args = {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.doc.name,\n\t\t};\n\t\t$.extend(args, this.data.graph_method_args);\n\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: args,\n\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tme.render_graph(r.message);\n\t\t\t\t\tme.show();\n\t\t\t\t} else {\n\t\t\t\t\tme.hide();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\trender_graph(args) {\n\t\tthis.chart_area.show();\n\t\tthis.chart_area.body.empty();\n\t\t$.extend(args, {\n\t\t\ttype: args.type || \"line\",\n\t\t\tcolors: args.colors || [\"green\"],\n\t\t\ttruncateLegends: 1,\n\t\t\taxisOptions: {\n\t\t\t\tshortenYAxisNumbers: 1,\n\t\t\t\tnumberFormatter: frappe.utils.format_chart_axis_number,\n\t\t\t},\n\t\t});\n\t\tthis.show();\n\n\t\tthis.chart = new frappe.Chart(\".form-graph\", args);\n\t\tif (!this.chart) {\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tshow() {\n\t\tthis.toggle_visibility(true);\n\t}\n\n\thide() {\n\t\tthis.toggle_visibility(false);\n\t}\n\n\ttoggle_visibility(show) {\n\t\tthis.parent.toggleClass(\"visible-section\", show);\n\t\tthis.parent.toggleClass(\"empty-section\", !show);\n\t}\n\n\t// TODO: Review! code related to headline should be the part of layout/form\n\tset_headline(html, color) {\n\t\tthis.frm.layout.show_message(html, color);\n\t}\n\n\tclear_headline() {\n\t\tthis.frm.layout.show_message();\n\t}\n\n\tadd_comment(text, alert_class, permanent) {\n\t\tthis.set_headline_alert(text, alert_class);\n\t\tif (!permanent) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.clear_headline();\n\t\t\t}, 10000);\n\t\t}\n\t}\n\n\tclear_comment() {\n\t\tthis.clear_headline();\n\t}\n\n\tset_headline_alert(text, color) {\n\t\tif (text) {\n\t\t\tthis.set_headline(`<div>${text}</div>`, color);\n\t\t} else {\n\t\t\tthis.clear_headline();\n\t\t}\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.States = class FormStates {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.frm.doctype);\n\n\t\t// no workflow?\n\t\tif (!this.state_fieldname) return;\n\n\t\tthis.update_fields = frappe.workflow.get_update_fields(this.frm.doctype);\n\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).bind(\"render_complete\", function () {\n\t\t\tme.refresh();\n\t\t});\n\t}\n\n\tsetup_help() {\n\t\tvar me = this;\n\t\tthis.frm.page.add_action_item(\n\t\t\t__(\"Help\"),\n\t\t\tfunction () {\n\t\t\t\tfrappe.workflow.setup(me.frm.doctype);\n\t\t\t\tvar state = me.get_state();\n\t\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: \"Workflow: \" + frappe.workflow.workflows[me.frm.doctype].name,\n\t\t\t\t});\n\n\t\t\t\tfrappe.workflow.get_transitions(me.frm.doc).then((transitions) => {\n\t\t\t\t\tconst next_actions =\n\t\t\t\t\t\t$.map(\n\t\t\t\t\t\t\ttransitions,\n\t\t\t\t\t\t\t(d) => `${d.action.bold()} ${__(\"by Role\")} ${d.allowed}`\n\t\t\t\t\t\t).join(\", \") || __(\"None: End of Workflow\").bold();\n\n\t\t\t\t\tconst document_editable_by = frappe.workflow\n\t\t\t\t\t\t.get_document_state_roles(me.frm.doctype, state)\n\t\t\t\t\t\t.map((role) => role.bold())\n\t\t\t\t\t\t.join(\", \");\n\n\t\t\t\t\t$(d.body)\n\t\t\t\t\t\t.html(\n\t\t\t\t\t\t\t`\n\t\t\t\t\t<p>${__(\"Current status\")}: ${state.bold()}</p>\n\t\t\t\t\t<p>${__(\"Document is only editable by users with role\")}: ${document_editable_by}</p>\n\t\t\t\t\t<p>${__(\"Next actions\")}: ${next_actions}</p>\n\t\t\t\t\t<p>${__(\"{0}: Other permission rules may also apply\", [__(\"Note\").bold()])}</p>\n\t\t\t\t`\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.css({ padding: \"15px\" });\n\n\t\t\t\t\td.show();\n\t\t\t\t});\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t}\n\n\trefresh() {\n\t\t// hide if its not yet saved\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.set_default_state();\n\t\t\treturn;\n\t\t}\n\n\t\t// state text\n\t\tconst state = this.get_state();\n\n\t\tif (state) {\n\t\t\t// show actions from that state\n\t\t\tthis.show_actions(state);\n\t\t}\n\t}\n\n\tshow_actions() {\n\t\tvar added = false;\n\t\tvar me = this;\n\n\t\t// if the loaded doc is dirty, don't show workflow buttons\n\t\tif (this.frm.doc.__unsaved === 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction has_approval_access(transition) {\n\t\t\tlet approval_access = false;\n\t\t\tconst user = frappe.session.user;\n\t\t\tif (\n\t\t\t\tuser === \"Administrator\" ||\n\t\t\t\ttransition.allow_self_approval ||\n\t\t\t\tuser !== me.frm.doc.owner\n\t\t\t) {\n\t\t\t\tapproval_access = true;\n\t\t\t}\n\t\t\treturn approval_access;\n\t\t}\n\n\t\tfrappe.workflow.get_transitions(this.frm.doc).then((transitions) => {\n\t\t\tthis.frm.page.clear_actions_menu();\n\t\t\ttransitions.forEach((d) => {\n\t\t\t\tif (frappe.user_roles.includes(d.allowed) && has_approval_access(d)) {\n\t\t\t\t\tadded = true;\n\t\t\t\t\tme.frm.page.add_action_item(__(d.action), function () {\n\t\t\t\t\t\t// set the workflow_action for use in form scripts\n\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\tme.frm.selected_workflow_action = d.action;\n\t\t\t\t\t\tme.frm.script_manager.trigger(\"before_workflow_action\").then(() => {\n\t\t\t\t\t\t\tfrappe\n\t\t\t\t\t\t\t\t.xcall(\"frappe.model.workflow.apply_workflow\", {\n\t\t\t\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\t\t\t\taction: d.action,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then((doc) => {\n\t\t\t\t\t\t\t\t\tfrappe.model.sync(doc);\n\t\t\t\t\t\t\t\t\tme.frm.refresh();\n\t\t\t\t\t\t\t\t\tme.frm.selected_workflow_action = null;\n\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger(\"after_workflow_action\");\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.setup_btn(added);\n\t\t});\n\t}\n\n\tsetup_btn(action_added) {\n\t\tif (action_added) {\n\t\t\tthis.frm.page.btn_primary.addClass(\"hide\");\n\t\t\tthis.frm.page.btn_secondary.addClass(\"hide\");\n\t\t\tthis.frm.toolbar.current_status = \"\";\n\t\t\tthis.setup_help();\n\t\t}\n\t}\n\n\tset_default_state() {\n\t\tvar default_state = frappe.workflow.get_default_state(\n\t\t\tthis.frm.doctype,\n\t\t\tthis.frm.doc.docstatus\n\t\t);\n\t\tif (default_state) {\n\t\t\tthis.frm.set_value(this.state_fieldname, default_state);\n\t\t}\n\t}\n\n\tget_state() {\n\t\tif (!this.frm.doc[this.state_fieldname]) {\n\t\t\tthis.set_default_state();\n\t\t}\n\t\treturn this.frm.doc[this.state_fieldname];\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.save = function (frm, action, callback, btn) {\n\t$(btn).prop(\"disabled\", true);\n\n\t// specified here because there are keyboard shortcuts to save\n\tconst working_label = {\n\t\tSave: __(\"Saving\", null, \"Freeze message while saving a document\"),\n\t\tSubmit: __(\"Submitting\", null, \"Freeze message while submitting a document\"),\n\t\tUpdate: __(\"Updating\", null, \"Freeze message while updating a document\"),\n\t\tAmend: __(\"Amending\", null, \"Freeze message while amending a document\"),\n\t\tCancel: __(\"Cancelling\", null, \"Freeze message while cancelling a document\"),\n\t}[toTitle(action)];\n\n\tvar freeze_message = working_label ? __(working_label) : \"\";\n\n\tvar save = function () {\n\t\tremove_empty_rows();\n\n\t\t$(frm.wrapper).addClass(\"validated-form\");\n\t\tif ((action !== \"Save\" || frm.is_dirty()) && check_mandatory()) {\n\t\t\t_call({\n\t\t\t\tmethod: \"frappe.desk.form.save.savedocs\",\n\t\t\t\targs: { doc: frm.doc, action: action },\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\terror: function (r) {\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\tbtn: btn,\n\t\t\t\tfreeze_message: freeze_message,\n\t\t\t});\n\t\t} else {\n\t\t\t!frm.is_dirty() &&\n\t\t\t\tfrappe.show_alert({ message: __(\"No changes in document\"), indicator: \"orange\" });\n\t\t\t$(btn).prop(\"disabled\", false);\n\t\t}\n\t};\n\n\tvar remove_empty_rows = function () {\n\t\t/*\n\t\t\tThis function removes empty rows. Note that in this function, a row is considered\n\t\t\tempty if the fields with `in_list_view: 1` are undefined or falsy because that's\n\t\t\twhat users also consider to be an empty row\n\t\t*/\n\t\tconst docs = frappe.model.get_all_docs(frm.doc);\n\n\t\t// we should only worry about table data\n\t\tconst tables = docs.filter((d) => {\n\t\t\treturn frappe.model.is_table(d.doctype);\n\t\t});\n\n\t\tlet modified_table_fields = [];\n\n\t\ttables.map((doc) => {\n\t\t\tconst cells = frappe.meta.docfield_list[doc.doctype] || [];\n\n\t\t\tconst in_list_view_cells = cells.filter((df) => {\n\t\t\t\treturn cint(df.in_list_view) === 1;\n\t\t\t});\n\n\t\t\tconst is_empty_row = function (cells) {\n\t\t\t\tfor (let i = 0; i < cells.length; i++) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tlocals[doc.doctype][doc.name] &&\n\t\t\t\t\t\tlocals[doc.doctype][doc.name][cells[i].fieldname]\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\tif (is_empty_row(in_list_view_cells)) {\n\t\t\t\tfrappe.model.clear_doc(doc.doctype, doc.name);\n\t\t\t\tmodified_table_fields.push(doc.parentfield);\n\t\t\t}\n\t\t});\n\n\t\tmodified_table_fields.forEach((field) => {\n\t\t\tfrm.refresh_field(field);\n\t\t});\n\t};\n\n\tvar cancel = function () {\n\t\tvar args = {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tname: frm.doc.name,\n\t\t};\n\n\t\t// update workflow state value if workflow exists\n\t\tvar workflow_state_fieldname = frappe.workflow.get_state_fieldname(frm.doctype);\n\t\tif (workflow_state_fieldname) {\n\t\t\t$.extend(args, {\n\t\t\t\tworkflow_state_fieldname: workflow_state_fieldname,\n\t\t\t\tworkflow_state: frm.doc[workflow_state_fieldname],\n\t\t\t});\n\t\t}\n\n\t\t_call({\n\t\t\tmethod: \"frappe.desk.form.save.cancel\",\n\t\t\targs: args,\n\t\t\tcallback: function (r) {\n\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\tcallback(r);\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tfreeze_message: freeze_message,\n\t\t});\n\t};\n\n\tvar check_mandatory = function () {\n\t\tvar has_errors = false;\n\t\tfrm.scroll_set = false;\n\n\t\tif (frm.doc.docstatus == 2) return true; // don't check for cancel\n\n\t\t$.each(frappe.model.get_all_docs(frm.doc), function (i, doc) {\n\t\t\tvar error_fields = [];\n\t\t\tvar folded = false;\n\n\t\t\t$.each(frappe.meta.docfield_list[doc.doctype] || [], function (i, docfield) {\n\t\t\t\tif (docfield.fieldname) {\n\t\t\t\t\tconst df = frappe.meta.get_docfield(doc.doctype, docfield.fieldname, doc.name);\n\n\t\t\t\t\tif (df.fieldtype === \"Fold\") {\n\t\t\t\t\t\tfolded = frm.layout.folded;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tis_docfield_mandatory(doc, df) &&\n\t\t\t\t\t\t!frappe.model.has_value(doc.doctype, doc.name, df.fieldname)\n\t\t\t\t\t) {\n\t\t\t\t\t\thas_errors = true;\n\t\t\t\t\t\terror_fields[error_fields.length] = __(df.label);\n\t\t\t\t\t\t// scroll to field\n\t\t\t\t\t\tif (!frm.scroll_set) {\n\t\t\t\t\t\t\tscroll_to(doc.parentfield || df.fieldname);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (folded) {\n\t\t\t\t\t\t\tfrm.layout.unfold();\n\t\t\t\t\t\t\tfolded = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (frm.is_new() && frm.meta.autoname === \"Prompt\" && !frm.doc.__newname) {\n\t\t\t\thas_errors = true;\n\t\t\t\terror_fields = [__(\"Name\"), ...error_fields];\n\t\t\t}\n\n\t\t\tif (error_fields.length) {\n\t\t\t\tlet meta = frappe.get_meta(doc.doctype);\n\t\t\t\tif (meta.istable) {\n\t\t\t\t\tconst table_field = frappe.meta.docfield_map[doc.parenttype][doc.parentfield];\n\n\t\t\t\t\tconst table_label = __(\n\t\t\t\t\t\ttable_field.label || frappe.unscrub(table_field.fieldname)\n\t\t\t\t\t).bold();\n\n\t\t\t\t\tvar message = __(\"Mandatory fields required in table {0}, Row {1}\", [\n\t\t\t\t\t\ttable_label,\n\t\t\t\t\t\tdoc.idx,\n\t\t\t\t\t]);\n\t\t\t\t} else {\n\t\t\t\t\tvar message = __(\"Mandatory fields required in {0}\", [__(doc.doctype)]);\n\t\t\t\t}\n\t\t\t\tmessage = message + \"<br><br><ul><li>\" + error_fields.join(\"</li><li>\") + \"</ul>\";\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\ttitle: __(\"Missing Fields\"),\n\t\t\t\t});\n\t\t\t\tfrm.refresh();\n\t\t\t}\n\t\t});\n\n\t\treturn !has_errors;\n\t};\n\n\tlet is_docfield_mandatory = function (doc, df) {\n\t\tif (df.reqd) return true;\n\t\tif (!df.mandatory_depends_on || !doc) return;\n\n\t\tlet out = null;\n\t\tlet expression = df.mandatory_depends_on;\n\t\tlet parent = frappe.get_meta(df.parent);\n\n\t\tif (typeof expression === \"boolean\") {\n\t\t\tout = expression;\n\t\t} else if (typeof expression === \"function\") {\n\t\t\tout = expression(doc);\n\t\t} else if (expression.substr(0, 5) == \"eval:\") {\n\t\t\ttry {\n\t\t\t\tout = frappe.utils.eval(expression.substr(5), { doc, parent });\n\t\t\t\tif (parent && parent.istable && expression.includes(\"is_submittable\")) {\n\t\t\t\t\tout = true;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tfrappe.throw(__('Invalid \"mandatory_depends_on\" expression'));\n\t\t\t}\n\t\t} else {\n\t\t\tvar value = doc[expression];\n\t\t\tif ($.isArray(value)) {\n\t\t\t\tout = !!value.length;\n\t\t\t} else {\n\t\t\t\tout = !!value;\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t};\n\n\tconst scroll_to = (fieldname) => {\n\t\tfrm.scroll_to_field(fieldname);\n\t\tfrm.scroll_set = true;\n\t};\n\n\tvar _call = function (opts) {\n\t\t// opts = {\n\t\t// \tmethod: \"some server method\",\n\t\t// \targs: {args to be passed},\n\t\t// \tcallback: callback,\n\t\t// \tbtn: btn\n\t\t// }\n\n\t\tif (frappe.ui.form.is_saving) {\n\t\t\t// this is likely to happen if the user presses the shortcut cmd+s for a longer duration or uses double click\n\t\t\t// no need to show this to user, as they can see \"Saving\" in freeze message\n\t\t\tconsole.log(\"Already saving. Please wait a few moments.\");\n\t\t\tthrow \"saving\";\n\t\t}\n\n\t\t// ensure we remove new docs routes ONLY\n\t\tif (frm.is_new()) {\n\t\t\tfrappe.ui.form.remove_old_form_route();\n\t\t}\n\t\tfrappe.ui.form.is_saving = true;\n\n\t\treturn frappe.call({\n\t\t\tfreeze: true,\n\t\t\t// freeze_message: opts.freeze_message,\n\t\t\tmethod: opts.method,\n\t\t\targs: opts.args,\n\t\t\tbtn: opts.btn,\n\t\t\tcallback: function (r) {\n\t\t\t\topts.callback && opts.callback(r);\n\t\t\t},\n\t\t\terror: opts.error,\n\t\t\talways: function (r) {\n\t\t\t\t$(btn).prop(\"disabled\", false);\n\t\t\t\tfrappe.ui.form.is_saving = false;\n\n\t\t\t\tif (r) {\n\t\t\t\t\tvar doc = r.docs && r.docs[0];\n\t\t\t\t\tif (doc) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t};\n\n\tif (action === \"cancel\") {\n\t\tcancel();\n\t} else {\n\t\tsave();\n\t}\n};\n\nfrappe.ui.form.remove_old_form_route = () => {\n\tlet current_route = frappe.get_route().join(\"/\");\n\tfrappe.route_history = frappe.route_history.filter(\n\t\t(route) => route.join(\"/\") !== current_route\n\t);\n};\n\nfrappe.ui.form.update_calling_link = (newdoc) => {\n\tif (!frappe._from_link) return;\n\tvar doc = frappe.get_doc(frappe._from_link.doctype, frappe._from_link.docname);\n\n\tlet is_valid_doctype = () => {\n\t\tif (frappe._from_link.df.fieldtype === \"Link\") {\n\t\t\treturn newdoc.doctype === frappe._from_link.df.options;\n\t\t} else {\n\t\t\t// dynamic link, type is dynamic\n\t\t\treturn newdoc.doctype === doc[frappe._from_link.df.options];\n\t\t}\n\t};\n\n\tif (is_valid_doctype()) {\n\t\tfrappe.model.with_doctype(newdoc.doctype, () => {\n\t\t\tlet meta = frappe.get_meta(newdoc.doctype);\n\t\t\t// set value\n\t\t\tif (doc && doc.parentfield) {\n\t\t\t\t//update values for child table\n\t\t\t\t$.each(\n\t\t\t\t\tfrappe._from_link.frm.fields_dict[doc.parentfield].grid.grid_rows,\n\t\t\t\t\tfunction (index, field) {\n\t\t\t\t\t\tif (field.doc && field.doc.name === frappe._from_link.docname) {\n\t\t\t\t\t\t\tif (meta.title_field && meta.show_title_field_in_link) {\n\t\t\t\t\t\t\t\tfrappe.utils.add_link_title(\n\t\t\t\t\t\t\t\t\tnewdoc.doctype,\n\t\t\t\t\t\t\t\t\tnewdoc.name,\n\t\t\t\t\t\t\t\t\tnewdoc[meta.title_field]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tif (meta.title_field && meta.show_title_field_in_link) {\n\t\t\t\t\tfrappe.utils.add_link_title(\n\t\t\t\t\t\tnewdoc.doctype,\n\t\t\t\t\t\tnewdoc.name,\n\t\t\t\t\t\tnewdoc[meta.title_field]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t}\n\n\t\t\t// refresh field\n\t\t\tfrappe._from_link.refresh();\n\n\t\t\t// if from form, switch\n\t\t\tif (frappe._from_link.frm) {\n\t\t\t\tfrappe\n\t\t\t\t\t.set_route(\n\t\t\t\t\t\t\"Form\",\n\t\t\t\t\t\tfrappe._from_link.frm.doctype,\n\t\t\t\t\t\tfrappe._from_link.frm.docname\n\t\t\t\t\t)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tfrappe.utils.scroll_to(frappe._from_link_scrollY);\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tfrappe._from_link = null;\n\t\t});\n\t}\n};\n", "frappe.ui.get_print_settings = function (pdf, callback, letter_head, pick_columns) {\n\tvar print_settings = locals[\":Print Settings\"][\"Print Settings\"];\n\n\tvar default_letter_head =\n\t\tlocals[\":Company\"] && frappe.defaults.get_default(\"company\")\n\t\t\t? locals[\":Company\"][frappe.defaults.get_default(\"company\")][\"default_letter_head\"]\n\t\t\t: \"\";\n\n\tvar columns = [\n\t\t{\n\t\t\tfieldtype: \"Check\",\n\t\t\tfieldname: \"with_letter_head\",\n\t\t\tlabel: __(\"With Letter head\"),\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Select\",\n\t\t\tfieldname: \"letter_head\",\n\t\t\tlabel: __(\"Letter Head\"),\n\t\t\tdepends_on: \"with_letter_head\",\n\t\t\toptions: Object.keys(frappe.boot.letter_heads),\n\t\t\tdefault: letter_head || default_letter_head,\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Select\",\n\t\t\tfieldname: \"orientation\",\n\t\t\tlabel: __(\"Orientation\"),\n\t\t\toptions: [\n\t\t\t\t{ value: \"Landscape\", label: __(\"Landscape\") },\n\t\t\t\t{ value: \"Portrait\", label: __(\"Portrait\") },\n\t\t\t],\n\t\t\tdefault: \"Landscape\",\n\t\t},\n\t];\n\n\tif (pick_columns) {\n\t\tcolumns.push(\n\t\t\t{\n\t\t\t\tlabel: __(\"Pick Columns\"),\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tfieldname: \"pick_columns\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Select Columns\"),\n\t\t\t\tfieldtype: \"MultiCheck\",\n\t\t\t\tfieldname: \"columns\",\n\t\t\t\tdepends_on: \"pick_columns\",\n\t\t\t\tcolumns: 2,\n\t\t\t\tselect_all: true,\n\t\t\t\toptions: pick_columns.map((df) => ({\n\t\t\t\t\tlabel: __(df.label),\n\t\t\t\t\tvalue: df.fieldname,\n\t\t\t\t})),\n\t\t\t}\n\t\t);\n\t}\n\n\treturn frappe.prompt(\n\t\tcolumns,\n\t\tfunction (data) {\n\t\t\tdata = $.extend(print_settings, data);\n\t\t\tif (!data.with_letter_head) {\n\t\t\t\tdata.letter_head = null;\n\t\t\t}\n\t\t\tif (data.letter_head) {\n\t\t\t\tdata.letter_head = frappe.boot.letter_heads[print_settings.letter_head];\n\t\t\t}\n\t\t\tcallback(data);\n\t\t},\n\t\t__(\"Print Settings\")\n\t);\n};\n\n// qz tray connection wrapper\n//  - allows active and inactive connections to resolve regardless\n//  - try to connect once before firing the mimetype launcher\n//  - if connection fails, catch the reject, fire the mimetype launcher\n//  - after mimetype launcher is fired, try to connect 3 more times\n//  - display success/fail message to user\nfrappe.ui.form.qz_connect = function () {\n\treturn new Promise(function (resolve, reject) {\n\t\tfrappe.ui.form.qz_init().then(() => {\n\t\t\tif (qz.websocket.isActive()) {\n\t\t\t\t// if already active, resolve immediately\n\t\t\t\t// frappe.show_alert({message: __('QZ Tray Connection Active!'), indicator: 'green'});\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\t// try to connect once before firing the mimetype launcher\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Attempting Connection to QZ Tray...\"),\n\t\t\t\t\tindicator: \"blue\",\n\t\t\t\t});\n\t\t\t\tqz.websocket.connect().then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Connected to QZ Tray!\"),\n\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\tfunction retry(err) {\n\t\t\t\t\t\tif (err.message === \"Unable to establish connection with QZ\") {\n\t\t\t\t\t\t\t// if a connect was not successful, launch the mimetype, try 3 more times\n\t\t\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmessage: __(\"Attempting to launch QZ Tray...\"),\n\t\t\t\t\t\t\t\t\tindicator: \"blue\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t14\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\twindow.location.assign(\"qz:launch\");\n\t\t\t\t\t\t\tqz.websocket\n\t\t\t\t\t\t\t\t.connect({\n\t\t\t\t\t\t\t\t\tretries: 3,\n\t\t\t\t\t\t\t\t\tdelay: 1,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\t\t\tmessage: __(\"Connected to QZ Tray!\"),\n\t\t\t\t\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\t\t\t'Error connecting to QZ Tray Application...<br><br> You need to have QZ Tray application installed and running, to use the Raw Print feature.<br><br><a target=\"_blank\" href=\"https://qz.io/download/\">Click here to Download and install QZ Tray</a>.<br> <a target=\"_blank\" href=\"https://erpnext.com/docs/user/manual/en/setting-up/print/raw-printing\">Click here to learn more about Raw Printing</a>.'\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmessage: \"QZ Tray \" + err.toString(),\n\t\t\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t14\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t});\n};\n\nfrappe.ui.form.qz_init = function () {\n\t// Initializing qz tray library\n\treturn new Promise((resolve) => {\n\t\tif (typeof qz === \"object\" && typeof qz.version === \"string\") {\n\t\t\t// resolve immediately if already Initialized\n\t\t\tresolve();\n\t\t} else {\n\t\t\tlet qz_required_assets = [\n\t\t\t\t\"/assets/frappe/node_modules/js-sha256/build/sha256.min.js\",\n\t\t\t\t\"/assets/frappe/node_modules/qz-tray/qz-tray.js\",\n\t\t\t];\n\t\t\tfrappe.require(qz_required_assets, () => {\n\t\t\t\tqz.api.setPromiseType(function promise(resolver) {\n\t\t\t\t\treturn new Promise(resolver);\n\t\t\t\t});\n\t\t\t\tqz.api.setSha256Type(function (data) {\n\t\t\t\t\t// Codacy fix\n\t\t\t\t\t/*global sha256*/\n\t\t\t\t\treturn sha256(data);\n\t\t\t\t});\n\t\t\t\tresolve();\n\t\t\t});\n\t\t\t// note 'frappe.require' does not have callback on fail. Hence, any failure cannot be communicated to the user.\n\t\t}\n\t});\n};\n\nfrappe.ui.form.qz_get_printer_list = function () {\n\t// returns the list of printers that are available to the QZ Tray\n\treturn frappe.ui.form\n\t\t.qz_connect()\n\t\t.then(function () {\n\t\t\treturn qz.printers.find();\n\t\t})\n\t\t.then((data) => {\n\t\t\treturn data;\n\t\t})\n\t\t.catch((err) => {\n\t\t\tfrappe.ui.form.qz_fail(err);\n\t\t});\n};\n\nfrappe.ui.form.qz_success = function () {\n\t// notify qz successful print\n\tfrappe.show_alert({\n\t\tmessage: __(\"Print Sent to the printer!\"),\n\t\tindicator: \"green\",\n\t});\n};\n\nfrappe.ui.form.qz_fail = function (e) {\n\t// notify qz errors\n\tfrappe.show_alert(\n\t\t{\n\t\t\tmessage: __(\"QZ Tray Failed: \") + e.toString(),\n\t\t\tindicator: \"red\",\n\t\t},\n\t\t20\n\t);\n};\n", "frappe.provide(\"frappe.ui.form\");\nfrappe.provide(\"frappe.success_action\");\n\nfrappe.ui.form.SuccessAction = class SuccessAction {\n\tconstructor(form) {\n\t\tthis.form = form;\n\t\tthis.load_setting();\n\t}\n\n\tload_setting() {\n\t\tthis.setting = frappe.boot.success_action.find(\n\t\t\t(setting) => setting.ref_doctype === this.form.doctype\n\t\t);\n\t}\n\n\tshow() {\n\t\tif (!this.setting) return;\n\t\tif (this.form.doc.docstatus === 0 && !this.is_first_creation()) return;\n\n\t\tthis.prepare_dom();\n\t\tthis.show_alert();\n\t}\n\n\tprepare_dom() {\n\t\tthis.container = $(document.body).find(\".success-container\");\n\t\tif (!this.container.length) {\n\t\t\tthis.container = $('<div class=\"success-container\">').appendTo(document.body);\n\t\t}\n\t}\n\n\tshow_alert() {\n\t\tfrappe.db.get_list(this.form.doctype, { limit: 2 }).then((result) => {\n\t\t\tconst count = result.length;\n\t\t\tconst setting = this.setting;\n\t\t\tlet message = count === 1 ? setting.first_success_message : setting.message;\n\n\t\t\tconst $buttons = this.get_actions().map((action) => {\n\t\t\t\tconst $btn = $(\n\t\t\t\t\t`<button class=\"next-action\"><span>${__(action.label)}</span></button>`\n\t\t\t\t);\n\t\t\t\t$btn.click(() => action.action(this.form));\n\t\t\t\treturn $btn;\n\t\t\t});\n\n\t\t\tconst next_action_container = $(`<div class=\"next-action-container\"></div>`);\n\t\t\tnext_action_container.append($buttons);\n\t\t\tconst html = next_action_container;\n\n\t\t\tfrappe.show_alert(\n\t\t\t\t{\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tbody: html,\n\t\t\t\t\tindicator: \"green\",\n\t\t\t\t},\n\t\t\t\tsetting.action_timeout || 7\n\t\t\t);\n\t\t});\n\t}\n\n\tget_actions() {\n\t\tconst actions = [];\n\t\tconst checked_actions = this.setting.next_actions.split(\"\\n\");\n\t\tchecked_actions.forEach((action) => {\n\t\t\tif (typeof action === \"string\" && this.default_actions[action]) {\n\t\t\t\tactions.push(this.default_actions[action]);\n\t\t\t} else if (typeof action === \"object\") {\n\t\t\t\tactions.push(action);\n\t\t\t}\n\t\t});\n\n\t\treturn actions;\n\t}\n\n\tget default_actions() {\n\t\treturn {\n\t\t\tnew: {\n\t\t\t\tlabel: __(\"New\"),\n\t\t\t\taction: (frm) => frappe.new_doc(frm.doctype),\n\t\t\t},\n\t\t\tprint: {\n\t\t\t\tlabel: __(\"Print\"),\n\t\t\t\taction: (frm) => frm.print_doc(),\n\t\t\t},\n\t\t\temail: {\n\t\t\t\tlabel: __(\"Email\"),\n\t\t\t\taction: (frm) => frm.email_doc(),\n\t\t\t},\n\t\t\tlist: {\n\t\t\t\tlabel: __(\"View All\"),\n\t\t\t\taction: (frm) => {\n\t\t\t\t\tfrappe.set_route(\"List\", frm.doctype);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tis_first_creation() {\n\t\tlet { modified, creation } = this.form.doc;\n\n\t\t// strip out milliseconds\n\t\tmodified = modified.split(\".\")[0];\n\t\tcreation = creation.split(\".\")[0];\n\n\t\treturn modified === creation;\n\t}\n};\n", "frappe.provide(\"frappe.ui.form\");\nfrappe.provide(\"frappe.model.docinfo\");\n\nimport \"frappe/public/js/frappe/form/quick_entry\";\nimport \"frappe/public/js/frappe/form/toolbar\";\nimport \"frappe/public/js/frappe/form/dashboard\";\nimport \"frappe/public/js/frappe/form/workflow\";\nimport \"frappe/public/js/frappe/form/save\";\nimport \"frappe/public/js/frappe/form/print_utils\";\nimport \"frappe/public/js/frappe/form/success_action\";\nimport \"frappe/public/js/frappe/form/script_manager\";\nimport \"frappe/public/js/frappe/form/script_helpers\";\nimport \"frappe/public/js/frappe/form/sidebar/form_sidebar\";\nimport \"frappe/public/js/frappe/form/footer/footer\";\nimport \"frappe/public/js/frappe/form/form_tour\";\nimport { UndoManager } from \"frappe/public/js/frappe/form/undo_manager\";\n\nfrappe.ui.form.Controller = class FormController {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n};\n\nfrappe.ui.form.Form = class FrappeForm {\n\tconstructor(doctype, parent, in_form, doctype_layout_name) {\n\t\tthis.docname = \"\";\n\t\tthis.doctype = doctype;\n\t\tthis.doctype_layout_name = doctype_layout_name;\n\t\tthis.in_form = in_form ? true : false;\n\n\t\tthis.hidden = false;\n\t\tthis.refresh_if_stale_for = 120;\n\t\tthis.opendocs = {};\n\t\tthis.custom_buttons = {};\n\t\tthis.sections = [];\n\t\tthis.grids = [];\n\t\tthis.cscript = new frappe.ui.form.Controller({ frm: this });\n\t\tthis.events = {};\n\t\tthis.fetch_dict = {};\n\t\tthis.parent = parent;\n\t\tthis.doctype_layout = frappe.get_doc(\"DocType Layout\", doctype_layout_name);\n\t\tthis.undo_manager = new UndoManager({ frm: this });\n\t\tthis.setup_meta(doctype);\n\t\tthis.debounced_reload_doc = frappe.utils.debounce(this.reload_doc.bind(this), 1000);\n\n\t\tthis.beforeUnloadListener = (event) => {\n\t\t\tevent.preventDefault();\n\t\t\t// A String is returned for compatability with older Browsers. Return Value has to be truthy to trigger \"Leave Site\" Dialog\n\t\t\treturn (event.returnValue =\n\t\t\t\t\"There are unsaved changes, are you sure you want to exit?\");\n\t\t};\n\t}\n\n\tsetup_meta() {\n\t\tthis.meta = frappe.get_doc(\"DocType\", this.doctype);\n\n\t\tif (this.meta.istable) {\n\t\t\tthis.meta.in_dialog = 1;\n\t\t}\n\n\t\tthis.perm = frappe.perm.get_perm(this.doctype); // for create\n\t\tthis.action_perm_type_map = {\n\t\t\tCreate: \"create\",\n\t\t\tSave: \"write\",\n\t\t\tSubmit: \"submit\",\n\t\t\tUpdate: \"submit\",\n\t\t\tCancel: \"cancel\",\n\t\t\tAmend: \"amend\",\n\t\t\tDelete: \"delete\",\n\t\t};\n\t}\n\n\tsetup() {\n\t\tthis.fields = [];\n\t\tthis.fields_dict = {};\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\n\t\t// wrapper\n\t\tthis.wrapper = this.parent;\n\t\tthis.$wrapper = $(this.wrapper);\n\t\tfrappe.ui.make_app_page({\n\t\t\tparent: this.wrapper,\n\t\t\tsingle_column: this.meta.hide_toolbar,\n\t\t});\n\t\tthis.page = this.wrapper.page;\n\t\tthis.layout_main = this.page.main.get(0);\n\n\t\tthis.$wrapper.on(\"hide\", () => {\n\t\t\tthis.script_manager.trigger(\"on_hide\");\n\t\t});\n\n\t\tthis.toolbar = new frappe.ui.form.Toolbar({\n\t\t\tfrm: this,\n\t\t\tpage: this.page,\n\t\t});\n\n\t\t// navigate records keyboard shortcuts\n\t\tthis.add_form_keyboard_shortcuts();\n\n\t\t// 2 column layout\n\t\tthis.setup_std_layout();\n\n\t\t// client script must be called after \"setup\" - there are no fields_dict attached to the frm otherwise\n\t\tthis.script_manager = new frappe.ui.form.ScriptManager({\n\t\t\tfrm: this,\n\t\t});\n\t\tthis.script_manager.setup();\n\t\tthis.watch_model_updates();\n\n\t\tif (!this.meta.hide_toolbar && frappe.boot.desk_settings.timeline) {\n\t\t\t// this.footer_tab = new frappe.ui.form.Tab(this.layout, {\n\t\t\t// \tlabel: __(\"Activity\"),\n\t\t\t// \tfieldname: 'timeline'\n\t\t\t// });\n\n\t\t\tthis.footer = new frappe.ui.form.Footer({\n\t\t\t\tfrm: this,\n\t\t\t\tparent: $(\"<div>\").appendTo(this.page.main.parent()),\n\t\t\t});\n\t\t\t$(\"body\").attr(\"data-sidebar\", 1);\n\t\t}\n\t\tthis.setup_file_drop();\n\t\tthis.setup_doctype_actions();\n\t\tthis.setup_notify_on_rename();\n\n\t\tthis.setup_done = true;\n\t}\n\n\tadd_form_keyboard_shortcuts() {\n\t\t// Navigate to next record\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"shift+ctrl+>\",\n\t\t\taction: () => this.navigate_records(0),\n\t\t\tpage: this.page,\n\t\t\tdescription: __(\"Go to next record\"),\n\t\t\tignore_inputs: true,\n\t\t\tcondition: () => !this.is_new(),\n\t\t});\n\n\t\t// Navigate to previous record\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"shift+ctrl+<\",\n\t\t\taction: () => this.navigate_records(1),\n\t\t\tpage: this.page,\n\t\t\tdescription: __(\"Go to previous record\"),\n\t\t\tignore_inputs: true,\n\t\t\tcondition: () => !this.is_new(),\n\t\t});\n\n\t\t// Undo and redo\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+z\",\n\t\t\taction: () => this.undo_manager.undo(),\n\t\t\tpage: this.page,\n\t\t\tdescription: __(\"Undo last action\"),\n\t\t});\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"shift+ctrl+z\",\n\t\t\taction: () => this.undo_manager.redo(),\n\t\t\tpage: this.page,\n\t\t\tdescription: __(\"Redo last action\"),\n\t\t});\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+y\",\n\t\t\taction: () => this.undo_manager.redo(),\n\t\t\tpage: this.page,\n\t\t\tdescription: __(\"Redo last action\"),\n\t\t});\n\n\t\tlet grid_shortcut_keys = [\n\t\t\t{\n\t\t\t\tshortcut: \"Up Arrow\",\n\t\t\t\tdescription: __(\"Move cursor to above row\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"Down Arrow\",\n\t\t\t\tdescription: __(\"Move cursor to below row\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"tab\",\n\t\t\t\tdescription: __(\"Move cursor to next column\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"shift+tab\",\n\t\t\t\tdescription: __(\"Move cursor to previous column\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"Ctrl+up\",\n\t\t\t\tdescription: __(\"Add a row above the current row\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"Ctrl+down\",\n\t\t\t\tdescription: __(\"Add a row below the current row\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"Ctrl+shift+up\",\n\t\t\t\tdescription: __(\"Add a row at the top\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"Ctrl+shift+down\",\n\t\t\t\tdescription: __(\"Add a row at the bottom\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tshortcut: \"shift+alt+down\",\n\t\t\t\tdescription: __(\"Duplicate current row\"),\n\t\t\t},\n\t\t];\n\n\t\tgrid_shortcut_keys.forEach((row) => {\n\t\t\tfrappe.ui.keys.add_shortcut({\n\t\t\t\tshortcut: row.shortcut,\n\t\t\t\tpage: this.page,\n\t\t\t\tdescription: __(row.description),\n\t\t\t\tignore_inputs: true,\n\t\t\t\tcondition: () => !this.is_new(),\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_std_layout() {\n\t\tthis.form_wrapper = $(\"<div></div>\").appendTo(this.layout_main);\n\t\tthis.body = $('<div class=\"std-form-layout\"></div>').appendTo(this.form_wrapper);\n\n\t\t// only tray\n\t\tthis.meta.section_style = \"Simple\"; // always simple!\n\n\t\t// layout\n\t\tthis.layout = new frappe.ui.form.Layout({\n\t\t\tparent: this.body,\n\t\t\tdoctype: this.doctype,\n\t\t\tdoctype_layout: this.doctype_layout,\n\t\t\tfrm: this,\n\t\t\twith_dashboard: true,\n\t\t\tcard_layout: true,\n\t\t});\n\n\t\tthis.layout.make();\n\n\t\tthis.fields_dict = this.layout.fields_dict;\n\t\tthis.fields = this.layout.fields_list;\n\n\t\tlet dashboard_parent = $('<div class=\"form-dashboard\">');\n\t\tlet dashboard_added = false;\n\n\t\tif (this.layout.tabs.length) {\n\t\t\tthis.layout.tabs.every((tab) => {\n\t\t\t\tif (tab.df.show_dashboard) {\n\t\t\t\t\ttab.wrapper.prepend(dashboard_parent);\n\t\t\t\t\tdashboard_added = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\t\t\tif (!dashboard_added) {\n\t\t\t\tthis.layout.tabs[0].wrapper.prepend(dashboard_parent);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.layout.wrapper.find(\".form-page\").prepend(dashboard_parent);\n\t\t}\n\n\t\tthis.dashboard = new frappe.ui.form.Dashboard(dashboard_parent, this);\n\n\t\tthis.tour = new frappe.ui.form.FormTour({\n\t\t\tfrm: this,\n\t\t});\n\n\t\t// workflow state\n\t\tthis.states = new frappe.ui.form.States({\n\t\t\tfrm: this,\n\t\t});\n\t}\n\n\twatch_model_updates() {\n\t\t// watch model updates\n\t\tvar me = this;\n\n\t\t// on main doc\n\t\tfrappe.model.on(\n\t\t\tme.doctype,\n\t\t\t\"*\",\n\t\t\tfunction (fieldname, value, doc, skip_dirty_trigger = false) {\n\t\t\t\t// set input\n\t\t\t\tif (doc.name == me.docname) {\n\t\t\t\t\tif (!skip_dirty_trigger) {\n\t\t\t\t\t\tme.dirty();\n\t\t\t\t\t}\n\n\t\t\t\t\tlet field = me.fields_dict[fieldname];\n\t\t\t\t\tfield && field.refresh(fieldname);\n\n\t\t\t\t\t// Validate value for link field explicitly\n\t\t\t\t\tfield &&\n\t\t\t\t\t\t[\"Link\", \"Dynamic Link\"].includes(field.df.fieldtype) &&\n\t\t\t\t\t\tfield.validate &&\n\t\t\t\t\t\tfield.validate(value);\n\n\t\t\t\t\tme.layout.refresh_dependency();\n\t\t\t\t\tme.layout.refresh_sections();\n\t\t\t\t\treturn me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\t// on table fields\n\t\tvar table_fields = frappe.get_children(\"DocType\", me.doctype, \"fields\", {\n\t\t\tfieldtype: [\"in\", frappe.model.table_fields],\n\t\t});\n\n\t\t// using $.each to preserve df via closure\n\t\t$.each(table_fields, function (i, df) {\n\t\t\tfrappe.model.on(df.options, \"*\", function (fieldname, value, doc) {\n\t\t\t\tif (doc.parent == me.docname && doc.parentfield === df.fieldname) {\n\t\t\t\t\tme.dirty();\n\t\t\t\t\tme.fields_dict[df.fieldname].grid.set_value(fieldname, value, doc);\n\t\t\t\t\treturn me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_notify_on_rename() {\n\t\t$(document).on(\"rename\", (ev, dt, old_name, new_name) => {\n\t\t\tif (dt == this.doctype) this.rename_notify(dt, old_name, new_name);\n\t\t});\n\t}\n\n\tsetup_file_drop() {\n\t\tvar me = this;\n\t\tthis.$wrapper.on(\"dragenter dragover\", false).on(\"drop\", function (e) {\n\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (me.doc.__islocal) {\n\t\t\t\tfrappe.msgprint(__(\"Please save before attaching.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tdocname: me.docname,\n\t\t\t\tfrm: me,\n\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\tfolder: \"Home/Attachments\",\n\t\t\t\ton_success(file_doc) {\n\t\t\t\t\tme.attachments.attachment_uploaded(file_doc);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_image_autocompletions_in_markdown() {\n\t\tthis.fields.map((field) => {\n\t\t\tif (field.df.fieldtype === \"Markdown Editor\") {\n\t\t\t\tthis.set_df_property(field.df.fieldname, \"autocompletions\", () => {\n\t\t\t\t\tlet attachments = this.attachments.get_attachments();\n\t\t\t\t\treturn attachments\n\t\t\t\t\t\t.filter((file) => frappe.utils.is_image_file(file.file_url))\n\t\t\t\t\t\t.map((file) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tcaption: \"image: \" + file.file_name,\n\t\t\t\t\t\t\t\tvalue: `![](${file.file_url})`,\n\t\t\t\t\t\t\t\tmeta: \"image\",\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t// REFRESH\n\n\trefresh(docname) {\n\t\tvar switched = docname ? true : false;\n\n\t\tremoveEventListener(\"beforeunload\", this.beforeUnloadListener, { capture: true });\n\n\t\tif (docname) {\n\t\t\tthis.switch_doc(docname);\n\t\t}\n\n\t\tcur_frm = this;\n\n\t\tthis.undo_manager.erase_history();\n\n\t\tif (this.docname) {\n\t\t\t// document to show\n\t\t\tthis.save_disabled = false;\n\t\t\t// set the doc\n\t\t\tthis.doc = frappe.get_doc(this.doctype, this.docname);\n\n\t\t\t// check permissions\n\t\t\tthis.fetch_permissions();\n\t\t\tif (!this.has_read_permission()) {\n\t\t\t\tfrappe.show_not_permitted(__(this.doctype) + \" \" + __(cstr(this.docname)));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// update grids with new permissions\n\t\t\tthis.grids.forEach((table) => {\n\t\t\t\ttable.grid.refresh();\n\t\t\t});\n\n\t\t\t// read only (workflow)\n\t\t\tthis.read_only = frappe.workflow.is_read_only(this.doctype, this.docname);\n\t\t\tif (this.read_only) {\n\t\t\t\tthis.set_read_only(true);\n\t\t\t\tfrappe.show_alert(__(\"This form is not editable due to a Workflow.\"));\n\t\t\t}\n\n\t\t\t// check if doctype is already open\n\t\t\tif (!this.opendocs[this.docname]) {\n\t\t\t\tthis.check_doctype_conflict(this.docname);\n\t\t\t} else {\n\t\t\t\tif (this.check_reload()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// do setup\n\t\t\tif (!this.setup_done) {\n\t\t\t\tthis.setup();\n\t\t\t}\n\n\t\t\t// load the record for the first time, if not loaded (call 'onload')\n\t\t\tthis.trigger_onload(switched);\n\n\t\t\t// if print format is shown, refresh the format\n\t\t\t// if(this.print_preview.wrapper.is(\":visible\")) {\n\t\t\t// \tthis.print_preview.preview();\n\t\t\t// }\n\n\t\t\tif (switched) {\n\t\t\t\tif (this.show_print_first && this.doc.docstatus === 1) {\n\t\t\t\t\t// show print view\n\t\t\t\t\tthis.print_doc();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set status classes\n\t\t\tthis.$wrapper\n\t\t\t\t.removeClass(\"validated-form\")\n\t\t\t\t.toggleClass(\"editable-form\", this.doc.docstatus === 0)\n\t\t\t\t.toggleClass(\"submitted-form\", this.doc.docstatus === 1)\n\t\t\t\t.toggleClass(\"cancelled-form\", this.doc.docstatus === 2);\n\n\t\t\tthis.show_conflict_message();\n\n\t\t\tif (frappe.boot.read_only) {\n\t\t\t\tthis.disable_form();\n\t\t\t}\n\t\t}\n\t}\n\n\t// sets up the refresh event for custom buttons\n\t// added via configuration\n\tsetup_doctype_actions() {\n\t\tif (this.meta.actions) {\n\t\t\tfor (let action of this.meta.actions) {\n\t\t\t\tfrappe.ui.form.on(this.doctype, \"refresh\", () => {\n\t\t\t\t\tif (!this.is_new()) {\n\t\t\t\t\t\tif (!action.hidden) {\n\t\t\t\t\t\t\tthis.add_custom_button(\n\t\t\t\t\t\t\t\taction.label,\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tthis.execute_action(action);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\taction.group\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\texecute_action(action) {\n\t\tif (typeof action === \"string\") {\n\t\t\t// called by label - maybe via custom script\n\t\t\t// frm.execute_action('Action')\n\t\t\tfor (let _action of this.meta.actions) {\n\t\t\t\tif (_action.label === action) {\n\t\t\t\t\taction = _action;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof action === \"string\") {\n\t\t\t\tfrappe.throw(`Action ${action} not found`);\n\t\t\t}\n\t\t}\n\t\tif (action.action_type === \"Server Action\") {\n\t\t\treturn frappe.xcall(action.action, { doc: this.doc }).then((doc) => {\n\t\t\t\tif (doc.doctype) {\n\t\t\t\t\t// document is returned by the method,\n\t\t\t\t\t// apply the changes locally and refresh\n\t\t\t\t\tfrappe.model.sync(doc);\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\n\t\t\t\t// feedback\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: __(\"{} Complete\", [action.label]),\n\t\t\t\t\talert: true,\n\t\t\t\t});\n\t\t\t});\n\t\t} else if (action.action_type === \"Route\") {\n\t\t\treturn frappe.set_route(action.action);\n\t\t}\n\t}\n\n\tswitch_doc(docname) {\n\t\t// reset visible columns, since column headings can change in different docs\n\t\tthis.grids.forEach((grid_obj) => {\n\t\t\tgrid_obj.grid.visible_columns = null;\n\t\t\t// reset page number to 1\n\t\t\tgrid_obj.grid.grid_pagination.go_to_page(1, true);\n\t\t});\n\t\tfrappe.ui.form.close_grid_form();\n\t\tthis.viewers && this.viewers.parent.empty();\n\t\tthis.docname = docname;\n\t\tthis.setup_docinfo_change_listener();\n\t}\n\n\tcheck_reload() {\n\t\tif (\n\t\t\tthis.doc &&\n\t\t\t!this.doc.__unsaved &&\n\t\t\tthis.doc.__last_sync_on &&\n\t\t\tnew Date() - this.doc.__last_sync_on > this.refresh_if_stale_for * 1000\n\t\t) {\n\t\t\tthis.debounced_reload_doc();\n\t\t\treturn true;\n\t\t}\n\t}\n\n\ttrigger_onload(switched) {\n\t\tthis.cscript.is_onload = false;\n\t\tif (!this.opendocs[this.docname]) {\n\t\t\tvar me = this;\n\t\t\tthis.cscript.is_onload = true;\n\t\t\tthis.initialize_new_doc();\n\t\t\t$(document).trigger(\"form-load\", [this]);\n\t\t\t$(this.page.wrapper).on(\"hide\", function () {\n\t\t\t\t$(document).trigger(\"form-unload\", [me]);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.render_form(switched);\n\t\t\tif (this.doc.localname) {\n\t\t\t\t// trigger form-rename and remove .localname\n\t\t\t\tdelete this.doc.localname;\n\t\t\t\t$(document).trigger(\"form-rename\", [this]);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitialize_new_doc() {\n\t\tvar me = this;\n\n\t\t// hide any open grid\n\t\tthis.script_manager.trigger(\"before_load\", this.doctype, this.docname).then(() => {\n\t\t\tme.script_manager.trigger(\"onload\");\n\t\t\tme.opendocs[me.docname] = true;\n\t\t\tme.render_form();\n\n\t\t\tfrappe.after_ajax(function () {\n\t\t\t\tme.trigger_link_fields();\n\t\t\t});\n\n\t\t\tfrappe.breadcrumbs.add(me.meta.module, me.doctype);\n\t\t});\n\n\t\t// update seen\n\t\tif (this.meta.track_seen) {\n\t\t\t$('.list-id[data-name=\"' + me.docname + '\"]').addClass(\"seen\");\n\t\t}\n\t}\n\n\trender_form(switched) {\n\t\tif (!this.meta.istable) {\n\t\t\tthis.layout.doc = this.doc;\n\t\t\tthis.layout.attach_doc_and_docfields();\n            \n            // customization\n                // if (frappe.boot.desk_settings.form_sidebar) {\n                // \tthis.sidebar = new frappe.ui.form.Sidebar({\n                // \t\tfrm: this,\n                // \t\tpage: this.page,\n                // \t});\n                // \tthis.sidebar.make();\n                // }\n            // customization end\n\n\t\t\t// clear layout message\n\t\t\tthis.layout.show_message();\n\n\t\t\tfrappe.run_serially([\n\t\t\t\t// header must be refreshed before client methods\n\t\t\t\t// because add_custom_button\n\t\t\t\t() => this.refresh_header(switched),\n\t\t\t\t// trigger global trigger\n\t\t\t\t// to use this\n\t\t\t\t() => $(document).trigger(\"form-refresh\", [this]),\n\t\t\t\t// fields\n\t\t\t\t() => this.refresh_fields(),\n\t\t\t\t// call trigger\n\t\t\t\t() => this.script_manager.trigger(\"refresh\"),\n\t\t\t\t// call onload post render for callbacks to be fired\n\t\t\t\t() => {\n\t\t\t\t\tif (this.cscript.is_onload) {\n\t\t\t\t\t\tthis.onload_post_render();\n\t\t\t\t\t\treturn this.script_manager.trigger(\"onload_post_render\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t() => this.cscript.is_onload && this.is_new() && this.focus_on_first_input(),\n\t\t\t\t() => this.run_after_load_hook(),\n\t\t\t\t() => this.dashboard.after_refresh(),\n\t\t\t]);\n\t\t} else {\n\t\t\tthis.refresh_header(switched);\n\t\t}\n\n\t\tthis.$wrapper.trigger(\"render_complete\");\n\n\t\tfrappe.after_ajax(() => {\n\t\t\t$(document).ready(() => {\n\t\t\t\tthis.scroll_to_element();\n\t\t\t});\n\t\t});\n\t}\n\n\tonload_post_render() {\n\t\tthis.setup_image_autocompletions_in_markdown();\n\t}\n\n\tfocus_on_first_input() {\n\t\tlet first = this.form_wrapper.find(\".form-layout :input:visible:first\");\n\t\tif (!in_list([\"Date\", \"Datetime\"], first.attr(\"data-fieldtype\"))) {\n\t\t\tfirst.focus();\n\t\t}\n\t}\n\n\trun_after_load_hook() {\n\t\tif (frappe.route_hooks.after_load) {\n\t\t\tlet route_callback = frappe.route_hooks.after_load;\n\t\t\tdelete frappe.route_hooks.after_load;\n\n\t\t\troute_callback(this);\n\t\t}\n\t}\n\n\trefresh_fields() {\n\t\tthis.layout.refresh(this.doc);\n\t\tthis.layout.primary_button = this.$wrapper.find(\".btn-primary\");\n\n\t\t// cleanup activities after refresh\n\t\tthis.cleanup_refresh(this);\n\t}\n\n\tcleanup_refresh() {\n\t\tif (this.fields_dict[\"amended_from\"]) {\n\t\t\tif (this.doc.amended_from) {\n\t\t\t\tunhide_field(\"amended_from\");\n\t\t\t\tif (this.fields_dict[\"amendment_date\"]) unhide_field(\"amendment_date\");\n\t\t\t} else {\n\t\t\t\thide_field(\"amended_from\");\n\t\t\t\tif (this.fields_dict[\"amendment_date\"]) hide_field(\"amendment_date\");\n\t\t\t}\n\t\t}\n\n\t\tif (this.fields_dict[\"trash_reason\"]) {\n\t\t\tif (this.doc.trash_reason && this.doc.docstatus == 2) {\n\t\t\t\tunhide_field(\"trash_reason\");\n\t\t\t} else {\n\t\t\t\thide_field(\"trash_reason\");\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tthis.meta.autoname &&\n\t\t\tthis.meta.autoname.substr(0, 6) == \"field:\" &&\n\t\t\t!this.doc.__islocal\n\t\t) {\n\t\t\tvar fn = this.meta.autoname.substr(6);\n\n\t\t\tif (this.doc[fn]) {\n\t\t\t\tthis.toggle_display(fn, false);\n\t\t\t}\n\t\t}\n\n\t\tif (this.meta.autoname == \"naming_series:\" && !this.doc.__islocal) {\n\t\t\tthis.toggle_display(\"naming_series\", false);\n\t\t}\n\t}\n\n\trefresh_header(switched) {\n\t\t// set title\n\t\t// main title\n\t\tif (!this.meta.in_dialog || this.in_form) {\n\t\t\tfrappe.utils.set_title(this.meta.issingle ? this.doctype : this.docname);\n\t\t}\n\n\t\t// show / hide buttons\n\t\tif (this.toolbar) {\n\t\t\tif (switched) {\n\t\t\t\tthis.toolbar.current_status = undefined;\n\t\t\t}\n\t\t\tthis.toolbar.refresh();\n\t\t}\n\n\t\tthis.dashboard.refresh();\n\t\tfrappe.breadcrumbs.update();\n\n\t\tthis.show_submit_message();\n\t\tthis.clear_custom_buttons();\n\t\tthis.show_web_link();\n\t}\n\n\t// SAVE\n\n\tsave_or_update() {\n\t\tif (this.save_disabled) return;\n\n\t\tif (this.doc.docstatus === 0) {\n\t\t\tthis.save();\n\t\t} else if (this.doc.docstatus === 1 && this.doc.__unsaved) {\n\t\t\tthis.save(\"Update\");\n\t\t}\n\t}\n\n\tsave(save_action, callback, btn, on_error) {\n\t\tlet me = this;\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tbtn && $(btn).prop(\"disabled\", true);\n\t\t\tfrappe.ui.form.close_grid_form();\n\t\t\tme.validate_and_save(save_action, callback, btn, on_error, resolve, reject);\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tme.show_success_action();\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tconsole.error(e); // eslint-disable-line\n\t\t\t});\n\t}\n\n\tvalidate_and_save(save_action, callback, btn, on_error, resolve, reject) {\n\t\tvar me = this;\n\t\tif (!save_action) save_action = \"Save\";\n\t\tthis.validate_form_action(save_action, resolve);\n\n\t\tvar after_save = function (r) {\n\t\t\t// to remove hash from URL to avoid scroll after save\n\t\t\thistory.replaceState(null, null, \" \");\n\t\t\tif (!r.exc) {\n\t\t\t\tif ([\"Save\", \"Update\", \"Amend\"].indexOf(save_action) !== -1) {\n\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t\t}\n\n\t\t\t\tme.script_manager.trigger(\"after_save\");\n\n\t\t\t\tif (frappe.route_hooks.after_save) {\n\t\t\t\t\tlet route_callback = frappe.route_hooks.after_save;\n\t\t\t\t\tdelete frappe.route_hooks.after_save;\n\n\t\t\t\t\troute_callback(me);\n\t\t\t\t}\n\t\t\t\t// submit comment if entered\n\t\t\t\tif (me.comment_box) {\n\t\t\t\t\tme.comment_box.submit();\n\t\t\t\t}\n\t\t\t\tme.refresh();\n\t\t\t} else {\n\t\t\t\tif (on_error) {\n\t\t\t\t\ton_error();\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t}\n\t\t\tcallback && callback(r);\n\t\t\tresolve();\n\t\t};\n\n\t\tvar fail = (e) => {\n\t\t\tif (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t\tbtn && $(btn).prop(\"disabled\", false);\n\t\t\tif (on_error) {\n\t\t\t\ton_error();\n\t\t\t\treject();\n\t\t\t}\n\t\t};\n\n\t\tif (save_action != \"Update\") {\n\t\t\t// validate\n\t\t\tfrappe.validated = true;\n\t\t\tfrappe\n\t\t\t\t.run_serially([\n\t\t\t\t\t() => this.script_manager.trigger(\"validate\"),\n\t\t\t\t\t() => this.script_manager.trigger(\"before_save\"),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tif (!frappe.validated) {\n\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t\t.catch(fail);\n\t\t} else {\n\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t}\n\t}\n\n\tsavesubmit(btn, callback, on_error) {\n\t\tvar me = this;\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.validate_form_action(\"Submit\");\n\t\t\tfrappe.confirm(\n\t\t\t\t__(\"Permanently Submit {0}?\", [this.docname]),\n\t\t\t\tfunction () {\n\t\t\t\t\tfrappe.validated = true;\n\t\t\t\t\tme.script_manager.trigger(\"before_submit\").then(function () {\n\t\t\t\t\t\tif (!frappe.validated) {\n\t\t\t\t\t\t\treturn me.handle_save_fail(btn, on_error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.save(\n\t\t\t\t\t\t\t\"Submit\",\n\t\t\t\t\t\t\tfunction (r) {\n\t\t\t\t\t\t\t\tif (r.exc) {\n\t\t\t\t\t\t\t\t\tme.handle_save_fail(btn, on_error);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\t\t\t\tme.script_manager\n\t\t\t\t\t\t\t\t\t\t.trigger(\"on_submit\")\n\t\t\t\t\t\t\t\t\t\t.then(() => resolve(me))\n\t\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\t\tif (frappe.route_hooks.after_submit) {\n\t\t\t\t\t\t\t\t\t\t\t\tlet route_callback =\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.route_hooks.after_submit;\n\t\t\t\t\t\t\t\t\t\t\t\tdelete frappe.route_hooks.after_submit;\n\t\t\t\t\t\t\t\t\t\t\t\troute_callback(me);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbtn,\n\t\t\t\t\t\t\t() => me.handle_save_fail(btn, on_error),\n\t\t\t\t\t\t\tresolve\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t() => me.handle_save_fail(btn, on_error)\n\t\t\t);\n\t\t});\n\t}\n\n\tsavecancel(btn, callback, on_error) {\n\t\tconst me = this;\n\t\tthis.validate_form_action(\"Cancel\");\n\t\tme.ignore_doctypes_on_cancel_all = me.ignore_doctypes_on_cancel_all || [];\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: \"frappe.desk.form.linked_with.get_submitted_linked_docs\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.doc.doctype,\n\t\t\t\t\tname: me.doc.name,\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tlet doctypes_to_cancel = (r.message.docs || [])\n\t\t\t\t\t\t.map((value) => {\n\t\t\t\t\t\t\treturn value.doctype;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.filter((value) => {\n\t\t\t\t\t\t\treturn !me.ignore_doctypes_on_cancel_all.includes(value);\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (doctypes_to_cancel.length) {\n\t\t\t\t\t\treturn me._cancel_all(r, btn, callback, on_error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn me._cancel(btn, callback, on_error, false);\n\t\t\t});\n\t}\n\n\t_cancel_all(r, btn, callback, on_error) {\n\t\tconst me = this;\n\n\t\t// add confirmation message for cancelling all linked docs\n\t\tlet links_text = \"\";\n\t\tlet links = r.message.docs;\n\t\tconst doctypes = Array.from(new Set(links.map((link) => link.doctype)));\n\n\t\tme.ignore_doctypes_on_cancel_all = me.ignore_doctypes_on_cancel_all || [];\n\n\t\tfor (let doctype of doctypes) {\n\t\t\tif (!me.ignore_doctypes_on_cancel_all.includes(doctype)) {\n\t\t\t\tlet docnames = links\n\t\t\t\t\t.filter((link) => link.doctype == doctype)\n\t\t\t\t\t.map((link) => frappe.utils.get_form_link(link.doctype, link.name, true))\n\t\t\t\t\t.join(\", \");\n\t\t\t\tlinks_text += `<li><strong>${__(doctype)}</strong>: ${docnames}</li>`;\n\t\t\t}\n\t\t}\n\t\tlinks_text = `<ul>${links_text}</ul>`;\n\n\t\tlet confirm_message = __(\"{0} {1} is linked with the following submitted documents: {2}\", [\n\t\t\t__(me.doc.doctype).bold(),\n\t\t\tme.doc.name,\n\t\t\tlinks_text,\n\t\t]);\n\n\t\tlet can_cancel = links.every((link) => frappe.model.can_cancel(link.doctype));\n\t\tif (can_cancel) {\n\t\t\tconfirm_message += __(\"Do you want to cancel all linked documents?\");\n\t\t} else {\n\t\t\tconfirm_message += __(\"You do not have permissions to cancel all linked documents.\");\n\t\t}\n\n\t\t// generate dialog box to cancel all linked docs\n\t\tlet d = new frappe.ui.Dialog(\n\t\t\t{\n\t\t\t\ttitle: __(\"Cancel All Documents\"),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\t\t\toptions: `<p class=\"frappe-confirm-message\">${confirm_message}</p>`,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t() => me.handle_save_fail(btn, on_error)\n\t\t);\n\n\t\t// if user can cancel all linked docs, add action to the dialog\n\t\tif (can_cancel) {\n\t\t\td.set_primary_action(__(\"Cancel All\"), () => {\n\t\t\t\td.hide();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.desk.form.linked_with.cancel_all_linked_docs\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdocs: links,\n\t\t\t\t\t\tignore_doctypes_on_cancel_all: me.ignore_doctypes_on_cancel_all || [],\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: (resp) => {\n\t\t\t\t\t\tif (!resp.exc) {\n\t\t\t\t\t\t\tme.reload_doc();\n\t\t\t\t\t\t\tme._cancel(btn, callback, on_error, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\td.show();\n\t}\n\n\t_cancel(btn, callback, on_error, skip_confirm) {\n\t\tconst me = this;\n\t\tconst cancel_doc = () => {\n\t\t\tfrappe.validated = true;\n\t\t\tme.script_manager.trigger(\"before_cancel\").then(() => {\n\t\t\t\tif (!frappe.validated) {\n\t\t\t\t\treturn me.handle_save_fail(btn, on_error);\n\t\t\t\t}\n\n\t\t\t\tvar after_cancel = function (r) {\n\t\t\t\t\tif (r.exc) {\n\t\t\t\t\t\tme.handle_save_fail(btn, on_error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\tme.script_manager.trigger(\"after_cancel\");\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tfrappe.ui.form.save(me, \"cancel\", after_cancel, btn);\n\t\t\t});\n\t\t};\n\n\t\tif (skip_confirm) {\n\t\t\tcancel_doc();\n\t\t} else {\n\t\t\tfrappe.confirm(\n\t\t\t\t__(\"Permanently Cancel {0}?\", [this.docname]),\n\t\t\t\tcancel_doc,\n\t\t\t\tme.handle_save_fail(btn, on_error)\n\t\t\t);\n\t\t}\n\t}\n\n\tsavetrash() {\n\t\tthis.validate_form_action(\"Delete\");\n\t\tfrappe.model.delete_doc(this.doctype, this.docname, function () {\n\t\t\twindow.history.back();\n\t\t});\n\t}\n\n\tamend_doc() {\n\t\tif (!this.fields_dict[\"amended_from\"]) {\n\t\t\tfrappe.msgprint(__('\"amended_from\" field must be present to do an amendment.'));\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe\n\t\t\t.xcall(\"frappe.client.is_document_amended\", {\n\t\t\t\tdoctype: this.doc.doctype,\n\t\t\t\tdocname: this.doc.name,\n\t\t\t})\n\t\t\t.then((is_amended) => {\n\t\t\t\tif (is_amended) {\n\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t__(\"This document is already amended, you cannot ammend it again\")\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthis.validate_form_action(\"Amend\");\n\t\t\t\tvar me = this;\n\t\t\t\tvar fn = function (newdoc) {\n\t\t\t\t\tnewdoc.amended_from = me.docname;\n\t\t\t\t\tif (me.fields_dict && me.fields_dict[\"amendment_date\"])\n\t\t\t\t\t\tnewdoc.amendment_date = frappe.datetime.obj_to_str(new Date());\n\t\t\t\t};\n\t\t\t\tthis.copy_doc(fn, 1);\n\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t});\n\t}\n\n\tvalidate_form_action(action, resolve) {\n\t\tvar perm_to_check = this.action_perm_type_map[action];\n\t\tvar allowed_for_workflow = false;\n\t\tvar perms = frappe.perm.get_perm(this.doc.doctype)[0];\n\n\t\t// Allow submit, write, cancel and create permissions for read only documents that are assigned by\n\t\t// workflows if the user already have those permissions. This is to allow for users to\n\t\t// continue through the workflow states and to allow execution of functions like Duplicate.\n\t\tif (\n\t\t\t(frappe.workflow.is_read_only(this.doctype, this.docname) &&\n\t\t\t\t(perms[\"write\"] || perms[\"create\"] || perms[\"submit\"] || perms[\"cancel\"])) ||\n\t\t\t!frappe.workflow.is_read_only(this.doctype, this.docname)\n\t\t) {\n\t\t\tallowed_for_workflow = true;\n\t\t}\n\n\t\tif (!this.perm[0][perm_to_check] && !allowed_for_workflow) {\n\t\t\tif (resolve) {\n\t\t\t\t// re-enable buttons\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tfrappe.throw(\n\t\t\t\t__(\n\t\t\t\t\t\"No permission to '{0}' {1}\",\n\t\t\t\t\t[__(action), __(this.doc.doctype)],\n\t\t\t\t\t\"{0} = verb, {1} = object\"\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\t// HELPERS\n\n\tenable_save() {\n\t\tthis.save_disabled = false;\n\t\tthis.toolbar.set_primary_action();\n\t}\n\n\tdisable_save(set_dirty = false) {\n\t\t// IMPORTANT: this function should be called in refresh event\n\t\tthis.save_disabled = true;\n\t\tthis.toolbar.current_status = null;\n\t\t// field changes should make form dirty\n\t\tthis.set_dirty = set_dirty;\n\t\tthis.page.clear_primary_action();\n\t}\n\n\tdisable_form() {\n\t\tthis.set_read_only();\n\t\tthis.fields.forEach((field) => {\n\t\t\tthis.set_df_property(field.df.fieldname, \"read_only\", \"1\");\n\t\t});\n\t\tthis.disable_save();\n\t}\n\n\thandle_save_fail(btn, on_error) {\n\t\t$(btn).prop(\"disabled\", false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t}\n\n\ttrigger_link_fields() {\n\t\t// trigger link fields which have default values set\n\t\tif (this.is_new() && this.doc.__run_link_triggers) {\n\t\t\t$.each(this.fields_dict, function (fieldname, field) {\n\t\t\t\tif (field.df.fieldtype == \"Link\" && this.doc[fieldname]) {\n\t\t\t\t\t// triggers add fetch, sets value in model and runs triggers\n\t\t\t\t\tfield.set_value(this.doc[fieldname], true);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete this.doc.__run_link_triggers;\n\t\t}\n\t}\n\n\tshow_conflict_message() {\n\t\tif (this.doc.__needs_refresh) {\n\t\t\tif (this.doc.__unsaved) {\n\t\t\t\tthis.dashboard.clear_headline();\n\t\t\t\tthis.dashboard.set_headline_alert(\n\t\t\t\t\t__(\"This form has been modified after you have loaded it\") +\n\t\t\t\t\t\t'<button class=\"btn btn-xs btn-primary pull-right\" onclick=\"cur_frm.reload_doc()\">' +\n\t\t\t\t\t\t__(\"Refresh\") +\n\t\t\t\t\t\t\"</button>\",\n\t\t\t\t\t\"alert-warning\"\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthis.debounced_reload_doc();\n\t\t\t}\n\t\t}\n\t}\n\n\tshow_submit_message() {\n\t\tif (\n\t\t\tthis.meta.is_submittable &&\n\t\t\tthis.perm[0] &&\n\t\t\tthis.perm[0].submit &&\n\t\t\t!this.is_dirty() &&\n\t\t\t!this.is_new() &&\n\t\t\t!frappe.model.has_workflow(this.doctype) && // show only if no workflow\n\t\t\tthis.doc.docstatus === 0\n\t\t) {\n\t\t\tthis.dashboard.add_comment(__(\"Submit this document to confirm\"), \"blue\", true);\n\t\t}\n\t}\n\n\tshow_web_link() {\n\t\tif (!this.doc.__islocal && this.doc.__onload && this.doc.__onload.is_website_generator) {\n\t\t\tthis.web_link && this.web_link.remove();\n\t\t\tif (this.doc.__onload.published) {\n\t\t\t\tthis.add_web_link(\"/\" + this.doc.route);\n\t\t\t}\n\t\t}\n\t}\n\n\tadd_web_link(path, label) {\n\t\tlabel = __(label) || __(\"See on Website\");\n\t\tthis.web_link = this.sidebar\n\t\t\t.add_user_action(__(label), function () {})\n\t\t\t.attr(\"href\", path || this.doc.route)\n\t\t\t.attr(\"target\", \"_blank\");\n\t}\n\n\tfetch_permissions() {\n\t\tlet dt = this.parent_doctype ? this.parent_doctype : this.doctype;\n\t\tthis.perm = frappe.perm.get_perm(dt, this.doc);\n\t}\n\n\thas_read_permission() {\n\t\tif (!this.perm[0].read) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn 1;\n\t}\n\n\tcheck_doctype_conflict(docname) {\n\t\tif (this.doctype == \"DocType\" && docname == \"DocType\") {\n\t\t\tfrappe.msgprint(__(\"Allowing DocType, DocType. Be careful!\"));\n\t\t} else if (this.doctype == \"DocType\") {\n\t\t\tif (frappe.views.formview[docname] || frappe.pages[\"List/\" + docname]) {\n\t\t\t\twindow.location.reload();\n\t\t\t\t//\tfrappe.msgprint(__(\"Cannot open {0} when its instance is open\", ['DocType']))\n\t\t\t\t// throw 'doctype open conflict'\n\t\t\t}\n\t\t} else {\n\t\t\tif (\n\t\t\t\tfrappe.views.formview.DocType &&\n\t\t\t\tfrappe.views.formview.DocType.frm.opendocs[this.doctype]\n\t\t\t) {\n\t\t\t\twindow.location.reload();\n\t\t\t\t//\tfrappe.msgprint(__(\"Cannot open instance when its {0} is open\", ['DocType']))\n\t\t\t\t// throw 'doctype open conflict'\n\t\t\t}\n\t\t}\n\t}\n\n\t// rename the form\n\t// notify this form of renamed records\n\trename_notify(dt, old, name) {\n\t\t// from form\n\t\tif (this.meta.istable) return;\n\n\t\tif (this.docname == old) this.docname = name;\n\t\telse return;\n\n\t\t// cleanup\n\t\tif (this && this.opendocs[old] && frappe.meta.docfield_copy[dt]) {\n\t\t\t// delete docfield copy\n\t\t\tfrappe.meta.docfield_copy[dt][name] = frappe.meta.docfield_copy[dt][old];\n\t\t\tdelete frappe.meta.docfield_copy[dt][old];\n\t\t}\n\n\t\tdelete this.opendocs[old];\n\t\tthis.opendocs[name] = true;\n\n\t\tif (this.meta.in_dialog || !this.in_form) {\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.re_route[frappe.router.get_sub_path()] = `${encodeURIComponent(\n\t\t\tfrappe.router.slug(this.doctype)\n\t\t)}/${encodeURIComponent(name)}`;\n\t\t!frappe._from_link && frappe.set_route(\"Form\", this.doctype, name);\n\t}\n\n\t// ACTIONS\n\n\tprint_doc() {\n\t\tfrappe.route_options = {\n\t\t\tfrm: this,\n\t\t};\n\t\tfrappe.set_route(\"print\", this.doctype, this.doc.name);\n\t}\n\n\tnavigate_records(prev) {\n\t\tlet filters, sort_field, sort_order;\n\t\tlet list_view = frappe.get_list_view(this.doctype);\n\t\tif (list_view) {\n\t\t\tfilters = list_view.get_filters_for_args();\n\t\t\tsort_field = list_view.sort_by;\n\t\t\tsort_order = list_view.sort_order;\n\t\t} else {\n\t\t\tlet list_settings = frappe.get_user_settings(this.doctype)[\"List\"];\n\t\t\tif (list_settings) {\n\t\t\t\tfilters = list_settings.filters;\n\t\t\t\tsort_field = list_settings.sort_by;\n\t\t\t\tsort_order = list_settings.sort_order;\n\t\t\t}\n\t\t}\n\n\t\tlet args = {\n\t\t\tdoctype: this.doctype,\n\t\t\tvalue: this.docname,\n\t\t\tfilters,\n\t\t\tsort_order,\n\t\t\tsort_field,\n\t\t\tprev,\n\t\t};\n\n\t\tfrappe.call(\"frappe.desk.form.utils.get_next\", args).then((r) => {\n\t\t\tif (r.message) {\n\t\t\t\tfrappe.set_route(\"Form\", this.doctype, r.message);\n\t\t\t\tthis.focus_on_first_input();\n\t\t\t}\n\t\t});\n\t}\n\n\trename_doc() {\n\t\tfrappe.model.rename_doc(this.doctype, this.docname, () => this.refresh_header());\n\t}\n\n\tshare_doc() {\n\t\tthis.shared.show();\n\t}\n\n\temail_doc(message) {\n\t\tnew frappe.views.CommunicationComposer({\n\t\t\tdoc: this.doc,\n\t\t\tfrm: this,\n\t\t\tsubject: __(this.meta.name) + \": \" + this.docname,\n\t\t\trecipients: this.doc.email || this.doc.email_id || this.doc.contact_email,\n\t\t\tattach_document_print: true,\n\t\t\tmessage: message,\n\t\t});\n\t}\n\n\tcopy_doc(onload, from_amend) {\n\t\tthis.validate_form_action(\"Create\");\n\t\tvar newdoc = frappe.model.copy_doc(this.doc, from_amend);\n\n\t\tnewdoc.idx = null;\n\t\tnewdoc.__run_link_triggers = false;\n\t\tif (onload) {\n\t\t\tonload(newdoc);\n\t\t}\n\t\tfrappe.set_route(\"Form\", newdoc.doctype, newdoc.name);\n\t}\n\n\treload_doc() {\n\t\tthis.check_doctype_conflict(this.docname);\n\n\t\tif (!this.doc.__islocal) {\n\t\t\tfrappe.model.remove_from_locals(this.doctype, this.docname);\n\t\t\treturn frappe.model.with_doc(this.doctype, this.docname, () => {\n\t\t\t\tthis.refresh();\n\t\t\t});\n\t\t}\n\t}\n\n\trefresh_field(fname) {\n\t\tif (this.fields_dict[fname] && this.fields_dict[fname].refresh) {\n\t\t\tthis.fields_dict[fname].refresh();\n\t\t\tthis.layout.refresh_dependency();\n\t\t\tthis.layout.refresh_sections();\n\t\t}\n\t}\n\n\t// UTILITIES\n\tadd_fetch(link_field, source_field, target_field, target_doctype) {\n\t\t/*\n\t\tExample fetch dict to get sender_email from email_id field in sender:\n\t\t\t{\n\t\t\t\t\"Notification\": {\n\t\t\t\t\t\"sender\": {\n\t\t\t\t\t\t\"sender_email\": \"email_id\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t*/\n\n\t\tif (!target_doctype) target_doctype = \"*\";\n\n\t\t// Target field kept as key because source field could be non-unique\n\t\tthis.fetch_dict.setDefault(target_doctype, {}).setDefault(link_field, {})[target_field] =\n\t\t\tsource_field;\n\t}\n\n\thas_perm(ptype) {\n\t\treturn frappe.perm.has_perm(this.doctype, 0, ptype, this.doc);\n\t}\n\n\tdirty() {\n\t\tthis.doc.__unsaved = 1;\n\t\tthis.$wrapper.trigger(\"dirty\");\n\t\tif (!frappe.boot.developer_mode) {\n\t\t\taddEventListener(\"beforeunload\", this.beforeUnloadListener, { capture: true });\n\t\t}\n\t}\n\n\tget_docinfo() {\n\t\treturn frappe.model.docinfo[this.doctype][this.docname];\n\t}\n\n\tis_dirty() {\n\t\treturn !!this.doc.__unsaved;\n\t}\n\n\tis_new() {\n\t\treturn this.doc.__islocal;\n\t}\n\n\tget_perm(permlevel, access_type) {\n\t\treturn this.perm[permlevel] ? this.perm[permlevel][access_type] : null;\n\t}\n\n\tset_intro(txt, color) {\n\t\tthis.dashboard.set_headline_alert(txt, color);\n\t}\n\n\tset_footnote(txt) {\n\t\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.body, txt);\n\t}\n\n\tadd_custom_button(label, fn, group) {\n\t\t// temp! old parameter used to be icon\n\t\tif (group && group.indexOf(\"fa fa-\") !== -1) group = null;\n\n\t\tlet btn = this.page.add_inner_button(label, fn, group);\n\n\t\tif (btn) {\n\t\t\t// Add actions as menu item in Mobile View\n\t\t\tlet menu_item_label = group ? `${group} > ${label}` : label;\n\t\t\tlet menu_item = this.page.add_menu_item(menu_item_label, fn, false);\n\t\t\tmenu_item.parent().addClass(\"hidden-xl\");\n\n\t\t\tthis.custom_buttons[label] = btn;\n\t\t}\n\t\treturn btn;\n\t}\n\n\tchange_custom_button_type(label, group, type) {\n\t\tthis.page.change_inner_button_type(label, group, type);\n\t}\n\n\tclear_custom_buttons() {\n\t\tthis.page.clear_inner_toolbar();\n\t\tthis.page.clear_user_actions();\n\t\tthis.custom_buttons = {};\n\t}\n\n\t//Remove specific custom button by button Label\n\tremove_custom_button(label, group) {\n\t\tthis.page.remove_inner_button(label, group);\n\t}\n\n\tscroll_to_element() {\n\t\tif (frappe.route_options && frappe.route_options.scroll_to) {\n\t\t\tvar scroll_to = frappe.route_options.scroll_to;\n\t\t\tdelete frappe.route_options.scroll_to;\n\n\t\t\tvar selector = [];\n\t\t\tfor (var key in scroll_to) {\n\t\t\t\tvar value = scroll_to[key];\n\t\t\t\tselector.push(repl('[data-%(key)s=\"%(value)s\"]', { key: key, value: value }));\n\t\t\t}\n\n\t\t\tselector = $(selector.join(\" \"));\n\t\t\tif (selector.length) {\n\t\t\t\tfrappe.utils.scroll_to(selector);\n\t\t\t}\n\t\t} else if (window.location.hash) {\n\t\t\tif ($(window.location.hash).length) {\n\t\t\t\tfrappe.utils.scroll_to(window.location.hash, true, 200, null, null, true);\n\t\t\t} else {\n\t\t\t\tthis.scroll_to_field(window.location.hash.replace(\"#\", \"\")) &&\n\t\t\t\t\thistory.replaceState(null, null, \" \");\n\t\t\t}\n\t\t}\n\t}\n\n\tshow_success_action() {\n\t\tconst route = frappe.get_route();\n\t\tif (route[0] !== \"Form\") return;\n\t\tif (this.meta.is_submittable && this.doc.docstatus !== 1) return;\n\n\t\tconst success_action = new frappe.ui.form.SuccessAction(this);\n\t\tsuccess_action.show();\n\t}\n\n\tget_doc() {\n\t\treturn locals[this.doctype][this.docname];\n\t}\n\n\tset_currency_labels(fields_list, currency, parentfield) {\n\t\t// To set the currency in the label\n\t\t// For example Total Cost(INR), Total Cost(USD)\n\t\tif (!currency) return;\n\t\tvar me = this;\n\t\tvar doctype = parentfield ? this.fields_dict[parentfield].grid.doctype : this.doc.doctype;\n\t\tvar field_label_map = {};\n\t\tvar grid_field_label_map = {};\n\n\t\t$.each(fields_list, function (i, fname) {\n\t\t\tvar docfield = frappe.meta.docfield_map[doctype][fname];\n\t\t\tif (docfield) {\n\t\t\t\tvar label = __(docfield.label || \"\").replace(/\\([^\\)]*\\)/g, \"\"); // eslint-disable-line\n\t\t\t\tif (parentfield) {\n\t\t\t\t\tgrid_field_label_map[doctype + \"-\" + fname] =\n\t\t\t\t\t\tlabel.trim() + \" (\" + __(currency) + \")\";\n\t\t\t\t} else {\n\t\t\t\t\tfield_label_map[fname] = label.trim() + \" (\" + currency + \")\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$.each(field_label_map, function (fname, label) {\n\t\t\tme.fields_dict[fname].set_label(label);\n\t\t});\n\n\t\t$.each(grid_field_label_map, function (fname, label) {\n\t\t\tfname = fname.split(\"-\");\n\t\t\tme.fields_dict[parentfield].grid.update_docfield_property(fname[1], \"label\", label);\n\t\t});\n\t}\n\n\tfield_map(fnames, fn) {\n\t\tif (typeof fnames === \"string\") {\n\t\t\tif (fnames == \"*\") {\n\t\t\t\tfnames = Object.keys(this.fields_dict);\n\t\t\t} else {\n\t\t\t\tfnames = [fnames];\n\t\t\t}\n\t\t}\n\t\tfor (var i = 0, l = fnames.length; i < l; i++) {\n\t\t\tvar fieldname = fnames[i];\n\t\t\tvar field = frappe.meta.get_docfield(this.doctype, fieldname, this.docname);\n\t\t\tif (field) {\n\t\t\t\tfn(field);\n\t\t\t\tthis.refresh_field(fieldname);\n\t\t\t}\n\t\t}\n\t}\n\n\tget_docfield(fieldname1, fieldname2) {\n\t\tif (fieldname2) {\n\t\t\t// for child\n\t\t\tvar doctype = this.get_docfield(fieldname1).options;\n\t\t\treturn frappe.meta.get_docfield(doctype, fieldname2, this.docname);\n\t\t} else {\n\t\t\t// for parent\n\t\t\treturn frappe.meta.get_docfield(this.doctype, fieldname1, this.docname);\n\t\t}\n\t}\n\n\tset_df_property(fieldname, property, value, docname, table_field, table_row_name = null) {\n\t\tlet df;\n\n\t\tif (!docname || !table_field) {\n\t\t\tdf = this.get_docfield(fieldname);\n\t\t} else {\n\t\t\tconst grid = this.fields_dict[fieldname].grid;\n\t\t\tconst filtered_fields = frappe.utils.filter_dict(grid.docfields, {\n\t\t\t\tfieldname: table_field,\n\t\t\t});\n\t\t\tif (filtered_fields.length) {\n\t\t\t\tdf = frappe.meta.get_docfield(\n\t\t\t\t\tfiltered_fields[0].parent,\n\t\t\t\t\ttable_field,\n\t\t\t\t\ttable_row_name\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (df && df[property] != value) {\n\t\t\tdf[property] = value;\n\n\t\t\tif (table_field && table_row_name) {\n\t\t\t\tif (this.fields_dict[fieldname].grid.grid_rows_by_docname[table_row_name]) {\n\t\t\t\t\tthis.fields_dict[fieldname].grid.grid_rows_by_docname[\n\t\t\t\t\t\ttable_row_name\n\t\t\t\t\t].refresh_field(fieldname);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.refresh_field(fieldname);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggle_enable(fnames, enable) {\n\t\tthis.field_map(fnames, function (field) {\n\t\t\tfield.read_only = enable ? 0 : 1;\n\t\t});\n\t}\n\n\ttoggle_reqd(fnames, mandatory) {\n\t\tthis.field_map(fnames, function (field) {\n\t\t\tfield.reqd = mandatory ? true : false;\n\t\t});\n\t}\n\n\ttoggle_display(fnames, show) {\n\t\tthis.field_map(fnames, function (field) {\n\t\t\tfield.hidden = show ? 0 : 1;\n\t\t});\n\t}\n\n\tget_files() {\n\t\treturn this.attachments\n\t\t\t? frappe.utils.sort(this.attachments.get_attachments(), \"file_name\", \"string\")\n\t\t\t: [];\n\t}\n\n\tset_query(fieldname, opt1, opt2) {\n\t\tif (opt2) {\n\t\t\t// on child table\n\t\t\t// set_query(fieldname, parent fieldname, query)\n\t\t\tthis.fields_dict[opt1].grid.get_field(fieldname).get_query = opt2;\n\t\t} else {\n\t\t\t// on parent table\n\t\t\t// set_query(fieldname, query)\n\t\t\tif (this.fields_dict[fieldname]) {\n\t\t\t\tthis.fields_dict[fieldname].get_query = opt1;\n\t\t\t}\n\t\t}\n\t}\n\n\tclear_table(fieldname) {\n\t\tfrappe.model.clear_table(this.doc, fieldname);\n\t}\n\n\tadd_child(fieldname, values) {\n\t\tvar doc = frappe.model.add_child(\n\t\t\tthis.doc,\n\t\t\tfrappe.meta.get_docfield(this.doctype, fieldname).options,\n\t\t\tfieldname\n\t\t);\n\t\tif (values) {\n\t\t\t// Values of unique keys should not be overridden\n\t\t\tvar d = {};\n\t\t\tvar unique_keys = [\"idx\", \"name\"];\n\n\t\t\tObject.keys(values).map((key) => {\n\t\t\t\tif (!unique_keys.includes(key)) {\n\t\t\t\t\td[key] = values[key];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.extend(doc, d);\n\t\t}\n\t\treturn doc;\n\t}\n\n\tset_value(field, value, if_missing, skip_dirty_trigger = false) {\n\t\tvar me = this;\n\t\tvar _set = function (f, v) {\n\t\t\tvar fieldobj = me.fields_dict[f];\n\t\t\tif (fieldobj) {\n\t\t\t\tif (!if_missing || !frappe.model.has_value(me.doctype, me.doc.name, f)) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tfrappe.model.table_fields.includes(fieldobj.df.fieldtype) &&\n\t\t\t\t\t\t$.isArray(v)\n\t\t\t\t\t) {\n\t\t\t\t\t\t// set entire child table from specified array as value\n\t\t\t\t\t\tfrappe.model.clear_table(me.doc, fieldobj.df.fieldname);\n\n\t\t\t\t\t\tconst standard_fields = [\n\t\t\t\t\t\t\t...frappe.model.std_fields_list,\n\t\t\t\t\t\t\t...frappe.model.child_table_field_list,\n\t\t\t\t\t\t];\n\t\t\t\t\t\tv.forEach((d, idx) => {\n\t\t\t\t\t\t\tlet child = frappe.model.add_child(\n\t\t\t\t\t\t\t\tme.doc,\n\t\t\t\t\t\t\t\tfieldobj.df.options,\n\t\t\t\t\t\t\t\tfieldobj.df.fieldname,\n\t\t\t\t\t\t\t\tidx + 1\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Don't set standard field, avoid mutating input too.\n\t\t\t\t\t\t\tlet doc_copy = { ...d };\n\t\t\t\t\t\t\tstandard_fields.forEach((field) => {\n\t\t\t\t\t\t\t\tdelete doc_copy[field];\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$.extend(child, doc_copy);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tme.refresh_field(f);\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn frappe.model.set_value(\n\t\t\t\t\t\t\tme.doctype,\n\t\t\t\t\t\t\tme.doc.name,\n\t\t\t\t\t\t\tf,\n\t\t\t\t\t\t\tv,\n\t\t\t\t\t\t\tme.fieldtype,\n\t\t\t\t\t\t\tskip_dirty_trigger\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfrappe.msgprint(__(\"Field {0} not found.\", [f]));\n\t\t\t\tthrow \"frm.set_value\";\n\t\t\t}\n\t\t};\n\n\t\tif (typeof field == \"string\") {\n\t\t\treturn _set(field, value);\n\t\t} else if ($.isPlainObject(field)) {\n\t\t\tlet tasks = [];\n\t\t\tfor (let f in field) {\n\t\t\t\tlet v = field[f];\n\t\t\t\tif (me.get_field(f)) {\n\t\t\t\t\ttasks.push(() => _set(f, v));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn frappe.run_serially(tasks);\n\t\t}\n\t}\n\n\tcall(opts, args, callback) {\n\t\tvar me = this;\n\t\tif (typeof opts === \"string\") {\n\t\t\t// called as frm.call('do_this', {with_arg: 'arg'});\n\t\t\topts = {\n\t\t\t\tmethod: opts,\n\t\t\t\tdoc: this.doc,\n\t\t\t\targs: args,\n\t\t\t\tcallback: callback,\n\t\t\t};\n\t\t}\n\t\tif (!opts.doc) {\n\t\t\tif (opts.method.indexOf(\".\") === -1)\n\t\t\t\topts.method = frappe.model.get_server_module_name(me.doctype) + \".\" + opts.method;\n\t\t\topts.original_callback = opts.callback;\n\t\t\topts.callback = function (r) {\n\t\t\t\tif ($.isPlainObject(r.message)) {\n\t\t\t\t\tif (opts.child) {\n\t\t\t\t\t\t// update child doc\n\t\t\t\t\t\topts.child = locals[opts.child.doctype][opts.child.name];\n\n\t\t\t\t\t\tvar std_field_list = [\"doctype\"]\n\t\t\t\t\t\t\t.concat(frappe.model.std_fields_list)\n\t\t\t\t\t\t\t.concat(frappe.model.child_table_field_list);\n\t\t\t\t\t\tfor (var key in r.message) {\n\t\t\t\t\t\t\tif (std_field_list.indexOf(key) === -1) {\n\t\t\t\t\t\t\t\topts.child[key] = r.message[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.fields_dict[opts.child.parentfield].refresh();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// update parent doc\n\t\t\t\t\t\tme.set_value(r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\topts.original_callback && opts.original_callback(r);\n\t\t\t};\n\t\t} else {\n\t\t\topts.original_callback = opts.callback;\n\t\t\topts.callback = function (r) {\n\t\t\t\tif (!r.exc) me.refresh_fields();\n\n\t\t\t\topts.original_callback && opts.original_callback(r);\n\t\t\t};\n\t\t}\n\t\treturn frappe.call(opts);\n\t}\n\n\tget_field(field) {\n\t\treturn this.fields_dict[field];\n\t}\n\n\tset_read_only() {\n\t\tconst docperms = frappe.perm.get_perm(this.doc.doctype);\n\t\tthis.perm = docperms.map((p) => {\n\t\t\treturn {\n\t\t\t\tread: p.read,\n\t\t\t\tcancel: p.cancel,\n\t\t\t\tshare: p.share,\n\t\t\t\tprint: p.print,\n\t\t\t\temail: p.email,\n\t\t\t};\n\t\t});\n\t}\n\n\ttrigger(event, doctype, docname) {\n\t\treturn this.script_manager.trigger(event, doctype, docname);\n\t}\n\n\tget_formatted(fieldname) {\n\t\treturn frappe.format(\n\t\t\tthis.doc[fieldname],\n\t\t\tfrappe.meta.get_docfield(this.doctype, fieldname, this.docname),\n\t\t\t{ no_icon: true },\n\t\t\tthis.doc\n\t\t);\n\t}\n\n\topen_grid_row() {\n\t\treturn frappe.ui.form.get_open_grid_form();\n\t}\n\n\tget_title() {\n\t\tif (this.meta.title_field) {\n\t\t\treturn this.doc[this.meta.title_field];\n\t\t} else {\n\t\t\treturn String(this.doc.name);\n\t\t}\n\t}\n\n\tget_selected() {\n\t\t// returns list of children that are selected. returns [parentfield, name] for each\n\t\tvar selected = {},\n\t\t\tme = this;\n\t\tfrappe.meta.get_table_fields(this.doctype).forEach(function (df) {\n\t\t\t// handle TableMultiselect child fields\n\t\t\tlet _selected = [];\n\n\t\t\tif (me.fields_dict[df.fieldname].grid) {\n\t\t\t\t_selected = me.fields_dict[df.fieldname].grid.get_selected();\n\t\t\t}\n\n\t\t\tif (_selected.length) {\n\t\t\t\tselected[df.fieldname] = _selected;\n\t\t\t}\n\t\t});\n\t\treturn selected;\n\t}\n\n\tset_indicator_formatter(fieldname, get_color, get_text) {\n\t\t// get doctype from parent\n\t\tvar doctype;\n\t\tif (frappe.meta.docfield_map[this.doctype][fieldname]) {\n\t\t\tdoctype = this.doctype;\n\t\t} else {\n\t\t\tfrappe.meta.get_table_fields(this.doctype).every(function (df) {\n\t\t\t\tif (frappe.meta.docfield_map[df.options][fieldname]) {\n\t\t\t\t\tdoctype = df.options;\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfrappe.meta.docfield_map[doctype][fieldname].formatter = function (\n\t\t\tvalue,\n\t\t\tdf,\n\t\t\toptions,\n\t\t\tdoc\n\t\t) {\n\t\t\tif (value) {\n\t\t\t\tvar label;\n\t\t\t\tif (get_text) {\n\t\t\t\t\tlabel = get_text(doc);\n\t\t\t\t} else if (frappe.form.link_formatters[df.options]) {\n\t\t\t\t\tlabel = frappe.form.link_formatters[df.options](value, doc);\n\t\t\t\t} else {\n\t\t\t\t\tlabel = value;\n\t\t\t\t}\n\n\t\t\t\tconst escaped_name = encodeURIComponent(value);\n\n\t\t\t\treturn `\n\t\t\t\t\t\t<a class=\"indicator ${get_color(doc || {})}\"\n\t\t\t\t\t\t\thref=\"/app/${frappe.router.slug(df.options)}/${escaped_name}\"\n\t\t\t\t\t\t\tdata-doctype=\"${df.options}\"\n\t\t\t\t\t\t\tdata-name=\"${frappe.utils.escape_html(value)}\">\n\t\t\t\t\t\t\t${label}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t`;\n\t\t\t} else {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t};\n\t}\n\n\tcan_create(doctype) {\n\t\t// return true or false if the user can make a particlar doctype\n\t\t// will check permission, `can_make_methods` if exists, or will decided on\n\t\t// basis of whether the document is submittable\n\t\tif (!frappe.model.can_create(doctype)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t\t// custom buttons are translated and so are the keys\n\t\t\tconst key = __(this.custom_make_buttons[doctype]);\n\t\t\t// if the button is present, then show make\n\t\t\treturn !!this.custom_buttons[key];\n\t\t}\n\n\t\tif (this.can_make_methods && this.can_make_methods[doctype]) {\n\t\t\treturn this.can_make_methods[doctype](this);\n\t\t} else {\n\t\t\tif (this.meta.is_submittable && !this.doc.docstatus == 1) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\tmake_new(doctype) {\n\t\t// make new doctype from the current form\n\t\t// will handover to `make_methods` if defined\n\t\t// or will create and match link fields\n\t\tlet me = this;\n\t\tif (this.make_methods && this.make_methods[doctype]) {\n\t\t\treturn this.make_methods[doctype](this);\n\t\t} else if (this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t\tthis.custom_buttons[__(this.custom_make_buttons[doctype])].trigger(\"click\");\n\t\t} else {\n\t\t\tfrappe.model.with_doctype(doctype, function () {\n\t\t\t\tlet new_doc = frappe.model.get_new_doc(doctype, null, null, true);\n\n\t\t\t\t// set link fields (if found)\n\t\t\t\tme.set_link_field(doctype, new_doc);\n\n\t\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t\t\t// frappe.set_route('Form', doctype, new_doc.name);\n\t\t\t});\n\t\t}\n\t}\n\n\tset_link_field(doctype, new_doc) {\n\t\tlet me = this;\n\t\tfrappe.get_meta(doctype).fields.forEach(function (df) {\n\t\t\tif (df.fieldtype === \"Link\" && df.options === me.doctype) {\n\t\t\t\tnew_doc[df.fieldname] = me.doc.name;\n\t\t\t} else if ([\"Link\", \"Dynamic Link\"].includes(df.fieldtype) && me.doc[df.fieldname]) {\n\t\t\t\tnew_doc[df.fieldname] = me.doc[df.fieldname];\n\t\t\t} else if (df.fieldtype === \"Table\" && df.options && df.reqd) {\n\t\t\t\tlet row = new_doc[df.fieldname][0];\n\t\t\t\tme.set_link_field(df.options, row);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate_in_all_rows(table_fieldname, fieldname, value) {\n\t\t// Update the `value` of the field named `fieldname` in all rows of the\n\t\t// child table named `table_fieldname`.\n\t\t// Do not overwrite existing values.\n\t\tif (value === undefined) return;\n\n\t\tfrappe.model\n\t\t\t.get_children(this.doc, table_fieldname)\n\t\t\t.filter((child) => !frappe.model.has_value(child.doctype, child.name, fieldname))\n\t\t\t.forEach((child) =>\n\t\t\t\tfrappe.model.set_value(child.doctype, child.name, fieldname, value)\n\t\t\t);\n\t}\n\n\tget_sum(table_fieldname, fieldname) {\n\t\tlet sum = 0;\n\t\tfor (let d of this.doc[table_fieldname] || []) {\n\t\t\tsum += d[fieldname];\n\t\t}\n\t\treturn sum;\n\t}\n\n\tscroll_to_field(fieldname, focus = true) {\n\t\tlet field = this.get_field(fieldname);\n\t\tif (!field) return;\n\n\t\tlet $el = field.$wrapper;\n\n\t\t// set tab as active\n\t\tif (field.tab && !field.tab.is_active()) {\n\t\t\tfield.tab.set_active();\n\t\t}\n\n\t\t// uncollapse section\n\t\tif (field.section.is_collapsed()) {\n\t\t\tfield.section.collapse(false);\n\t\t}\n\n\t\t// scroll to input\n\t\tfrappe.utils.scroll_to($el, true, 15);\n\n\t\t// focus if text field\n\t\tif (focus) {\n\t\t\t$el.find(\"input, select, textarea\").focus();\n\t\t}\n\n\t\t// highlight control inside field\n\t\tlet control_element = $el.closest(\".frappe-control\");\n\t\tcontrol_element.addClass(\"highlight\");\n\t\tsetTimeout(() => {\n\t\t\tcontrol_element.removeClass(\"highlight\");\n\t\t}, 2000);\n\t\treturn true;\n\t}\n\n\tsetup_docinfo_change_listener() {\n\t\tlet doctype = this.doctype;\n\t\tlet docname = this.docname;\n\n\t\tif (this.doc && !this.is_new()) {\n\t\t\tfrappe.socketio.doc_subscribe(doctype, docname);\n\t\t}\n\t\tfrappe.realtime.off(\"docinfo_update\");\n\t\tfrappe.realtime.on(\"docinfo_update\", ({ doc, key, action = \"update\" }) => {\n\t\t\tif (\n\t\t\t\t!doc.reference_doctype ||\n\t\t\t\t!doc.reference_name ||\n\t\t\t\tdoc.reference_doctype !== doctype ||\n\t\t\t\tdoc.reference_name !== docname\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet doc_list = frappe.model.docinfo[doctype][docname][key] || [];\n\t\t\tlet docindex = doc_list.findIndex((old_doc) => {\n\t\t\t\treturn old_doc.name === doc.name;\n\t\t\t});\n\n\t\t\tif (action === \"add\") {\n\t\t\t\tfrappe.model.docinfo[doctype][docname][key].push(doc);\n\t\t\t}\n\t\t\tif (docindex > -1) {\n\t\t\t\tif (action === \"update\") {\n\t\t\t\t\tfrappe.model.docinfo[doctype][docname][key].splice(docindex, 1, doc);\n\t\t\t\t}\n\t\t\t\tif (action === \"delete\") {\n\t\t\t\t\tfrappe.model.docinfo[doctype][docname][key].splice(docindex, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// no need to update timeline of owner of comment\n\t\t\t// gets handled via comment submit code\n\t\t\tif (\n\t\t\t\t!(\n\t\t\t\t\t[\"add\", \"update\"].includes(action) &&\n\t\t\t\t\tdoc.doctype === \"Comment\" &&\n\t\t\t\t\tdoc.owner === frappe.session.user\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tthis.timeline && this.timeline.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Filters fields from the reference doctype and sets them as options for a Select field\n\tset_fields_as_options(\n\t\tfieldname,\n\t\treference_doctype,\n\t\tfilter_function,\n\t\tdefault_options = [],\n\t\ttable_fieldname\n\t) {\n\t\tif (!reference_doctype) return Promise.resolve();\n\t\tlet options = default_options || [];\n\t\tif (!filter_function) filter_function = (f) => f;\n\t\treturn new Promise((resolve) => {\n\t\t\tfrappe.model.with_doctype(reference_doctype, () => {\n\t\t\t\tfrappe.get_meta(reference_doctype).fields.map((df) => {\n\t\t\t\t\tfilter_function(df) &&\n\t\t\t\t\t\toptions.push({ label: df.label || df.fieldname, value: df.fieldname });\n\t\t\t\t});\n\t\t\t\toptions &&\n\t\t\t\t\tthis.set_df_property(\n\t\t\t\t\t\tfieldname,\n\t\t\t\t\t\t\"options\",\n\t\t\t\t\t\toptions,\n\t\t\t\t\t\tthis.doc.name,\n\t\t\t\t\t\ttable_fieldname\n\t\t\t\t\t);\n\t\t\t\tresolve(options);\n\t\t\t});\n\t\t});\n\t}\n\tset_active_tab(tab) {\n\t\tif (!this.active_tab_map) {\n\t\t\tthis.active_tab_map = {};\n\t\t}\n\t\tthis.active_tab_map[this.docname] = tab;\n\t}\n\tget_active_tab() {\n\t\treturn this.active_tab_map && this.active_tab_map[this.docname];\n\t}\n\n\tget_involved_users() {\n\t\tlet user_fields = this.meta.fields\n\t\t\t.filter((d) => d.fieldtype === \"Link\" && d.options === \"User\")\n\t\t\t.map((d) => d.fieldname);\n\n\t\tuser_fields = [...user_fields, \"owner\", \"modified_by\"];\n\t\tlet involved_users = user_fields.map((field) => this.doc[field]);\n\n\t\tconst docinfo = this.get_docinfo();\n\n\t\tinvolved_users = involved_users.concat(\n\t\t\tdocinfo.communications.map((d) => d.sender && d.delivery_status === \"sent\"),\n\t\t\tdocinfo.comments.map((d) => d.owner),\n\t\t\tdocinfo.versions.map((d) => d.owner),\n\t\t\tdocinfo.assignments.map((d) => d.owner)\n\t\t);\n\n\t\treturn involved_users\n\t\t\t.uniqBy((u) => u)\n\t\t\t.filter((user) => ![\"Administrator\", frappe.session.user].includes(user))\n\t\t\t.filter(Boolean);\n\t}\n};\n\nfrappe.validated = 0;\n// Proxy for frappe.validated\nObject.defineProperty(window, \"validated\", {\n\tget: function () {\n\t\tconsole.warn(\n\t\t\t\"Please use `frappe.validated` instead of `validated`. It will be deprecated soon.\"\n\t\t); // eslint-disable-line\n\t\treturn frappe.validated;\n\t},\n\tset: function (value) {\n\t\tconsole.warn(\n\t\t\t\"Please use `frappe.validated` instead of `validated`. It will be deprecated soon.\"\n\t\t); // eslint-disable-line\n\t\tfrappe.validated = value;\n\t\treturn frappe.validated;\n\t},\n});\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n/* eslint-disable no-console */\n\nwindow.refresh_many = function (flist, dn, table_field) {\n\tfor (var i in flist) {\n\t\tif (table_field) refresh_field(flist[i], dn, table_field);\n\t\telse refresh_field(flist[i]);\n\t}\n};\n\nwindow.refresh_field = function (n, docname, table_field) {\n\t// multiple\n\tif (typeof n == typeof []) refresh_many(n, docname, table_field);\n\n\tif (n && typeof n === \"string\" && table_field) {\n\t\tvar grid = cur_frm.fields_dict[table_field].grid,\n\t\t\tfield = frappe.utils.filter_dict(grid.docfields, { fieldname: n }),\n\t\t\tgrid_row = grid.grid_rows_by_docname[docname];\n\n\t\tif (field && field.length) {\n\t\t\tfield = field[0];\n\t\t\tvar meta = frappe.meta.get_docfield(field.parent, field.fieldname, docname);\n\t\t\t$.extend(field, meta);\n\t\t\tif (grid_row) {\n\t\t\t\tgrid_row.refresh_field(n);\n\t\t\t} else {\n\t\t\t\tgrid.refresh();\n\t\t\t}\n\t\t}\n\t} else if (cur_frm) {\n\t\tcur_frm.refresh_field(n);\n\t}\n};\n\nwindow.set_field_options = function (n, txt) {\n\tcur_frm.set_df_property(n, \"options\", txt);\n};\n\nwindow.toggle_field = function (n, hidden) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif (df) {\n\t\tdf.hidden = hidden;\n\t\trefresh_field(n);\n\t} else {\n\t\tconsole.log((hidden ? \"hide_field\" : \"unhide_field\") + \" cannot find field \" + n);\n\t}\n};\n\nwindow.hide_field = function (n) {\n\tif (cur_frm) {\n\t\tif (n.substr) toggle_field(n, 1);\n\t\telse {\n\t\t\tfor (var i in n) toggle_field(n[i], 1);\n\t\t}\n\t}\n};\n\nwindow.unhide_field = function (n) {\n\tif (cur_frm) {\n\t\tif (n.substr) toggle_field(n, 0);\n\t\telse {\n\t\t\tfor (var i in n) toggle_field(n[i], 0);\n\t\t}\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.AssignTo = class AssignTo {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.btn = this.parent.find(\".add-assignment-btn\").on(\"click\", () => this.add());\n\t\tthis.btn_wrapper = this.btn.parent();\n\n\t\tthis.refresh();\n\t}\n\trefresh() {\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.render(this.frm.get_docinfo().assignments);\n\t}\n\trender(assignments) {\n\t\tthis.frm.get_docinfo().assignments = assignments;\n\n\t\tlet assignments_wrapper = this.parent.find(\".assignments\");\n\n\t\tassignments_wrapper.empty();\n\t\tlet assigned_users = assignments.map((d) => d.owner);\n\n\t\tif (!assigned_users.length) {\n\t\t\tassignments_wrapper.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tlet avatar_group = frappe.avatar_group(assigned_users, 5, {\n\t\t\talign: \"left\",\n\t\t\toverlap: true,\n\t\t});\n\n\t\tassignments_wrapper.show();\n\t\tassignments_wrapper.append(avatar_group);\n\t\tavatar_group.click(() => {\n\t\t\tnew frappe.ui.form.AssignmentDialog({\n\t\t\t\tassignments: assigned_users,\n\t\t\t\tfrm: this.frm,\n\t\t\t});\n\t\t});\n\t}\n\tadd() {\n\t\tvar me = this;\n\n\t\tif (this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (!me.assign_to) {\n\t\t\tme.assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tmethod: \"frappe.desk.form.assign_to.add\",\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tdocname: me.frm.docname,\n\t\t\t\tfrm: me.frm,\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tme.render(r.message);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tme.assign_to.dialog.clear();\n\t\tme.assign_to.dialog.show();\n\t}\n\tremove(owner) {\n\t\tif (this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before removing assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\treturn frappe\n\t\t\t.xcall(\"frappe.desk.form.assign_to.remove\", {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\tassign_to: owner,\n\t\t\t})\n\t\t\t.then((assignments) => {\n\t\t\t\tthis.render(assignments);\n\t\t\t});\n\t}\n};\n\nfrappe.ui.form.AssignToDialog = class AssignToDialog {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.make();\n\t\tthis.set_description_from_doc();\n\t}\n\tmake() {\n\t\tlet me = this;\n\n\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Add to ToDo\"),\n\t\t\tfields: me.get_fields(),\n\t\t\tprimary_action_label: __(\"Add\"),\n\t\t\tprimary_action: function () {\n\t\t\t\tlet args = me.dialog.get_values();\n\n\t\t\t\tif (args && args.assign_to) {\n\t\t\t\t\tme.dialog.set_message(\"Assigning...\");\n\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: me.method,\n\t\t\t\t\t\targs: $.extend(args, {\n\t\t\t\t\t\t\tdoctype: me.doctype,\n\t\t\t\t\t\t\tname: me.docname,\n\t\t\t\t\t\t\tassign_to: args.assign_to,\n\t\t\t\t\t\t\tbulk_assign: me.bulk_assign || false,\n\t\t\t\t\t\t\tre_assign: me.re_assign || false,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tbtn: me.dialog.get_primary_btn(),\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tif (me.callback) {\n\t\t\t\t\t\t\t\t\tme.callback(r);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tme.dialog && me.dialog.hide();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.dialog.clear_message();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\tassign_to_me() {\n\t\tlet me = this;\n\t\tlet assign_to = [];\n\n\t\tif (me.dialog.get_value(\"assign_to_me\")) {\n\t\t\tassign_to.push(frappe.session.user);\n\t\t}\n\n\t\tme.dialog.set_value(\"assign_to\", assign_to);\n\t}\n\tset_description_from_doc() {\n\t\tlet me = this;\n\n\t\tif (me.frm && me.frm.meta.title_field) {\n\t\t\tme.dialog.set_value(\"description\", me.frm.doc[me.frm.meta.title_field]);\n\t\t}\n\t}\n\tget_fields() {\n\t\tlet me = this;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tlabel: __(\"Assign to me\"),\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tfieldname: \"assign_to_me\",\n\t\t\t\tdefault: 0,\n\t\t\t\tonchange: () => me.assign_to_me(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"MultiSelectPills\",\n\t\t\t\tfieldname: \"assign_to\",\n\t\t\t\tlabel: __(\"Assign To\"),\n\t\t\t\treqd: true,\n\t\t\t\tget_data: function (txt) {\n\t\t\t\t\treturn frappe.db.get_link_options(\"User\", txt, {\n\t\t\t\t\t\tuser_type: \"System User\",\n\t\t\t\t\t\tenabled: 1,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Complete By\"),\n\t\t\t\tfieldtype: \"Date\",\n\t\t\t\tfieldname: \"date\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Priority\"),\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\tfieldname: \"priority\",\n\t\t\t\toptions: [\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: \"Low\",\n\t\t\t\t\t\tlabel: __(\"Low\"),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: \"Medium\",\n\t\t\t\t\t\tlabel: __(\"Medium\"),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: \"High\",\n\t\t\t\t\t\tlabel: __(\"High\"),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\t// Pick up priority from the source document, if it exists and is available in ToDo\n\t\t\t\tdefault: [\"Low\", \"Medium\", \"High\"].includes(\n\t\t\t\t\tme.frm && me.frm.doc.priority ? me.frm.doc.priority : \"Medium\"\n\t\t\t\t),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Comment\"),\n\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\tfieldname: \"description\",\n\t\t\t},\n\t\t];\n\t}\n};\n\nfrappe.ui.form.AssignmentDialog = class {\n\tconstructor(opts) {\n\t\tthis.frm = opts.frm;\n\t\tthis.assignments = opts.assignments;\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Assignments\"),\n\t\t\tsize: \"small\",\n\t\t\tno_focus: true,\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Assign a user\"),\n\t\t\t\t\tfieldname: \"user\",\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"User\",\n\t\t\t\t\tchange: () => {\n\t\t\t\t\t\tlet value = this.dialog.get_value(\"user\");\n\t\t\t\t\t\tif (value && !this.assigning) {\n\t\t\t\t\t\t\tthis.assigning = true;\n\t\t\t\t\t\t\tthis.dialog.set_df_property(\"user\", \"read_only\", 1);\n\t\t\t\t\t\t\tthis.dialog.set_df_property(\"user\", \"description\", __(\"Assigning...\"));\n\t\t\t\t\t\t\tthis.add_assignment(value)\n\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\tthis.dialog.set_value(\"user\", null);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\t\t\tthis.dialog.set_df_property(\"user\", \"description\", null);\n\t\t\t\t\t\t\t\t\tthis.dialog.set_df_property(\"user\", \"read_only\", 0);\n\t\t\t\t\t\t\t\t\tthis.assigning = false;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\t\tfieldname: \"assignment_list\",\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tthis.assignment_list = $(this.dialog.get_field(\"assignment_list\").wrapper);\n\t\tthis.assignment_list.removeClass(\"frappe-control\");\n\n\t\tthis.assignments.forEach((assignment) => {\n\t\t\tthis.update_assignment(assignment);\n\t\t});\n\t\tthis.dialog.show();\n\t}\n\trender(assignments) {\n\t\tthis.frm && this.frm.assign_to.render(assignments);\n\t}\n\tadd_assignment(assignment) {\n\t\treturn frappe\n\t\t\t.xcall(\"frappe.desk.form.assign_to.add\", {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\tassign_to: [assignment],\n\t\t\t})\n\t\t\t.then((assignments) => {\n\t\t\t\tthis.update_assignment(assignment);\n\t\t\t\tthis.render(assignments);\n\t\t\t});\n\t}\n\tremove_assignment(assignment) {\n\t\treturn frappe.xcall(\"frappe.desk.form.assign_to.remove\", {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tname: this.frm.docname,\n\t\t\tassign_to: assignment,\n\t\t});\n\t}\n\tclose_assignment(assignment) {\n\t\treturn frappe.xcall(\"frappe.desk.form.assign_to.close\", {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tname: this.frm.docname,\n\t\t\tassign_to: assignment,\n\t\t});\n\t}\n\tupdate_assignment(assignment) {\n\t\tconst in_the_list = this.assignment_list.find(`[data-user=\"${assignment}\"]`).length;\n\t\tif (!in_the_list) {\n\t\t\tthis.assignment_list.append(this.get_assignment_row(assignment));\n\t\t}\n\t}\n\tget_assignment_row(assignment) {\n\t\tconst row = $(`\n\t\t\t<div class=\"dialog-assignment-row\" data-user=\"${assignment}\">\n\t\t\t\t<div class=\"assignee\">\n\t\t\t\t\t${frappe.avatar(assignment)}\n\t\t\t\t\t${frappe.user.full_name(assignment)}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"btn-group btn-group-sm\" role=\"group\" aria-label=\"Actions\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tconst btn_group = row.find(\".btn-group\");\n\n\t\tif (assignment === frappe.session.user) {\n\t\t\tbtn_group.append(`\n\t\t\t\t<button type=\"button\" class=\"btn btn-default complete-btn\" title=\"${__(\"Done\")}\">\n\t\t\t\t\t${frappe.utils.icon(\"tick\", \"xs\")}\n\t\t\t\t</button>\n\t\t\t`);\n\t\t\tbtn_group.find(\".complete-btn\").click(() => {\n\t\t\t\tthis.close_assignment(assignment).then((assignments) => {\n\t\t\t\t\trow.remove();\n\t\t\t\t\tthis.render(assignments);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (assignment === frappe.session.user || this.frm.perm[0].write) {\n\t\t\tbtn_group.append(`\n\t\t\t\t<button type=\"button\" class=\"btn btn-default remove-btn\" title=\"${__(\"Cancel\")}\">\n\t\t\t\t${frappe.utils.icon(\"close\")}\n\t\t\t\t</button>\n\t\t\t`);\n\t\t\tbtn_group.find(\".remove-btn\").click(() => {\n\t\t\t\tthis.remove_assignment(assignment).then((assignments) => {\n\t\t\t\t\trow.remove();\n\t\t\t\t\tthis.render(assignments);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn row;\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nfrappe.ui.form.Attachments = class Attachments {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.attachments_page_length = 10; // show n attachments initially\n\t\tthis.show_all_attachments = false;\n\n\t\tthis.make();\n\t}\n\tmake() {\n\t\tvar me = this;\n\t\tthis.parent.find(\".add-attachment-btn\").click(function () {\n\t\t\tme.new_attachment();\n\t\t});\n\n\t\tthis.parent.find(\".explore-btn\").click(() => {\n\t\t\tfrappe.open_in_new_tab = true;\n\t\t\tfrappe.set_route(\"List\", \"File\", {\n\t\t\t\tattached_to_doctype: this.frm.doctype,\n\t\t\t\tattached_to_name: this.frm.docname,\n\t\t\t});\n\t\t});\n\n\t\tthis.add_attachment_wrapper = this.parent.find(\".attachments-actions\");\n\t\tthis.attachments_label = this.parent.find(\".attachments-label\");\n\t}\n\tmax_reached(raise_exception = false) {\n\t\tconst attachment_count = Object.keys(this.get_attachments()).length;\n\t\tconst attachment_limit = this.frm.meta.max_attachments;\n\t\tif (attachment_limit && attachment_count >= attachment_limit) {\n\t\t\tif (raise_exception) {\n\t\t\t\tfrappe.throw({\n\t\t\t\t\ttitle: __(\"Attachment Limit Reached\"),\n\t\t\t\t\tmessage: __(\"Maximum attachment limit of {0} has been reached.\", [\n\t\t\t\t\t\tcstr(attachment_limit).bold(),\n\t\t\t\t\t]),\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\trefresh() {\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.parent.find(\".attachment-row\").remove();\n\n\t\tvar max_reached = this.max_reached();\n\t\tthis.add_attachment_wrapper.toggle(!max_reached);\n\t\tthis.setup_expanded_explore_button(max_reached);\n\n\t\t// add attachment objects\n\t\tvar attachments = this.get_attachments();\n\t\tthis.render_attachments(attachments);\n\t\tthis.setup_show_all_button(attachments);\n\t}\n\n\tsetup_expanded_explore_button(max_reached) {\n\t\tif (!max_reached) {\n\t\t\tthis.parent.find(\".explore-full-btn\").addClass(\"hidden\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.parent.find(\".explore-full-btn\").removeClass(\"hidden\");\n\t\tthis.parent.find(\".explore-full-btn\").click(() => {\n\t\t\tfrappe.set_route(\"List\", \"File\", {\n\t\t\t\tattached_to_doctype: this.frm.doctype,\n\t\t\t\tattached_to_name: this.frm.docname,\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_show_all_button(attachments) {\n\t\t// show button if there is more to show and user has not clicked on \"Show All\"\n\t\tlet is_slicable = attachments.length > this.attachments_page_length;\n\t\tlet show = !this.show_all_attachments && is_slicable;\n\n\t\tlet show_all_btn = this.parent.find(\".show-all-btn\");\n\t\tif (!show) {\n\t\t\tshow_all_btn.addClass(\"hidden\");\n\t\t\treturn;\n\t\t}\n\n\t\tshow_all_btn.removeClass(\"hidden\");\n\t\tshow_all_btn.click(() => {\n\t\t\tshow_all_btn.addClass(\"hidden\");\n\t\t\tthis.show_all_attachments = true;\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tget_attachments() {\n\t\treturn this.frm.get_docinfo().attachments || [];\n\t}\n\n\trender_attachments(attachments) {\n\t\tvar me = this;\n\t\tlet attachments_to_render = attachments;\n\n\t\tlet is_slicable = attachments.length > this.attachments_page_length;\n\t\tif (!this.show_all_attachments && is_slicable) {\n\t\t\t// render last n attachments as they are at the top\n\t\t\tlet start = attachments.length - this.attachments_page_length;\n\t\t\tattachments_to_render = attachments.slice(start, attachments.length);\n\t\t}\n\n\t\tif (attachments_to_render.length) {\n\t\t\tlet exists = {};\n\t\t\tlet unique_attachments = attachments_to_render.filter((attachment) => {\n\t\t\t\treturn Object.prototype.hasOwnProperty.call(exists, attachment.file_name)\n\t\t\t\t\t? false\n\t\t\t\t\t: (exists[attachment.file_name] = true);\n\t\t\t});\n\t\t\tunique_attachments.forEach((attachment) => {\n\t\t\t\tme.add_attachment(attachment);\n\t\t\t});\n\t\t}\n\n\t\tif (!attachments.length) {\n\t\t\t// If no attachments in totality\n\t\t\tthis.attachments_label.removeClass(\"has-attachments\");\n\t\t\tthis.parent.find(\".explore-btn\").toggle(false); // hide explore icon button\n\t\t}\n\t}\n\n\tadd_attachment(attachment) {\n\t\tvar file_name = attachment.file_name;\n\t\tvar file_url = this.get_file_url(attachment);\n\t\tvar fileid = attachment.name;\n\t\tif (!file_name) {\n\t\t\tfile_name = file_url;\n\t\t}\n\n\t\tvar me = this;\n\n\t\tlet file_label = `\n\t\t\t<a href=\"${file_url}\" target=\"_blank\" title=\"${frappe.utils.escape_html(file_name)}\"\n\t\t\t\tclass=\"ellipsis\" style=\"max-width: calc(100% - 43px);\"\n\t\t\t>\n\t\t\t\t<span>${file_name}</span>\n\t\t\t</a>`;\n\n\t\tlet remove_action = null;\n\t\tif (frappe.model.can_write(this.frm.doctype, this.frm.name)) {\n\t\t\tremove_action = function (target_id) {\n\t\t\t\tfrappe.confirm(__(\"Are you sure you want to delete the attachment?\"), function () {\n\t\t\t\t\tlet target_attachment = me\n\t\t\t\t\t\t.get_attachments()\n\t\t\t\t\t\t.find((attachment) => attachment.name === target_id);\n\t\t\t\t\tlet to_be_removed = me\n\t\t\t\t\t\t.get_attachments()\n\t\t\t\t\t\t.filter(\n\t\t\t\t\t\t\t(attachment) => attachment.file_name === target_attachment.file_name\n\t\t\t\t\t\t);\n\t\t\t\t\tto_be_removed.forEach((attachment) => me.remove_attachment(attachment.name));\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tconst icon = `<a href=\"/app/file/${fileid}\">\n\t\t\t\t${frappe.utils.icon(attachment.is_private ? \"lock\" : \"unlock\", \"sm ml-0\")}\n\t\t\t</a>`;\n\n\t\t$(`<li class=\"attachment-row\">`)\n\t\t\t.append(frappe.get_data_pill(file_label, fileid, remove_action, icon))\n\t\t\t.insertAfter(this.add_attachment_wrapper);\n\n\t\tthis.parent.find(\".explore-btn\").toggle(true); // show explore icon button if hidden\n\t}\n\n\tget_file_url(attachment) {\n\t\tvar file_url = attachment.file_url;\n\t\tif (!file_url) {\n\t\t\tif (attachment.file_name.indexOf(\"files/\") === 0) {\n\t\t\t\tfile_url = \"/\" + attachment.file_name;\n\t\t\t} else {\n\t\t\t\tfile_url = \"/files/\" + attachment.file_name;\n\t\t\t}\n\t\t}\n\t\t// hash is not escaped, https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI\n\t\treturn encodeURI(file_url).replace(/#/g, \"%23\");\n\t}\n\tget_file_id_from_file_url(file_url) {\n\t\tvar fid;\n\t\t$.each(this.get_attachments(), function (i, attachment) {\n\t\t\tif (attachment.file_url === file_url) {\n\t\t\t\tfid = attachment.name;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn fid;\n\t}\n\tremove_attachment_by_filename(filename, callback) {\n\t\tthis.remove_attachment(this.get_file_id_from_file_url(filename), callback);\n\t}\n\tremove_attachment(fileid, callback) {\n\t\tif (!fileid) {\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.utils.remove_attach\",\n\t\t\ttype: \"DELETE\",\n\t\t\targs: {\n\t\t\t\tfid: fileid,\n\t\t\t\tdt: me.frm.doctype,\n\t\t\t\tdn: me.frm.docname,\n\t\t\t},\n\t\t\tcallback: function (r, rt) {\n\t\t\t\tif (r.exc) {\n\t\t\t\t\tif (!r._server_messages) frappe.msgprint(__(\"There were errors\"));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme.remove_fileid(fileid);\n\t\t\t\tme.frm.sidebar.reload_docinfo();\n\t\t\t\tif (callback) callback();\n\t\t\t},\n\t\t});\n\t}\n\tnew_attachment(fieldname) {\n\t\tif (this.dialog) {\n\t\t\t// remove upload dialog\n\t\t\tthis.dialog.$wrapper.remove();\n\t\t}\n\n\t\tconst restrictions = {};\n\t\tif (this.frm.meta.max_attachments) {\n\t\t\trestrictions.max_number_of_files =\n\t\t\t\tthis.frm.meta.max_attachments - this.frm.attachments.get_attachments().length;\n\t\t}\n\n\t\tnew frappe.ui.FileUploader({\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t\tfrm: this.frm,\n\t\t\tfolder: \"Home/Attachments\",\n\t\t\ton_success: (file_doc) => {\n\t\t\t\tthis.attachment_uploaded(file_doc);\n\t\t\t},\n\t\t\trestrictions,\n\t\t\tmake_attachments_public: this.frm.meta.make_attachments_public,\n\t\t});\n\t}\n\tget_args() {\n\t\treturn {\n\t\t\tfrom_form: 1,\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t};\n\t}\n\tattachment_uploaded(attachment) {\n\t\tthis.dialog && this.dialog.hide();\n\t\tthis.update_attachment(attachment);\n\t\tthis.frm.sidebar.reload_docinfo();\n\n\t\tif (this.fieldname) {\n\t\t\tthis.frm.set_value(this.fieldname, attachment.file_url);\n\t\t}\n\t}\n\tupdate_attachment(attachment) {\n\t\tif (attachment.name) {\n\t\t\tthis.add_to_attachments(attachment);\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\tadd_to_attachments(attachment) {\n\t\tvar form_attachments = this.get_attachments();\n\t\tfor (var i in form_attachments) {\n\t\t\t// prevent duplicate\n\t\t\tif (form_attachments[i][\"name\"] === attachment.name) return;\n\t\t}\n\t\tform_attachments.push(attachment);\n\t}\n\tremove_fileid(fileid) {\n\t\tvar attachments = this.get_attachments();\n\t\tvar new_attachments = [];\n\t\t$.each(attachments, function (i, attachment) {\n\t\t\tif (attachment.name != fileid) {\n\t\t\t\tnew_attachments.push(attachment);\n\t\t\t}\n\t\t});\n\t\tthis.frm.get_docinfo().attachments = new_attachments;\n\t\tthis.refresh();\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Share = class Share {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.shares = this.parent.find(\".shares\");\n\t}\n\trefresh() {\n\t\tthis.render_sidebar();\n\t}\n\trender_sidebar() {\n\t\tconst shared = this.shared || this.frm.get_docinfo().shared;\n\t\tconst shared_users = shared.filter(Boolean).map((s) => s.user);\n\n\t\tif (this.frm.is_new()) {\n\t\t\tthis.parent.find(\".share-doc-btn\").hide();\n\t\t}\n\n\t\tthis.parent\n\t\t\t.find(\".share-doc-btn\")\n\t\t\t.off(\"click\")\n\t\t\t.on(\"click\", () => {\n\t\t\t\tthis.frm.share_doc();\n\t\t\t});\n\n\t\tthis.shares.empty();\n\n\t\tif (!shared_users.length) {\n\t\t\tthis.shares.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.shares.show();\n\t\t// REDESIGN-TODO: handle \"shared with everyone\"\n\t\tthis.shares.append(frappe.avatar_group(shared_users, 5, { align: \"left\", overlap: true }));\n\t}\n\tshow() {\n\t\tvar me = this;\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Share {0} with\", [this.frm.doc.name]),\n\t\t});\n\n\t\tthis.dialog = d;\n\t\tthis.dirty = false;\n\n\t\t$(d.body).html('<p class=\"text-muted\">' + __(\"Loading...\") + \"</p>\");\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.share.get_users\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tme.render_shared(r.message || []);\n\t\t\t},\n\t\t});\n\n\t\td.onhide = function () {\n\t\t\t// reload comments\n\t\t\tif (me.dirty) me.frm.sidebar.reload_docinfo();\n\t\t};\n\n\t\td.show();\n\t}\n\trender_shared(shared) {\n\t\tif (shared) this.shared = shared;\n\t\tvar d = this.dialog;\n\t\t$(d.body).empty();\n\n\t\tvar everyone = {};\n\t\t$.each(this.shared, function (i, s) {\n\t\t\t// pullout everyone record from shared list\n\t\t\tif (s && s.everyone) {\n\t\t\t\teveryone = s;\n\t\t\t}\n\t\t});\n\n\t\t$(\n\t\t\tfrappe.render_template(\"set_sharing\", {\n\t\t\t\tfrm: this.frm,\n\t\t\t\tshared: this.shared,\n\t\t\t\teveryone: everyone,\n\t\t\t})\n\t\t).appendTo(d.body);\n\n\t\tif (frappe.model.can_share(null, this.frm)) {\n\t\t\tthis.make_user_input();\n\t\t\tthis.add_share_button();\n\t\t\tthis.set_edit_share_events();\n\t\t} else {\n\t\t\t// if cannot share, disable sharing settings.\n\t\t\t$(d.body).find(\".edit-share\").prop(\"disabled\", true);\n\t\t}\n\t}\n\tmake_user_input() {\n\t\t// make add-user input\n\t\tthis.dialog.share_with = frappe.ui.form.make_control({\n\t\t\tparent: $(this.dialog.body).find(\".input-wrapper-add-share\"),\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Share With\"),\n\t\t\t\tfieldname: \"share_with\",\n\t\t\t\toptions: \"User\",\n\t\t\t\tfilters: {\n\t\t\t\t\tuser_type: \"System User\",\n\t\t\t\t\tname: [\"!=\", frappe.session.user],\n\t\t\t\t},\n\t\t\t},\n\t\t\tonly_input: true,\n\t\t\trender_input: true,\n\t\t});\n\t}\n\tadd_share_button() {\n\t\tvar me = this,\n\t\t\td = this.dialog;\n\t\t$(d.body)\n\t\t\t.find(\".btn-add-share\")\n\t\t\t.on(\"click\", function () {\n\t\t\t\tvar user = d.share_with.get_value();\n\t\t\t\tif (!user) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.share.add\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\tuser: user,\n\t\t\t\t\t\tread: $(d.body).find(\".add-share-read\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\t\twrite: $(d.body).find(\".add-share-write\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\t\tsubmit: $(d.body).find(\".add-share-submit\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\t\tshare: $(d.body).find(\".add-share-share\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\t\tnotify: 1,\n\t\t\t\t\t},\n\t\t\t\t\tbtn: this,\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t$.each(me.shared, function (i, s) {\n\t\t\t\t\t\t\tif (s && s.user === r.message.user) {\n\t\t\t\t\t\t\t\t// re-adding / remove the old share rule.\n\t\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme.dirty = true;\n\t\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\t\tme.render_shared();\n\t\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t}\n\tset_edit_share_events() {\n\t\tvar me = this,\n\t\t\td = this.dialog;\n\t\t$(d.body)\n\t\t\t.find(\".edit-share\")\n\t\t\t.on(\"click\", function () {\n\t\t\t\tvar user = $(this).parents(\".shared-user:first\").attr(\"data-user\") || \"\",\n\t\t\t\t\tvalue = $(this).prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tproperty = $(this).attr(\"name\"),\n\t\t\t\t\teveryone = cint($(this).parents(\".shared-user:first\").attr(\"data-everyone\"));\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.share.set_permission\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\tuser: user,\n\t\t\t\t\t\tpermission_to: property,\n\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\teveryone: everyone,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tvar found = null;\n\t\t\t\t\t\t$.each(me.shared, function (i, s) {\n\t\t\t\t\t\t\t// update shared object\n\t\t\t\t\t\t\tif (s && (s.user === user || (everyone && s.everyone === 1))) {\n\t\t\t\t\t\t\t\tif (!r.message) {\n\t\t\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tme.shared[i] = $.extend(s, r.message);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (!found) {\n\t\t\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.dirty = true;\n\t\t\t\t\t\tme.render_shared();\n\t\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t}\n};\n", "// Copyright (c) 2019, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Review = class Review {\n\tconstructor({ parent, frm }) {\n\t\tthis.parent = parent;\n\t\tthis.frm = frm;\n\t\tthis.points = frappe.boot.points;\n\t\tthis.reviews = this.parent.find(\".reviews\");\n\t\tthis.setup_add_review_button();\n\t\tthis.update_reviewers();\n\t}\n\tupdate_points() {\n\t\treturn frappe\n\t\t\t.xcall(\"frappe.social.doctype.energy_point_log.energy_point_log.get_energy_points\", {\n\t\t\t\tuser: frappe.session.user,\n\t\t\t})\n\t\t\t.then((data) => {\n\t\t\t\tfrappe.boot.points = data;\n\t\t\t\tthis.points = data;\n\t\t\t});\n\t}\n\tsetup_add_review_button() {\n\t\tconst review_button = this.reviews.find(\".add-review-btn\");\n\n\t\tif (!this.points.review_points) {\n\t\t\treview_button.click(false);\n\t\t\treview_button.popover({\n\t\t\t\ttrigger: \"hover\",\n\t\t\t\tcontent: () => {\n\t\t\t\t\treturn `<div class=\"text-medium\">\n\t\t\t\t\t\t${__(\"You do not have enough review points\")}\n\t\t\t\t\t</div>`;\n\t\t\t\t},\n\t\t\t\thtml: true,\n\t\t\t});\n\t\t} else {\n\t\t\treview_button.click(() => this.show_review_dialog());\n\t\t}\n\t}\n\n\tshow_review_dialog() {\n\t\tconst user_options = this.frm.get_involved_users();\n\t\tconst review_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Add Review\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"to_user\",\n\t\t\t\t\tfieldtype: \"Autocomplete\",\n\t\t\t\t\tlabel: __(\"To User\"),\n\t\t\t\t\treqd: 1,\n\t\t\t\t\toptions: user_options,\n\t\t\t\t\tignore_validation: 1,\n\t\t\t\t\tdescription: __(\"Only users involved in the document are listed\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"review_type\",\n\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\tlabel: __(\"Action\"),\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __(\"Appreciate\"),\n\t\t\t\t\t\t\tvalue: \"Appreciation\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __(\"Criticize\"),\n\t\t\t\t\t\t\tvalue: \"Criticism\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tdefault: \"Appreciation\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"points\",\n\t\t\t\t\tfieldtype: \"Int\",\n\t\t\t\t\tlabel: __(\"Points\"),\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdescription: __(\"Currently you have {0} review points\", [\n\t\t\t\t\t\tthis.points.review_points,\n\t\t\t\t\t]),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\t\tfieldname: \"reason\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tlabel: __(\"Reason\"),\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action: (values) => {\n\t\t\t\treview_dialog.disable_primary_action();\n\t\t\t\tif (values.points > this.points.review_points) {\n\t\t\t\t\treturn frappe.msgprint(__(\"You do not have enough points\"));\n\t\t\t\t}\n\t\t\t\tfrappe\n\t\t\t\t\t.xcall(\"frappe.social.doctype.energy_point_log.energy_point_log.review\", {\n\t\t\t\t\t\tdoc: {\n\t\t\t\t\t\t\tdoctype: this.frm.doc.doctype,\n\t\t\t\t\t\t\tname: this.frm.doc.name,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tto_user: values.to_user,\n\t\t\t\t\t\tpoints: values.points,\n\t\t\t\t\t\treview_type: values.review_type,\n\t\t\t\t\t\treason: values.reason,\n\t\t\t\t\t})\n\t\t\t\t\t.then((review) => {\n\t\t\t\t\t\treview_dialog.hide();\n\t\t\t\t\t\treview_dialog.clear();\n\t\t\t\t\t\tthis.frm.get_docinfo().energy_point_logs.unshift(review);\n\t\t\t\t\t\tthis.frm.timeline.refresh();\n\t\t\t\t\t\tthis.update_reviewers();\n\t\t\t\t\t\tthis.update_points();\n\t\t\t\t\t})\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\treview_dialog.enable_primary_action();\n\t\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Submit\"),\n\t\t});\n\t\treview_dialog.show();\n\t}\n\tupdate_reviewers() {\n\t\tconst review_logs = this.frm\n\t\t\t.get_docinfo()\n\t\t\t.energy_point_logs.filter((log) => [\"Appreciation\", \"Criticism\"].includes(log.type));\n\n\t\tthis.reviews.find(\".review\").remove();\n\t\treview_logs.forEach((log) => {\n\t\t\tlet review_pill = $(`\n\t\t\t\t<div class=\"review ${log.points < 0 ? \"criticism\" : \"appreciation\"} cursor-pointer\">\n\t\t\t\t\t${frappe.avatar(log.owner)}\n\t\t\t\t\t<span class=\"review-points\">\n\t\t\t\t\t\t${log.points > 0 ? \"+\" : \"\"}${log.points}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.reviews.prepend(review_pill);\n\t\t\tthis.setup_detail_popover(review_pill, log);\n\t\t});\n\t}\n\tsetup_detail_popover(el, data) {\n\t\tlet subject = \"\";\n\t\tlet fullname = frappe.user.full_name(data.user);\n\t\tlet timestamp = `<span class=\"text-muted\">${frappe.datetime.comment_when(\n\t\t\tdata.creation\n\t\t)}</span>`;\n\t\tlet message_parts = [Math.abs(data.points), fullname, timestamp];\n\t\tif (data.type === \"Appreciation\") {\n\t\t\tif (data.points == 1) {\n\t\t\t\tsubject = __(\"{0} appreciation point for {1}\", message_parts);\n\t\t\t} else {\n\t\t\t\tsubject = __(\"{0} appreciation points for {1}\", message_parts);\n\t\t\t}\n\t\t} else {\n\t\t\tif (data.points == -1) {\n\t\t\t\tsubject = __(\"{0} criticism point for {1}\", message_parts);\n\t\t\t} else {\n\t\t\t\tsubject = __(\"{0} criticism points for {1}\", message_parts);\n\t\t\t}\n\t\t}\n\n\t\tel.popover({\n\t\t\tanimation: true,\n\t\t\ttrigger: \"hover\",\n\t\t\tdelay: 500,\n\t\t\tplacement: \"top\",\n\t\t\ttemplate: `\n\t\t\t\t<div class=\"review-popover popover\" role=\"tooltip\">\n\t\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t\t<h3 class=\"popover-header\"></h3>\n\t\t\t\t\t<div class=\"popover-body\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>'\n\t\t\t`,\n\t\t\tcontent: () => {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"text-medium\">\n\t\t\t\t\t\t<div class=\"body\">\n\t\t\t\t\t\t\t<div>${data.reason}</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"subject\">\n\t\t\t\t\t\t\t${frappe.utils.icon(\"review\")}\n\t\t\t\t\t\t\t${subject}\n\n\t\t\t\t\t\t\t<p class=\"mt-1\">\n\t\t\t\t\t\t\t\t<!-- ${frappe.avatar(\"shivam@example.com\", \"avatar-xs\")} -->\n\t\t\t\t\t\t\t\t<span>${frappe.user.full_name(data.owner)}</span> - ${timestamp}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t},\n\t\t\thtml: true,\n\t\t\tcontainer: \"body\",\n\t\t});\n\n\t\treturn el;\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.DocumentFollow = class DocumentFollow {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tif (!frappe.boot.user.document_follow_notify) {\n\t\t\tthis.hide_follow_section();\n\t\t\treturn;\n\t\t}\n\t\tthis.follow_document_link = this.parent.find(\".follow-document-link\");\n\t\tthis.unfollow_document_link = this.parent.find(\".unfollow-document-link\");\n\t\tthis.follow_span = this.parent.find(\".anchor-document-follow > span\");\n\t\tthis.followed_by = this.parent.find(\".followed-by\");\n\t\tthis.followed_by_label = this.parent.find(\".followed-by-label\");\n\t}\n\n\trefresh() {\n\t\tthis.set_followers();\n\t\tthis.render_sidebar();\n\t}\n\n\trender_sidebar() {\n\t\tconst docinfo = this.frm.get_docinfo();\n\t\tconst document_follow_enabled = frappe.boot.user.document_follow_notify;\n\t\tconst document_can_be_followed = frappe.get_meta(this.frm.doctype).track_changes;\n\t\tif (\n\t\t\tfrappe.session.user === \"Administrator\" ||\n\t\t\t!document_follow_enabled ||\n\t\t\t!document_can_be_followed\n\t\t) {\n\t\t\tthis.hide_follow_section();\n\t\t\treturn;\n\t\t}\n\t\tthis.bind_events();\n\n\t\tconst is_followed = docinfo && docinfo.is_document_followed;\n\n\t\tif (is_followed > 0) {\n\t\t\tthis.unfollow_document_link.removeClass(\"hidden\");\n\t\t\tthis.follow_document_link.addClass(\"hidden\");\n\t\t} else {\n\t\t\tthis.followed_by_label.addClass(\"hidden\");\n\t\t\tthis.followed_by.addClass(\"hidden\");\n\t\t\tthis.unfollow_document_link.addClass(\"hidden\");\n\t\t\tthis.follow_document_link.removeClass(\"hidden\");\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.follow_document_link.on(\"click\", () => {\n\t\t\tthis.follow_document_link.addClass(\"text-muted disable-click\");\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.form.document_follow.follow_document\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\t\tdoc_name: this.frm.doc.name,\n\t\t\t\t\tuser: frappe.session.user,\n\t\t\t\t\tforce: true,\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tthis.follow_action();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tthis.unfollow_document_link.on(\"click\", () => {\n\t\t\tthis.unfollow_document_link.addClass(\"text-muted disable-click\");\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.form.document_follow.unfollow_document\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\t\tdoc_name: this.frm.doc.name,\n\t\t\t\t\tuser: frappe.session.user,\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tthis.unfollow_action();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\thide_follow_section() {\n\t\tthis.parent.hide();\n\t}\n\n\tset_followers() {\n\t\tthis.followed_by.removeClass(\"hidden\");\n\t\tthis.followed_by_label.removeClass(\"hidden\");\n\t\tthis.followed_by.empty();\n\t\tthis.get_followed_user().then((user) => {\n\t\t\t$(user).appendTo(this.followed_by);\n\t\t});\n\t}\n\n\tget_followed_user() {\n\t\tvar html = \"\";\n\t\treturn new Promise((resolve) => {\n\t\t\tfrappe\n\t\t\t\t.call({\n\t\t\t\t\tmethod: \"frappe.desk.form.document_follow.get_follow_users\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\t\t\tdoc_name: this.frm.doc.name,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((r) => {\n\t\t\t\t\tthis.count_others = 0;\n\t\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\t\tthis.count_others++;\n\t\t\t\t\t\tif (this.count_others < 4) {\n\t\t\t\t\t\t\thtml += frappe.avatar(r.message[d].user, \"avatar-small\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.count_others === 0) {\n\t\t\t\t\t\t\tthis.followed_by.addClass(\"hidden\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tresolve(html);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tfollow_action() {\n\t\tfrappe.show_alert({\n\t\t\tmessage: __(\n\t\t\t\t\"You are now following this document. You will receive daily updates via email. You can change this in User Settings.\"\n\t\t\t),\n\t\t\tindicator: \"orange\",\n\t\t});\n\t\tthis.follow_document_link.removeClass(\"text-muted disable-click\");\n\t\tthis.follow_document_link.addClass(\"hidden\");\n\t\tthis.unfollow_document_link.removeClass(\"hidden\");\n\t\tthis.set_followers();\n\t}\n\n\tunfollow_action() {\n\t\tfrappe.show_alert({\n\t\t\tmessage: __(\"You unfollowed this document\"),\n\t\t\tindicator: \"red\",\n\t\t});\n\t\tthis.unfollow_document_link.removeClass(\"text-muted disable-click\");\n\t\tthis.unfollow_document_link.addClass(\"hidden\");\n\t\tthis.follow_document_link.removeClass(\"hidden\");\n\t\tthis.followed_by.addClass(\"hidden\");\n\t\tthis.followed_by_label.addClass(\"hidden\");\n\t}\n};\n", "frappe.ui.form.set_user_image = function (frm) {\n\tvar image_section = frm.sidebar.image_section;\n\tvar image_field = frm.meta.image_field;\n\tvar image = frm.doc[image_field];\n\tvar title_image = frm.page.$title_area.find(\".title-image\");\n\tvar image_actions = frm.sidebar.image_wrapper.find(\".sidebar-image-actions\");\n\n\timage_section.toggleClass(\"hide\", image_field ? false : true);\n\ttitle_image.toggleClass(\"hide\", image_field ? false : true);\n\n\tif (!image_field) {\n\t\treturn;\n\t}\n\n\t// if image field has value\n\tif (image) {\n\t\timage = window.cordova && image.indexOf(\"http\") === -1 ? frappe.base_url + image : image;\n\n\t\timage_section.find(\".sidebar-image\").attr(\"src\", image).removeClass(\"hide\");\n\n\t\timage_section.find(\".sidebar-standard-image\").addClass(\"hide\");\n\n\t\ttitle_image.css(\"background-image\", `url(\"${image}\")`).html(\"\");\n\n\t\timage_actions.find(\".sidebar-image-change, .sidebar-image-remove\").show();\n\t} else {\n\t\timage_section.find(\".sidebar-image\").attr(\"src\", null).addClass(\"hide\");\n\n\t\tvar title = frm.get_title();\n\n\t\timage_section\n\t\t\t.find(\".sidebar-standard-image\")\n\t\t\t.removeClass(\"hide\")\n\t\t\t.find(\".standard-image\")\n\t\t\t.html(frappe.get_abbr(title));\n\n\t\ttitle_image.css(\"background-image\", \"\").html(frappe.get_abbr(title));\n\n\t\timage_actions.find(\".sidebar-image-change\").show();\n\t\timage_actions.find(\".sidebar-image-remove\").hide();\n\t}\n};\n\nfrappe.ui.form.setup_user_image_event = function (frm) {\n\t// re-draw image on change of user image\n\tif (frm.meta.image_field) {\n\t\tfrappe.ui.form.on(frm.doctype, frm.meta.image_field, function (frm) {\n\t\t\tfrappe.ui.form.set_user_image(frm);\n\t\t});\n\t}\n\n\tif (frm.meta.image_field && !frm.fields_dict[frm.meta.image_field].df.read_only) {\n\t\tfrm.sidebar.image_wrapper.on(\"click\", \":not(.sidebar-image-actions)\", (e) => {\n\t\t\tlet $target = $(e.currentTarget);\n\t\t\tif ($target.is(\"a.dropdown-toggle, .dropdown\")) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet dropdown = frm.sidebar.image_wrapper.find(\".sidebar-image-actions .dropdown\");\n\t\t\tdropdown.toggleClass(\"open\");\n\t\t\te.stopPropagation();\n\t\t});\n\t}\n\n\t// bind click on image_wrapper\n\tfrm.sidebar.image_wrapper.on(\n\t\t\"click\",\n\t\t\".sidebar-image-change, .sidebar-image-remove\",\n\t\tfunction (e) {\n\t\t\tlet $target = $(e.currentTarget);\n\t\t\tvar field = frm.get_field(frm.meta.image_field);\n\t\t\tif ($target.is(\".sidebar-image-change\")) {\n\t\t\t\tif (!field.$input) {\n\t\t\t\t\tfield.make_input();\n\t\t\t\t}\n\t\t\t\tfield.$input.trigger(\"attach_doc_image\");\n\t\t\t\t// close sidebar\n\t\t\t\tfrm.page.close_sidebar?.();\n\t\t\t} else {\n\t\t\t\t/// on remove event for a sidebar image wrapper remove attach file.\n\t\t\t\tfrm.attachments.remove_attachment_by_filename(\n\t\t\t\t\tfrm.doc[frm.meta.image_field],\n\t\t\t\t\tfunction () {\n\t\t\t\t\t\tfield.set_value(\"\").then(() => frm.save());\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t);\n};\n", "frappe.ui.form.SidebarUsers = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tget_users(type) {\n\t\tlet docinfo = this.frm.get_docinfo();\n\t\treturn docinfo ? docinfo[type] || null : null;\n\t}\n\n\trefresh(data_updated, type) {\n\t\tthis.parent =\n\t\t\ttype == \"viewers\"\n\t\t\t\t? this.$wrapper.find(\".form-viewers\")\n\t\t\t\t: this.$wrapper.find(\".form-typers\");\n\t\tthis.parent.empty();\n\n\t\tconst users = this.get_users(type);\n\t\tusers && this.show_in_sidebar(users, type, data_updated);\n\t}\n\n\tshow_in_sidebar(users, type, show_alert) {\n\t\tlet sidebar_users = [];\n\t\tlet new_users = [];\n\t\tlet current_users = [];\n\n\t\tconst message = type == \"viewers\" ? \"viewing this document\" : \"composing an email\";\n\n\t\tusers.current.forEach((username) => {\n\t\t\tif (username === frappe.session.user) {\n\t\t\t\t// current user\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar user_info = frappe.user_info(username);\n\t\t\tsidebar_users.push({\n\t\t\t\timage: user_info.image,\n\t\t\t\tfullname: user_info.fullname,\n\t\t\t\tabbr: user_info.abbr,\n\t\t\t\tcolor: user_info.color,\n\t\t\t\ttitle: __(\"{0} is currently {1}\", [user_info.fullname, message]),\n\t\t\t});\n\n\t\t\tif (users.new.indexOf(username) !== -1) {\n\t\t\t\tnew_users.push(user_info.fullname);\n\t\t\t}\n\n\t\t\tcurrent_users.push(user_info.fullname);\n\t\t});\n\n\t\tif (sidebar_users.length) {\n\t\t\tthis.parent.parent().removeClass(\"hidden\");\n\t\t\tthis.parent.append(\n\t\t\t\tfrappe.render_template(\"users_in_sidebar\", { users: sidebar_users })\n\t\t\t);\n\t\t} else {\n\t\t\tthis.parent.parent().addClass(\"hidden\");\n\t\t}\n\n\t\t// For typers always show the alert\n\t\t// For viewers show the alert to new user viewing this document\n\t\tconst alert_users = type == \"viewers\" ? new_users : current_users;\n\t\tshow_alert && this.show_alert(alert_users, message);\n\t}\n\n\tshow_alert(users, message) {\n\t\tif (users.length) {\n\t\t\tif (users.length === 1) {\n\t\t\t\tfrappe.show_alert(__(\"{0} is currently {1}\", [users[0], message]));\n\t\t\t} else {\n\t\t\t\tfrappe.show_alert(\n\t\t\t\t\t__(\"{0} are currently {1}\", [frappe.utils.comma_and(users), message])\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n};\n", "import \"./assign_to\";\nimport \"./attachments\";\nimport \"./share\";\nimport \"./review\";\nimport \"./document_follow\";\nimport \"./user_image\";\nimport \"./form_sidebar_users\";\n\nfrappe.ui.form.Sidebar = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tmake() {\n\t\tvar sidebar_content = frappe.render_template(\"form_sidebar\", {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tfrm: this.frm,\n\t\t});\n\n\t\tthis.sidebar = $('<div class=\"form-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.comments = this.sidebar.find(\".form-sidebar-stats .comments\");\n\t\tthis.user_actions = this.sidebar.find(\".user-actions\");\n\t\tthis.image_section = this.sidebar.find(\".sidebar-image-section\");\n\t\tthis.image_wrapper = this.image_section.find(\".sidebar-image-wrapper\");\n\t\tthis.make_assignments();\n\t\tthis.make_attachments();\n\t\tthis.make_review();\n\t\tthis.make_shared();\n\n\t\tthis.make_tags();\n\t\tthis.make_like();\n\t\tthis.make_follow();\n\n\t\tthis.bind_events();\n\t\tthis.setup_keyboard_shortcuts();\n\t\tthis.show_auto_repeat_status();\n\t\tfrappe.ui.form.setup_user_image_event(this.frm);\n\n\t\tthis.refresh();\n\t}\n\n\tbind_events() {\n\t\tvar me = this;\n\n\t\t// scroll to comments\n\t\tthis.comments.on(\"click\", function () {\n\t\t\tfrappe.utils.scroll_to(me.frm.footer.wrapper.find(\".comment-box\"), true);\n\t\t});\n\n\t\tthis.like_icon.on(\"click\", function () {\n\t\t\tfrappe.ui.toggle_like(me.like_wrapper, me.frm.doctype, me.frm.doc.name, function () {\n\t\t\t\tme.refresh_like();\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup_keyboard_shortcuts() {\n\t\t// add assignment shortcut\n\t\tlet assignment_link = this.sidebar.find(\".add-assignment\");\n\t\tfrappe.ui.keys.get_shortcut_group(this.page).add(assignment_link);\n\t}\n\n\trefresh() {\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.sidebar.toggle(false);\n\t\t\tthis.page.sidebar.addClass(\"hide-sidebar\");\n\t\t} else {\n\t\t\tthis.page.sidebar.removeClass(\"hide-sidebar\");\n\t\t\tthis.sidebar.toggle(true);\n\t\t\tthis.frm.assign_to.refresh();\n\t\t\tthis.frm.attachments.refresh();\n\t\t\tthis.frm.shared.refresh();\n\n\t\t\tthis.frm.tags && this.frm.tags.refresh(this.frm.get_docinfo().tags);\n\n\t\t\tif (this.frm.doc.route && cint(frappe.boot.website_tracking_enabled)) {\n\t\t\t\tlet route = this.frm.doc.route;\n\t\t\t\tfrappe.utils.get_page_view_count(route).then((res) => {\n\t\t\t\t\tthis.sidebar\n\t\t\t\t\t\t.find(\".pageview-count\")\n\t\t\t\t\t\t.html(__(\"{0} Page Views\", [String(res.message).bold()]));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.sidebar\n\t\t\t\t.find(\".modified-by\")\n\t\t\t\t.html(\n\t\t\t\t\t__(\n\t\t\t\t\t\t\"{0} edited this {1}\",\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tfrappe.user.full_name(this.frm.doc.modified_by).bold(),\n\t\t\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.modified),\n\t\t\t\t\t\t],\n\t\t\t\t\t\t\"For example, 'Jon Doe edited this 5 minutes ago'.\"\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\tthis.sidebar\n\t\t\t\t.find(\".created-by\")\n\t\t\t\t.html(\n\t\t\t\t\t__(\n\t\t\t\t\t\t\"{0} created this {1}\",\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tfrappe.user.full_name(this.frm.doc.owner).bold(),\n\t\t\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.creation),\n\t\t\t\t\t\t],\n\t\t\t\t\t\t\"For example, 'Jon Doe created this 5 minutes ago'.\"\n\t\t\t\t\t)\n\t\t\t\t);\n\n\t\t\tthis.refresh_like();\n\t\t\tthis.refresh_follow();\n\t\t\tthis.refresh_comments_count();\n\t\t\tfrappe.ui.form.set_user_image(this.frm);\n\t\t}\n\t}\n\n\tshow_auto_repeat_status() {\n\t\tif (this.frm.meta.allow_auto_repeat && this.frm.doc.auto_repeat) {\n\t\t\tconst me = this;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Auto Repeat\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\tname: this.frm.doc.auto_repeat,\n\t\t\t\t\t},\n\t\t\t\t\tfieldname: [\"frequency\"],\n\t\t\t\t},\n\t\t\t\tcallback: function (res) {\n\t\t\t\t\tme.sidebar\n\t\t\t\t\t\t.find(\".auto-repeat-status\")\n\t\t\t\t\t\t.html(__(\"Repeats {0}\", [__(res.message.frequency)]));\n\t\t\t\t\tme.sidebar.find(\".auto-repeat-status\").on(\"click\", function () {\n\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Auto Repeat\", me.frm.doc.auto_repeat);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_tags() {\n\t\tif (this.frm.meta.issingle) {\n\t\t\tthis.sidebar.find(\".form-tags\").toggle(false);\n\t\t\treturn;\n\t\t}\n\n\t\tlet tags_parent = this.sidebar.find(\".form-tags\");\n\n\t\tthis.frm.tags = new frappe.ui.TagEditor({\n\t\t\tparent: tags_parent,\n\t\t\tadd_button: tags_parent.find(\".add-tags-btn\"),\n\t\t\tfrm: this.frm,\n\t\t\ton_change: function (user_tags) {\n\t\t\t\tthis.frm.tags && this.frm.tags.refresh(user_tags);\n\t\t\t},\n\t\t});\n\t}\n\n\tmake_attachments() {\n\t\tvar me = this;\n\t\tthis.frm.attachments = new frappe.ui.form.Attachments({\n\t\t\tparent: me.sidebar.find(\".form-attachments\"),\n\t\t\tfrm: me.frm,\n\t\t});\n\t}\n\n\tmake_assignments() {\n\t\tthis.frm.assign_to = new frappe.ui.form.AssignTo({\n\t\t\tparent: this.sidebar.find(\".form-assignments\"),\n\t\t\tfrm: this.frm,\n\t\t});\n\t}\n\n\tmake_shared() {\n\t\tthis.frm.shared = new frappe.ui.form.Share({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-shared\"),\n\t\t});\n\t}\n\n\tadd_user_action(label, click) {\n\t\treturn $(\"<a>\")\n\t\t\t.html(label)\n\t\t\t.appendTo(\n\t\t\t\t$('<li class=\"user-action-row\">').appendTo(this.user_actions.removeClass(\"hidden\"))\n\t\t\t)\n\t\t\t.on(\"click\", click);\n\t}\n\n\tclear_user_actions() {\n\t\tthis.user_actions.addClass(\"hidden\");\n\t\tthis.user_actions.find(\".user-action-row\").remove();\n\t}\n\n\tmake_like() {\n\t\tthis.like_wrapper = this.sidebar.find(\".liked-by\");\n\t\tthis.like_icon = this.sidebar.find(\".liked-by .like-icon\");\n\t\tthis.like_count = this.sidebar.find(\".liked-by .like-count\");\n\t\tfrappe.ui.setup_like_popover(this.sidebar.find(\".form-stats-likes\"), \".like-icon\");\n\t}\n\n\tmake_follow() {\n\t\tthis.follow_button = this.sidebar.find(\".form-sidebar-stats .form-follow\");\n\n\t\tthis.follow_button.on(\"click\", () => {\n\t\t\tlet is_followed = this.frm.get_docinfo().is_document_followed;\n\t\t\tfrappe\n\t\t\t\t.call(\"frappe.desk.form.document_follow.update_follow\", {\n\t\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\t\tdoc_name: this.frm.doc.name,\n\t\t\t\t\tfollowing: !is_followed,\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tfrappe.model.set_docinfo(\n\t\t\t\t\t\tthis.frm.doctype,\n\t\t\t\t\t\tthis.frm.doc.name,\n\t\t\t\t\t\t\"is_document_followed\",\n\t\t\t\t\t\t!is_followed\n\t\t\t\t\t);\n\t\t\t\t\tthis.refresh_follow(!is_followed);\n\t\t\t\t});\n\t\t});\n\t}\n\n\trefresh_follow(follow) {\n\t\tif (follow == null) {\n\t\t\tfollow = this.frm.get_docinfo().is_document_followed;\n\t\t}\n\t\tthis.follow_button.text(follow ? __(\"Unfollow\") : __(\"Follow\"));\n\t}\n\n\trefresh_like() {\n\t\tif (!this.like_icon) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.like_wrapper.attr(\"data-liked-by\", this.frm.doc._liked_by);\n\t\tconst liked = frappe.ui.is_liked(this.frm.doc);\n\t\tthis.like_wrapper\n\t\t\t.toggleClass(\"not-liked\", !liked)\n\t\t\t.toggleClass(\"liked\", liked)\n\t\t\t.attr(\"data-doctype\", this.frm.doctype)\n\t\t\t.attr(\"data-name\", this.frm.doc.name);\n\n\t\tthis.like_count && this.like_count.text(JSON.parse(this.frm.doc._liked_by || \"[]\").length);\n\t}\n\n\trefresh_comments_count() {\n\t\tlet count = (this.frm.get_docinfo().comments || []).length;\n\t\tthis.comments.find(\".comments-count\").html(count);\n\t}\n\n\trefresh_image() {}\n\n\tmake_review() {\n\t\tconst review_wrapper = this.sidebar.find(\".form-reviews\");\n\t\tif (frappe.boot.energy_points_enabled && !this.frm.is_new()) {\n\t\t\tthis.frm.reviews = new frappe.ui.form.Review({\n\t\t\t\tparent: review_wrapper,\n\t\t\t\tfrm: this.frm,\n\t\t\t});\n\t\t} else {\n\t\t\treview_wrapper.remove();\n\t\t}\n\t}\n\n\treload_docinfo(callback) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.form.load.get_docinfo\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\t// docinfo will be synced\n\t\t\t\tif (callback) callback(r.docinfo);\n\t\t\t\tthis.frm.timeline && this.frm.timeline.refresh();\n\t\t\t\tthis.frm.assign_to.refresh();\n\t\t\t\tthis.frm.attachments.refresh();\n\t\t\t},\n\t\t});\n\t}\n};\n", "// Copyright (c) 2020, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nclass BaseTimeline {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.timeline_wrapper = $(`<div class=\"new-timeline\">`);\n\t\tthis.wrapper = this.timeline_wrapper;\n\t\tthis.timeline_items_wrapper = $(`<div class=\"timeline-items\">`);\n\t\tthis.timeline_actions_wrapper = $(`\n\t\t\t<div class=\"timeline-items timeline-actions\">\n\t\t\t\t<div class=\"timeline-item\">\n\t\t\t\t\t<div class=\"timeline-dot\"></div>\n\t\t\t\t\t<div class=\"timeline-content action-buttons\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.timeline_wrapper.append(this.timeline_actions_wrapper);\n\t\tthis.timeline_actions_wrapper.hide();\n\t\tthis.timeline_wrapper.append(this.timeline_items_wrapper);\n\n\t\tthis.parent.replaceWith(this.timeline_wrapper);\n\t\tthis.timeline_items = [];\n\t}\n\n\trefresh() {\n\t\tthis.render_timeline_items();\n\t}\n\n\tadd_action_button(label, action, icon = null, btn_class = null) {\n\t\tlet icon_element = icon ? frappe.utils.icon(icon, \"xs\") : null;\n\t\tthis.timeline_actions_wrapper.show();\n\t\tlet action_btn = $(`<button class=\"btn btn-xs ${btn_class || \"btn-default\"} action-btn\">\n\t\t\t${icon_element}\n\t\t\t${label}\n\t\t</button>`);\n\t\taction_btn.click(action);\n\t\tthis.timeline_actions_wrapper.find(\".action-buttons\").append(action_btn);\n\t\treturn action_btn;\n\t}\n\n\trender_timeline_items() {\n\t\tthis.timeline_items_wrapper.empty();\n\t\tthis.timeline_items = [];\n\t\tthis.doc_info = (this.frm && this.frm.get_docinfo()) || {};\n\t\tlet response = this.prepare_timeline_contents();\n\t\tif (response instanceof Promise) {\n\t\t\tresponse.then(() => {\n\t\t\t\tthis.timeline_items.sort(\n\t\t\t\t\t(item1, item2) => new Date(item2.creation) - new Date(item1.creation)\n\t\t\t\t);\n\t\t\t\tthis.timeline_items.forEach(this.add_timeline_item.bind(this));\n\t\t\t});\n\t\t} else {\n\t\t\tthis.timeline_items.sort(\n\t\t\t\t(item1, item2) => new Date(item2.creation) - new Date(item1.creation)\n\t\t\t);\n\t\t\tthis.timeline_items.forEach(this.add_timeline_item.bind(this));\n\t\t}\n\t}\n\n\tprepare_timeline_contents() {\n\t\t//\n\t}\n\n\tadd_timeline_item(item, append_at_the_end = false) {\n\t\tlet timeline_item = this.get_timeline_item(item);\n\t\tif (append_at_the_end) {\n\t\t\tthis.timeline_items_wrapper.append(timeline_item);\n\t\t} else {\n\t\t\tthis.timeline_items_wrapper.prepend(timeline_item);\n\t\t}\n\t\treturn timeline_item;\n\t}\n\n\tadd_timeline_items(items, append_at_the_end = false) {\n\t\titems.forEach((item) => this.add_timeline_item(item, append_at_the_end));\n\t}\n\n\tadd_timeline_items_based_on_creation(items) {\n\t\titems.forEach((item) => {\n\t\t\tthis.timeline_items_wrapper.find(\".timeline-item\").each((i, el) => {\n\t\t\t\tlet creation = $(el).attr(\"data-timestamp\");\n\t\t\t\tif (creation && new Date(creation) < new Date(item.creation)) {\n\t\t\t\t\t$(el).before(this.get_timeline_item(item));\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_timeline_item(item) {\n\t\t// item can have content*, creation*,\n\t\t// timeline_badge, icon, icon_size,\n\t\t// hide_timestamp, is_card\n\t\tconst timeline_item = $(`<div class=\"timeline-item\">`);\n\n\t\tif (item.name == \"load-more\") {\n\t\t\ttimeline_item.append(\n\t\t\t\t`<div class=\"timeline-load-more\">\n\t\t\t\t\t<button class=\"btn btn-default btn-sm btn-load-more\">\n\t\t\t\t\t\t<span>${item.content}</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>`\n\t\t\t);\n\t\t\ttimeline_item.find(\".btn-load-more\").on(\"click\", async () => {\n\t\t\t\tlet more_items = await this.get_more_communication_timeline_contents();\n\t\t\t\ttimeline_item.remove();\n\t\t\t\tthis.add_timeline_items_based_on_creation(more_items);\n\t\t\t});\n\t\t\treturn timeline_item;\n\t\t}\n\n\t\ttimeline_item.attr({\n\t\t\t\"data-doctype\": item.doctype,\n\t\t\t\"data-name\": item.name,\n\t\t\t\"data-timestamp\": item.creation,\n\t\t});\n\t\tif (item.icon) {\n\t\t\ttimeline_item.append(`\n\t\t\t\t<div class=\"timeline-badge\" title='${item.title || frappe.utils.to_title_case(item.icon)}'>\n\t\t\t\t\t${frappe.utils.icon(item.icon, item.icon_size || \"md\")}\n\t\t\t\t</div>\n\t\t\t`);\n\t\t} else if (item.timeline_badge) {\n\t\t\ttimeline_item.append(item.timeline_badge);\n\t\t} else {\n\t\t\ttimeline_item.append(`<div class=\"timeline-dot\">`);\n\t\t}\n\n\t\ttimeline_item.append(\n\t\t\t`<div class=\"timeline-content ${item.is_card ? \"frappe-card\" : \"\"}\">`\n\t\t);\n\t\tlet timeline_content = timeline_item.find(\".timeline-content\");\n\t\ttimeline_content.append(item.content);\n\t\tif (!item.hide_timestamp && !item.is_card) {\n\t\t\ttimeline_content.append(`<span> - ${comment_when(item.creation)}</span>`);\n\t\t}\n\t\tif (item.id) {\n\t\t\ttimeline_content.attr(\"id\", item.id);\n\t\t}\n\n\t\treturn timeline_item;\n\t}\n}\n\nexport default BaseTimeline;\n", "// REDESIGN-TODO: Review\n\nfunction get_version_timeline_content(version_doc, frm) {\n\tif (!version_doc.data) return [];\n\tconst data = JSON.parse(version_doc.data);\n\n\t// comment\n\tif (data.comment) {\n\t\treturn [get_version_comment(version_doc, data.comment)];\n\t}\n\n\tlet out = [];\n\n\tlet updater_reference_link = null;\n\tlet updater_reference = data.updater_reference;\n\tif (!$.isEmptyObject(updater_reference)) {\n\t\tlet label = updater_reference.label || __(\"via {0}\", [updater_reference.doctype]);\n\t\tlet { doctype, docname } = updater_reference;\n\t\tif (doctype && docname) {\n\t\t\tupdater_reference_link = frappe.utils.get_form_link(doctype, docname, true, label);\n\t\t} else {\n\t\t\tupdater_reference_link = label;\n\t\t}\n\t}\n\n\t// value changed in parent\n\tif (data.changed && data.changed.length) {\n\t\tvar parts = [];\n\t\tdata.changed.every(function (p) {\n\t\t\tif (p[0] === \"docstatus\") {\n\t\t\t\tif (p[2] === 1) {\n\t\t\t\t\tlet message = updater_reference_link\n\t\t\t\t\t\t? __(\"{0} submitted this document {1}\", [\n\t\t\t\t\t\t\t\tget_user_link(version_doc),\n\t\t\t\t\t\t\t\tupdater_reference_link,\n\t\t\t\t\t\t  ])\n\t\t\t\t\t\t: __(\"{0} submitted this document\", [get_user_link(version_doc)]);\n\t\t\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t\t\t} else if (p[2] === 2) {\n\t\t\t\t\tlet message = updater_reference_link\n\t\t\t\t\t\t? __(\"{0} cancelled this document {1}\", [\n\t\t\t\t\t\t\t\tget_user_link(version_doc),\n\t\t\t\t\t\t\t\tupdater_reference_link,\n\t\t\t\t\t\t  ])\n\t\t\t\t\t\t: __(\"{0} cancelled this document\", [get_user_link(version_doc)]);\n\t\t\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst df = frappe.meta.get_docfield(frm.doctype, p[0], frm.docname);\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tconst field_display_status = frappe.perm.get_field_display_status(\n\t\t\t\t\t\tdf,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tfrm.perm\n\t\t\t\t\t);\n\t\t\t\t\tif (field_display_status === \"Read\" || field_display_status === \"Write\") {\n\t\t\t\t\t\tparts.push(\n\t\t\t\t\t\t\t__(\"{0} from {1} to {2}\", [\n\t\t\t\t\t\t\t\t__(df.label),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[1]),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[2]),\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn parts.length < 3;\n\t\t});\n\t\tif (parts.length) {\n\t\t\tlet message;\n\t\t\tif (updater_reference_link) {\n\t\t\t\tmessage = __(\"{0} changed value of {1} {2}\", [\n\t\t\t\t\tget_user_link(version_doc),\n\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\tupdater_reference_link,\n\t\t\t\t]);\n\t\t\t} else {\n\t\t\t\tmessage = __(\"{0} changed value of {1}\", [\n\t\t\t\t\tget_user_link(version_doc),\n\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t]);\n\t\t\t}\n\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t}\n\t}\n\n\t// value changed in table field\n\tif (data.row_changed && data.row_changed.length) {\n\t\tlet parts = [];\n\t\tdata.row_changed.every(function (row) {\n\t\t\trow[3].every(function (p) {\n\t\t\t\tvar df =\n\t\t\t\t\tfrm.fields_dict[row[0]] &&\n\t\t\t\t\tfrappe.meta.get_docfield(\n\t\t\t\t\t\tfrm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\tp[0],\n\t\t\t\t\t\tfrm.docname\n\t\t\t\t\t);\n\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(\n\t\t\t\t\t\tdf,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tfrm.perm\n\t\t\t\t\t);\n\n\t\t\t\t\tif (field_display_status === \"Read\" || field_display_status === \"Write\") {\n\t\t\t\t\t\tparts.push(\n\t\t\t\t\t\t\t__(\"{0} from {1} to {2} in row #{3}\", [\n\t\t\t\t\t\t\t\tfrappe.meta.get_label(frm.fields_dict[row[0]].grid.doctype, p[0]),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[1]),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[2]),\n\t\t\t\t\t\t\t\trow[1],\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn parts.length < 3;\n\t\t\t});\n\t\t\treturn parts.length < 3;\n\t\t});\n\t\tif (parts.length) {\n\t\t\tlet message;\n\t\t\tif (updater_reference_link) {\n\t\t\t\tmessage = __(\"{0} changed values for {1} {2}\", [\n\t\t\t\t\tget_user_link(version_doc),\n\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\tupdater_reference_link,\n\t\t\t\t]);\n\t\t\t} else {\n\t\t\t\tmessage = __(\"{0} changed values for {1}\", [\n\t\t\t\t\tget_user_link(version_doc),\n\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t]);\n\t\t\t}\n\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t}\n\t}\n\n\t// rows added / removed\n\t// __('added'), __('removed') # for translation, don't remove\n\t[\"added\", \"removed\"].forEach(function (key) {\n\t\tif (data[key] && data[key].length) {\n\t\t\tlet parts = (data[key] || []).map(function (p) {\n\t\t\t\tvar df = frappe.meta.get_docfield(frm.doctype, p[0], frm.docname);\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(\n\t\t\t\t\t\tdf,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tfrm.perm\n\t\t\t\t\t);\n\n\t\t\t\t\tif (field_display_status === \"Read\" || field_display_status === \"Write\") {\n\t\t\t\t\t\treturn __(frappe.meta.get_label(frm.doctype, p[0]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tparts = parts.filter(function (p) {\n\t\t\t\treturn p;\n\t\t\t});\n\t\t\tif (parts.length) {\n\t\t\t\tlet message = \"\";\n\n\t\t\t\tif (key === \"added\") {\n\t\t\t\t\tmessage = __(\"added rows for {0}\", [parts.join(\", \")]);\n\t\t\t\t} else if (key === \"removed\") {\n\t\t\t\t\tmessage = __(\"removed rows for {0}\", [parts.join(\", \")]);\n\t\t\t\t}\n\n\t\t\t\tlet version_comment = get_version_comment(version_doc, message);\n\t\t\t\tlet user_link = get_user_link(version_doc);\n\t\t\t\tout.push(`${user_link} ${version_comment}`);\n\t\t\t}\n\t\t}\n\t});\n\n\treturn out;\n}\n\nfunction get_version_comment(version_doc, text) {\n\t// TODO: Replace with a better solution\n\tif (text.includes(\"<a\")) {\n\t\t// if text already has linked content in it\n\t\t// then just add a version link to unlinked content\n\t\tlet version_comment = \"\";\n\t\tlet unlinked_content = \"\";\n\n\t\ttry {\n\t\t\ttext += \"</>\";\n\t\t\tArray.from($(text)).forEach((element) => {\n\t\t\t\tif ($(element).is(\"a\")) {\n\t\t\t\t\tversion_comment += unlinked_content\n\t\t\t\t\t\t? frappe.utils.get_form_link(\n\t\t\t\t\t\t\t\t\"Version\",\n\t\t\t\t\t\t\t\tversion_doc.name,\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\tunlinked_content\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: \"\";\n\t\t\t\t\tunlinked_content = \"\";\n\t\t\t\t\tversion_comment += element.outerHTML;\n\t\t\t\t} else {\n\t\t\t\t\tunlinked_content += element.outerHTML || element.textContent;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (unlinked_content) {\n\t\t\t\tversion_comment += frappe.utils.get_form_link(\n\t\t\t\t\t\"Version\",\n\t\t\t\t\tversion_doc.name,\n\t\t\t\t\ttrue,\n\t\t\t\t\tunlinked_content\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn version_comment;\n\t\t} catch (e) {\n\t\t\t// pass\n\t\t}\n\t}\n\treturn frappe.utils.get_form_link(\"Version\", version_doc.name, true, text);\n}\n\nfunction format_content_for_timeline(content) {\n\t// text to HTML\n\t// limits content to 40 characters\n\t// escapes HTML\n\t// and makes it bold\n\tcontent = frappe.ellipsis(content, 40) || '\"\"';\n\tcontent = frappe.utils.escape_html(content);\n\treturn content.bold();\n}\n\nfunction get_user_link(doc) {\n\tconst user = doc.owner;\n\tconst user_display_text = (frappe.user_info(user).fullname || \"\").bold();\n\treturn frappe.utils.get_form_link(\"User\", user, true, user_display_text);\n}\n\nexport { get_version_timeline_content };\n", "// Copyright (c) 2020, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport BaseTimeline from \"./base_timeline\";\nimport { get_version_timeline_content } from \"./version_timeline_content_builder\";\n\nclass FormTimeline extends BaseTimeline {\n\tmake() {\n\t\tsuper.make();\n\t\tthis.setup_timeline_actions();\n\t\tthis.render_timeline_items();\n\t\tthis.setup_activity_toggle();\n\t}\n\n\trefresh() {\n\t\tsuper.refresh();\n\t\tthis.frm.trigger(\"timeline_refresh\");\n\t\tthis.setup_document_email_link();\n\t}\n\n\tsetup_timeline_actions() {\n\t\tthis.add_action_button(\n\t\t\t__(\"New Email\"),\n\t\t\t() => this.compose_mail(),\n\t\t\t\"mail\",\n\t\t\t\"btn-secondary-dark\"\n\t\t);\n\t\tthis.setup_new_event_button();\n\t}\n\n\tsetup_new_event_button() {\n\t\tif (this.frm.meta.allow_events_in_timeline) {\n\t\t\tlet create_event = () => {\n\t\t\t\tconst args = {\n\t\t\t\t\tdoc: this.frm.doc,\n\t\t\t\t\tfrm: this.frm,\n\t\t\t\t\trecipients: this.get_recipient(),\n\t\t\t\t\ttxt: frappe.markdown(this.frm.comment_box.get_value()),\n\t\t\t\t};\n\t\t\t\treturn new frappe.views.InteractionComposer(args);\n\t\t\t};\n\t\t\tthis.add_action_button(__(\"New Event\"), create_event, \"calendar\");\n\t\t}\n\t}\n\n\tsetup_activity_toggle() {\n\t\tlet doc_info = this.doc_info || this.frm.get_docinfo();\n\t\tlet has_communications = () => {\n\t\t\tlet communications = doc_info.communications;\n\t\t\tlet comments = doc_info.comments;\n\t\t\treturn (communications || []).length || (comments || []).length;\n\t\t};\n\t\tlet me = this;\n\t\tif (has_communications()) {\n\t\t\tthis.timeline_wrapper\n\t\t\t\t.prepend(\n\t\t\t\t\t`\n\t\t\t\t<div class=\"timeline-item activity-toggle\">\n\t\t\t\t\t<div class=\"timeline-dot\"></div>\n\t\t\t\t\t<div class=\"timeline-content flex align-center\">\n\t\t\t\t\t\t<h4>${__(\"Activity\")}</h4>\n\t\t\t\t\t\t<nav class=\"nav nav-pills flex-row\">\n\t\t\t\t\t\t\t<a class=\"flex-sm-fill text-sm-center nav-link\" data-only-communication=\"true\">${__(\n\t\t\t\t\t\t\t\t\"Communication\"\n\t\t\t\t\t\t\t)}</a>\n\t\t\t\t\t\t\t<a class=\"flex-sm-fill text-sm-center nav-link active\">${__(\"All\")}</a>\n\t\t\t\t\t\t</nav>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`\n\t\t\t\t)\n\t\t\t\t.find(\"a\")\n\t\t\t\t.on(\"click\", function (e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tme.only_communication = $(this).data().onlyCommunication;\n\t\t\t\t\tme.render_timeline_items();\n\t\t\t\t\t$(this).tab(\"show\");\n\t\t\t\t});\n\t\t}\n\t}\n\n\tsetup_document_email_link() {\n\t\tlet doc_info = this.doc_info || this.frm.get_docinfo();\n\n\t\tthis.document_email_link_wrapper && this.document_email_link_wrapper.remove();\n\n\t\tif (doc_info.document_email) {\n\t\t\tconst link = `<a class=\"document-email-link\">${doc_info.document_email}</a>`;\n\t\t\tconst message = __(\"Add to this activity by mailing to {0}\", [link.bold()]);\n\n\t\t\tthis.document_email_link_wrapper = $(`\n\t\t\t\t<div class=\"timeline-item\">\n\t\t\t\t\t<div class=\"timeline-dot\"></div>\n\t\t\t\t\t<div class=\"timeline-content\">\n\t\t\t\t\t\t<span>${message}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.timeline_actions_wrapper.append(this.document_email_link_wrapper);\n\n\t\t\tthis.document_email_link_wrapper.find(\".document-email-link\").on(\"click\", (e) => {\n\t\t\t\tlet text = $(e.target).text();\n\t\t\t\tfrappe.utils.copy_to_clipboard(text);\n\t\t\t});\n\t\t}\n\t}\n\n\trender_timeline_items() {\n\t\tsuper.render_timeline_items();\n\t\tthis.set_document_info();\n\t\tfrappe.utils.bind_actions_with_object(this.timeline_items_wrapper, this);\n\t}\n\n\tset_document_info() {\n\t\t// TODO: handle creation via automation\n\t\tconst creation = comment_when(this.frm.doc.creation);\n\t\tlet creation_message = frappe.utils.is_current_user(this.frm.doc.owner)\n\t\t\t? __(\"You created this {0}\", [creation], \"Form timeline\")\n\t\t\t: __(\n\t\t\t\t\t\"{0} created this {1}\",\n\t\t\t\t\t[this.get_user_link(this.frm.doc.owner), creation],\n\t\t\t\t\t\"Form timeline\"\n\t\t\t  );\n\n\t\tconst modified = comment_when(this.frm.doc.modified);\n\t\tlet modified_message = frappe.utils.is_current_user(this.frm.doc.modified_by)\n\t\t\t? __(\"You edited this {0}\", [modified], \"Form timeline\")\n\t\t\t: __(\n\t\t\t\t\t\"{0} edited this {1}\",\n\t\t\t\t\t[this.get_user_link(this.frm.doc.modified_by), modified],\n\t\t\t\t\t\"Form timeline\"\n\t\t\t  );\n\n\t\tif (this.frm.doc.route && cint(frappe.boot.website_tracking_enabled)) {\n\t\t\tlet route = this.frm.doc.route;\n\t\t\tfrappe.utils.get_page_view_count(route).then((res) => {\n\t\t\t\tlet page_view_count_message = __(\"{0} Page views\", [res.message], \"Form timeline\");\n\t\t\t\tthis.add_timeline_item(\n\t\t\t\t\t{\n\t\t\t\t\t\tcontent: `${creation_message} \u2022 ${modified_message} \u2022 \t${page_view_count_message}`,\n\t\t\t\t\t\thide_timestamp: true,\n\t\t\t\t\t},\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.add_timeline_item(\n\t\t\t\t{\n\t\t\t\t\tcontent: `${creation_message} \u2022 ${modified_message}`,\n\t\t\t\t\thide_timestamp: true,\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t}\n\n\tprepare_timeline_contents() {\n\t\tthis.timeline_items.push(...this.get_communication_timeline_contents());\n\t\tthis.timeline_items.push(...this.get_comment_timeline_contents());\n\t\tif (!this.only_communication) {\n\t\t\tthis.timeline_items.push(...this.get_view_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_energy_point_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_version_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_share_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_workflow_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_like_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_custom_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_assignment_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_attachment_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_info_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_milestone_timeline_contents());\n\t\t}\n\t}\n\n\tget_user_link(user) {\n\t\tconst user_display_text = (frappe.user_info(user).fullname || \"\").bold();\n\t\treturn frappe.utils.get_form_link(\"User\", user, true, user_display_text);\n\t}\n\n\tget_view_timeline_contents() {\n\t\tlet view_timeline_contents = [];\n\t\t(this.doc_info.views || []).forEach((view) => {\n\t\t\tconst view_time = comment_when(view.creation);\n\t\t\tlet view_message = frappe.utils.is_current_user(view.owner)\n\t\t\t\t? __(\"You viewed this {0}\", [view_time], \"Form timeline\")\n\t\t\t\t: __(\n\t\t\t\t\t\t\"{0} viewed this {1}\",\n\t\t\t\t\t\t[this.get_user_link(view.owner), view_time],\n\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t  );\n\n\t\t\tview_timeline_contents.push({\n\t\t\t\tcreation: view.creation,\n\t\t\t\tcontent: view_message,\n\t\t\t\thide_timestamp: true,\n\t\t\t});\n\t\t});\n\t\treturn view_timeline_contents;\n\t}\n\n\tget_communication_timeline_contents(more_communications, more_automated_messages) {\n\t\tlet email_communications =\n\t\t\tthis.get_email_communication_timeline_contents(more_communications);\n\t\tlet automated_messages = this.get_auto_messages_timeline_contents(more_automated_messages);\n\t\tlet all_communications = email_communications.concat(automated_messages);\n\n\t\tif (all_communications.length > 20) {\n\t\t\tall_communications.pop();\n\n\t\t\tif (more_communications || more_automated_messages) {\n\t\t\t\tall_communications.forEach((message) => {\n\t\t\t\t\tif (message.communication_type == \"Automated Message\") {\n\t\t\t\t\t\tthis.doc_info.automated_messages.push(message);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.doc_info.communications.push(message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet last_communication_time =\n\t\t\t\tall_communications[all_communications.length - 1].creation;\n\t\t\tlet load_more_button = {\n\t\t\t\tcreation: last_communication_time,\n\t\t\t\tcontent: __(\"Load More Communications\", null, \"Form timeline\"),\n\t\t\t\tname: \"load-more\",\n\t\t\t};\n\t\t\tall_communications.push(load_more_button);\n\t\t}\n\n\t\treturn all_communications;\n\t}\n\n\tget_email_communication_timeline_contents(more_items) {\n\t\tlet communication_timeline_contents = [];\n\t\tlet icon_set = {\n\t\t\tEmail: \"mail\",\n\t\t\tPhone: \"call\",\n\t\t\tMeeting: \"calendar\",\n\t\t\tOther: \"dot-horizontal\",\n\t\t};\n\t\tlet items = more_items ? more_items : this.doc_info.communications || [];\n\t\titems.forEach((communication) => {\n\t\t\tlet medium = communication.communication_medium;\n\t\t\tcommunication_timeline_contents.push({\n\t\t\t\ticon: icon_set[medium],\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: communication.creation,\n\t\t\t\tis_card: true,\n\t\t\t\tcontent: this.get_communication_timeline_content(communication),\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tid: `communication-${communication.name}`,\n\t\t\t\tname: communication.name,\n\t\t\t});\n\t\t});\n\n\t\treturn communication_timeline_contents;\n\t}\n\n\tasync get_more_communication_timeline_contents() {\n\t\tlet more_items = [];\n\t\tlet start =\n\t\t\tthis.doc_info.communications.length + this.doc_info.automated_messages.length - 1;\n\t\tlet response = await frappe.call({\n\t\t\tmethod: \"frappe.desk.form.load.get_communications\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.doc_info.doctype,\n\t\t\t\tname: this.doc_info.name,\n\t\t\t\tstart: start,\n\t\t\t\tlimit: 21,\n\t\t\t},\n\t\t});\n\t\tif (response.message) {\n\t\t\tlet email_communications = [];\n\t\t\tlet automated_messages = [];\n\t\t\tresponse.message.forEach((message) => {\n\t\t\t\tif (message.communication_type == \"Automated Message\") {\n\t\t\t\t\tautomated_messages.push(message);\n\t\t\t\t} else {\n\t\t\t\t\temail_communications.push(message);\n\t\t\t\t}\n\t\t\t});\n\t\t\tmore_items = this.get_communication_timeline_contents(\n\t\t\t\temail_communications,\n\t\t\t\tautomated_messages\n\t\t\t);\n\t\t}\n\t\treturn more_items;\n\t}\n\n\tget_communication_timeline_content(doc, allow_reply = true) {\n\t\tdoc._url = frappe.utils.get_form_link(\"Communication\", doc.name);\n\t\tthis.set_communication_doc_status(doc);\n\t\tif (doc.attachments && typeof doc.attachments === \"string\") {\n\t\t\tdoc.attachments = JSON.parse(doc.attachments);\n\t\t}\n\t\tdoc.owner = doc.sender;\n\t\tdoc.user_full_name = doc.sender_full_name;\n\t\tdoc.content = frappe.dom.remove_script_and_style(doc.content);\n\t\tlet communication_content = $(frappe.render_template(\"timeline_message_box\", { doc }));\n\t\tif (allow_reply) {\n\t\t\tthis.setup_reply(communication_content, doc);\n\t\t}\n\t\treturn communication_content;\n\t}\n\n\tset_communication_doc_status(doc) {\n\t\tlet indicator_color = \"red\";\n\t\tif (in_list([\"Sent\", \"Clicked\"], doc.delivery_status)) {\n\t\t\tindicator_color = \"green\";\n\t\t} else if (doc.delivery_status === \"Sending\") {\n\t\t\tindicator_color = \"orange\";\n\t\t} else if (in_list([\"Opened\", \"Read\"], doc.delivery_status)) {\n\t\t\tindicator_color = \"blue\";\n\t\t} else if (doc.delivery_status == \"Error\") {\n\t\t\tindicator_color = \"red\";\n\t\t}\n\t\tdoc._doc_status = doc.delivery_status;\n\t\tdoc._doc_status_indicator = indicator_color;\n\t}\n\n\tget_auto_messages_timeline_contents(more_items) {\n\t\tlet auto_messages_timeline_contents = [];\n\t\tlet items = more_items ? more_items : this.doc_info.automated_messages || [];\n\t\titems.forEach((message) => {\n\t\t\tauto_messages_timeline_contents.push({\n\t\t\t\ticon: \"notification\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: message.creation,\n\t\t\t\tis_card: true,\n\t\t\t\tcontent: this.get_communication_timeline_content(message, false),\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tname: message.name,\n\t\t\t});\n\t\t});\n\t\treturn auto_messages_timeline_contents;\n\t}\n\n\tget_comment_timeline_contents() {\n\t\tlet comment_timeline_contents = [];\n\t\t(this.doc_info.comments || []).forEach((comment) => {\n\t\t\tcomment_timeline_contents.push(this.get_comment_timeline_item(comment));\n\t\t});\n\t\treturn comment_timeline_contents;\n\t}\n\n\tget_comment_timeline_item(comment) {\n\t\treturn {\n\t\t\ticon: \"small-message\",\n\t\t\tcreation: comment.creation,\n\t\t\tis_card: true,\n\t\t\tdoctype: \"Comment\",\n\t\t\tid: `comment-${comment.name}`,\n\t\t\tname: comment.name,\n\t\t\tcontent: this.get_comment_timeline_content(comment),\n\t\t};\n\t}\n\n\tget_comment_timeline_content(doc) {\n\t\tdoc.content = frappe.dom.remove_script_and_style(doc.content);\n\t\tconst comment_content = $(frappe.render_template(\"timeline_message_box\", { doc }));\n\t\tthis.setup_comment_actions(comment_content, doc);\n\t\treturn comment_content;\n\t}\n\n\tget_version_timeline_contents() {\n\t\tlet version_timeline_contents = [];\n\t\t(this.doc_info.versions || []).forEach((version) => {\n\t\t\tconst contents = get_version_timeline_content(version, this.frm);\n\t\t\tcontents.forEach((content) => {\n\t\t\t\tversion_timeline_contents.push({\n\t\t\t\t\tcreation: version.creation,\n\t\t\t\t\tcontent: content,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\treturn version_timeline_contents;\n\t}\n\n\tget_share_timeline_contents() {\n\t\tlet share_timeline_contents = [];\n\t\t(this.doc_info.share_logs || []).forEach((share_log) => {\n\t\t\tshare_timeline_contents.push({\n\t\t\t\tcreation: share_log.creation,\n\t\t\t\tcontent: share_log.content,\n\t\t\t});\n\t\t});\n\t\treturn share_timeline_contents;\n\t}\n\n\tget_assignment_timeline_contents() {\n\t\tlet assignment_timeline_contents = [];\n\t\t(this.doc_info.assignment_logs || []).forEach((assignment_log) => {\n\t\t\tassignment_timeline_contents.push({\n\t\t\t\tcreation: assignment_log.creation,\n\t\t\t\tcontent: assignment_log.content,\n\t\t\t});\n\t\t});\n\t\treturn assignment_timeline_contents;\n\t}\n\n\tget_info_timeline_contents() {\n\t\tlet info_timeline_contents = [];\n\t\t(this.doc_info.info_logs || []).forEach((info_log) => {\n\t\t\tinfo_timeline_contents.push({\n\t\t\t\tcreation: info_log.creation,\n\t\t\t\tcontent: `${this.get_user_link(info_log.owner)} ${info_log.content}`,\n\t\t\t});\n\t\t});\n\t\treturn info_timeline_contents;\n\t}\n\n\tget_attachment_timeline_contents() {\n\t\tlet attachment_timeline_contents = [];\n\t\t(this.doc_info.attachment_logs || []).forEach((attachment_log) => {\n\t\t\tlet is_file_upload = attachment_log.comment_type == \"Attachment\";\n\t\t\tattachment_timeline_contents.push({\n\t\t\t\ticon: is_file_upload ? \"upload\" : \"delete\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: attachment_log.creation,\n\t\t\t\tcontent: `${this.get_user_link(attachment_log.owner)} ${attachment_log.content}`,\n\t\t\t});\n\t\t});\n\t\treturn attachment_timeline_contents;\n\t}\n\n\tget_milestone_timeline_contents() {\n\t\tlet milestone_timeline_contents = [];\n\t\t(this.doc_info.milestones || []).forEach((milestone_log) => {\n\t\t\tmilestone_timeline_contents.push({\n\t\t\t\ticon: \"milestone\",\n\t\t\t\tcreation: milestone_log.creation,\n\t\t\t\tcontent: __(\"{0} changed {1} to {2}\", [\n\t\t\t\t\tthis.get_user_link(milestone_log.owner),\n\t\t\t\t\tfrappe.meta.get_label(this.frm.doctype, milestone_log.track_field),\n\t\t\t\t\tmilestone_log.value.bold(),\n\t\t\t\t]),\n\t\t\t});\n\t\t});\n\t\treturn milestone_timeline_contents;\n\t}\n\n\tget_like_timeline_contents() {\n\t\tlet like_timeline_contents = [];\n\t\t(this.doc_info.like_logs || []).forEach((like_log) => {\n\t\t\tlike_timeline_contents.push({\n\t\t\t\ticon: \"heart\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: like_log.creation,\n\t\t\t\tcontent: __(\"{0} Liked\", [this.get_user_link(like_log.owner)]),\n\t\t\t\ttitle: \"Like\",\n\t\t\t});\n\t\t});\n\t\treturn like_timeline_contents;\n\t}\n\n\tget_workflow_timeline_contents() {\n\t\tlet workflow_timeline_contents = [];\n\t\t(this.doc_info.workflow_logs || []).forEach((workflow_log) => {\n\t\t\tworkflow_timeline_contents.push({\n\t\t\t\ticon: \"branch\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: workflow_log.creation,\n\t\t\t\tcontent: `${this.get_user_link(workflow_log.owner)} ${__(workflow_log.content)}`,\n\t\t\t\ttitle: \"Workflow\",\n\t\t\t});\n\t\t});\n\t\treturn workflow_timeline_contents;\n\t}\n\n\tget_custom_timeline_contents() {\n\t\tlet custom_timeline_contents = [];\n\t\t(this.doc_info.additional_timeline_content || []).forEach((custom_item) => {\n\t\t\tcustom_timeline_contents.push({\n\t\t\t\ticon: custom_item.icon,\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tis_card: custom_item.is_card,\n\t\t\t\tcreation: custom_item.creation,\n\t\t\t\tcontent:\n\t\t\t\t\tcustom_item.content ||\n\t\t\t\t\tfrappe.render_template(custom_item.template, custom_item.template_data),\n\t\t\t});\n\t\t});\n\t\treturn custom_timeline_contents;\n\t}\n\n\tget_energy_point_timeline_contents() {\n\t\tlet energy_point_timeline_contents = [];\n\t\t(this.doc_info.energy_point_logs || []).forEach((log) => {\n\t\t\tlet timeline_badge = `\n\t\t\t<div class=\"timeline-badge ${log.points > 0 ? \"appreciation\" : \"criticism\"} bold\">\n\t\t\t\t${log.points}\n\t\t\t</div>`;\n\n\t\t\tenergy_point_timeline_contents.push({\n\t\t\t\ttimeline_badge: timeline_badge,\n\t\t\t\tcreation: log.creation,\n\t\t\t\tcontent: frappe.energy_points.format_form_log(log),\n\t\t\t});\n\t\t});\n\t\treturn energy_point_timeline_contents;\n\t}\n\n\tsetup_reply(communication_box, communication_doc) {\n\t\tlet actions = communication_box.find(\".custom-actions\");\n\t\tlet reply = $(`<a class=\"action-btn reply\">${frappe.utils.icon(\"reply\", \"md\")}</a>`).click(\n\t\t\t() => {\n\t\t\t\tthis.compose_mail(communication_doc);\n\t\t\t}\n\t\t);\n\t\tlet reply_all = $(\n\t\t\t`<a class=\"action-btn reply-all\">${frappe.utils.icon(\"reply-all\", \"md\")}</a>`\n\t\t).click(() => {\n\t\t\tthis.compose_mail(communication_doc, true);\n\t\t});\n\t\tactions.append(reply);\n\t\tactions.append(reply_all);\n\t}\n\n\tcompose_mail(communication_doc = null, reply_all = false) {\n\t\tconst args = {\n\t\t\tdoc: this.frm.doc,\n\t\t\tfrm: this.frm,\n\t\t\trecipients:\n\t\t\t\tcommunication_doc && communication_doc.sender != frappe.session.user_email\n\t\t\t\t\t? communication_doc.sender\n\t\t\t\t\t: this.get_recipient(),\n\t\t\tis_a_reply: Boolean(communication_doc),\n\t\t\ttitle: communication_doc ? __(\"Reply\") : null,\n\t\t\tlast_email: communication_doc,\n\t\t\tsubject: communication_doc && communication_doc.subject,\n\t\t\treply_all: reply_all,\n\t\t};\n\n\t\tconst email_accounts = frappe.boot.email_accounts\n\t\t\t.filter((account) => {\n\t\t\t\treturn (\n\t\t\t\t\t![\"All Accounts\", \"Sent\", \"Spam\", \"Trash\"].includes(account.email_account) &&\n\t\t\t\t\taccount.enable_outgoing\n\t\t\t\t);\n\t\t\t})\n\t\t\t.map((e) => e.email_id);\n\n\t\tif (communication_doc && args.is_a_reply) {\n\t\t\targs.cc = \"\";\n\t\t\tif (\n\t\t\t\temail_accounts.includes(frappe.session.user_email) &&\n\t\t\t\tcommunication_doc.sender != frappe.session.user_email\n\t\t\t) {\n\t\t\t\t// add recipients to cc if replying sender is different from last email\n\t\t\t\tconst recipients = communication_doc.recipients.split(\",\").map((r) => r.trim());\n\t\t\t\targs.cc =\n\t\t\t\t\trecipients.filter((r) => r != frappe.session.user_email).join(\", \") + \", \";\n\t\t\t}\n\t\t\tif (reply_all) {\n\t\t\t\t// if reply_all then add cc and bcc as well.\n\t\t\t\targs.cc += communication_doc.cc;\n\t\t\t\targs.bcc = communication_doc.bcc;\n\t\t\t}\n\t\t}\n\n\t\tif (this.frm.doctype === \"Communication\") {\n\t\t\targs.message = \"\";\n\t\t\targs.last_email = this.frm.doc;\n\t\t\targs.recipients = this.frm.doc.sender;\n\t\t\targs.subject = __(\"Re: {0}\", [this.frm.doc.subject]);\n\t\t} else {\n\t\t\tconst comment_value = frappe.markdown(this.frm.comment_box.get_value());\n\t\t\targs.message = strip_html(comment_value) ? comment_value : \"\";\n\t\t}\n\n\t\tnew frappe.views.CommunicationComposer(args);\n\t}\n\n\tget_recipient() {\n\t\tif (this.frm.email_field) {\n\t\t\treturn this.frm.doc[this.frm.email_field];\n\t\t} else {\n\t\t\treturn this.frm.doc.email_id || this.frm.doc.email || \"\";\n\t\t}\n\t}\n\n\tsetup_comment_actions(comment_wrapper, doc) {\n\t\tlet edit_wrapper = $(`<div class=\"comment-edit-box\">`).hide();\n\t\tlet edit_box = this.make_editable(edit_wrapper);\n\t\tlet content_wrapper = comment_wrapper.find(\".content\");\n\t\tlet more_actions_wrapper = comment_wrapper.find(\".more-actions\");\n\t\tif (\n\t\t\tfrappe.model.can_delete(\"Comment\") &&\n\t\t\t(frappe.session.user == doc.owner || frappe.user.has_role(\"System Manager\"))\n\t\t) {\n\t\t\tconst delete_option = $(`\n\t\t\t\t<li>\n\t\t\t\t\t<a class=\"dropdown-item\">\n\t\t\t\t\t\t${__(\"Delete\")}\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t`).click(() => this.delete_comment(doc.name));\n\t\t\tmore_actions_wrapper.find(\".dropdown-menu\").append(delete_option);\n\t\t}\n\n\t\tlet dismiss_button = $(`\n\t\t\t<button class=\"btn btn-link action-btn\">\n\t\t\t\t${__(\"Dismiss\")}\n\t\t\t</button>\n\t\t`).click(() => edit_button.toggle_edit_mode());\n\t\tdismiss_button.hide();\n\n\t\tedit_box.set_value(doc.content);\n\n\t\tedit_box.on_submit = (value) => {\n\t\t\tcontent_wrapper.empty();\n\t\t\tcontent_wrapper.append(value);\n\t\t\tedit_button.prop(\"disabled\", true);\n\t\t\tedit_box.quill.enable(false);\n\n\t\t\tdoc.content = value;\n\t\t\tthis.update_comment(doc.name, value)\n\t\t\t\t.then(edit_button.toggle_edit_mode)\n\t\t\t\t.finally(() => {\n\t\t\t\t\tedit_button.prop(\"disabled\", false);\n\t\t\t\t\tedit_box.quill.enable(true);\n\t\t\t\t});\n\t\t};\n\n\t\tcontent_wrapper.after(edit_wrapper);\n\n\t\tlet edit_button = $();\n\t\tlet current_user = frappe.session.user;\n\t\tif ([\"Administrator\", doc.owner].includes(current_user)) {\n\t\t\tedit_button = $(`<button class=\"btn btn-link action-btn\">${__(\"Edit\")}</a>`).click(\n\t\t\t\t() => {\n\t\t\t\t\tedit_button.edit_mode ? edit_box.submit() : edit_button.toggle_edit_mode();\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tedit_button.toggle_edit_mode = () => {\n\t\t\tedit_button.edit_mode = !edit_button.edit_mode;\n\t\t\tedit_button.text(edit_button.edit_mode ? __(\"Save\") : __(\"Edit\"));\n\t\t\tmore_actions_wrapper.toggle(!edit_button.edit_mode);\n\t\t\tdismiss_button.toggle(edit_button.edit_mode);\n\t\t\tedit_wrapper.toggle(edit_button.edit_mode);\n\t\t\tcontent_wrapper.toggle(!edit_button.edit_mode);\n\t\t};\n\t\tlet actions_wrapper = comment_wrapper.find(\".custom-actions\");\n\t\tactions_wrapper.append(edit_button);\n\t\tactions_wrapper.append(dismiss_button);\n\t}\n\n\tmake_editable(container) {\n\t\treturn frappe.ui.form.make_control({\n\t\t\tparent: container,\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Comment\",\n\t\t\t\tfieldname: \"comment\",\n\t\t\t\tlabel: \"Comment\",\n\t\t\t},\n\t\t\tenable_mentions: true,\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tno_wrapper: true,\n\t\t});\n\t}\n\n\tupdate_comment(name, content) {\n\t\treturn frappe\n\t\t\t.xcall(\"frappe.desk.form.utils.update_comment\", { name, content })\n\t\t\t.then(() => {\n\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t});\n\t}\n\n\tget_last_email(from_recipient) {\n\t\t/**\n\t\t * Return the latest email communication.\n\t\t *\n\t\t * @param {boolean} from_recipient If true, only considers emails where current form's recipient is the sender.\n\t\t * @returns {object|null} The latest email communication, or null if no communication is found.\n\t\t */\n\n\t\tconst communications = this.frm.get_docinfo().communications || [];\n\t\tconst recipient = this.get_recipient();\n\n\t\tconst filtered_records = communications\n\t\t\t.filter(\n\t\t\t\t(record) =>\n\t\t\t\t\trecord.communication_type === \"Communication\" &&\n\t\t\t\t\trecord.communication_medium === \"Email\" &&\n\t\t\t\t\t(!from_recipient || record.sender === recipient)\n\t\t\t)\n\t\t\t.sort((a, b) => b.creation - a.creation);\n\n\t\treturn filtered_records[0] || null;\n\t}\n\n\tdelete_comment(comment_name) {\n\t\tfrappe.confirm(__(\"Delete comment?\"), () => {\n\t\t\treturn frappe\n\t\t\t\t.xcall(\"frappe.client.delete\", {\n\t\t\t\t\tdoctype: \"Comment\",\n\t\t\t\t\tname: comment_name,\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tfrappe.utils.play_sound(\"delete\");\n\t\t\t\t});\n\t\t});\n\t}\n\n\tcopy_link(ev) {\n\t\tlet doc_link = frappe.urllib.get_full_url(\n\t\t\tfrappe.utils.get_form_link(this.frm.doctype, this.frm.docname)\n\t\t);\n\t\tlet element_id = $(ev.currentTarget).closest(\".timeline-content\").attr(\"id\");\n\t\tfrappe.utils.copy_to_clipboard(`${doc_link}#${element_id}`);\n\t}\n}\n\nexport default FormTimeline;\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport FormTimeline from \"./form_timeline\";\nfrappe.ui.form.Footer = class FormFooter {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.make_comment_box();\n\t\tthis.make_timeline();\n\t\t// render-complete\n\t\t$(this.frm.wrapper).on(\"render_complete\", () => {\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\tmake() {\n\t\tthis.wrapper = $(frappe.render_template(\"form_footer\", {})).appendTo(this.parent);\n\t\tthis.wrapper.find(\".btn-save\").click(() => {\n\t\t\tthis.frm.save(\"Save\", null, this);\n\t\t});\n\t}\n\tmake_comment_box() {\n\t\tthis.frm.comment_box = frappe.ui.form.make_control({\n\t\t\tparent: this.wrapper.find(\".comment-box\"),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tenable_mentions: true,\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Comment\",\n\t\t\t\tfieldname: \"comment\",\n\t\t\t},\n\t\t\ton_submit: (comment) => {\n\t\t\t\tif (strip_html(comment).trim() != \"\" || comment.includes(\"img\")) {\n\t\t\t\t\tthis.frm.comment_box.disable();\n\t\t\t\t\tfrappe\n\t\t\t\t\t\t.xcall(\"frappe.desk.form.utils.add_comment\", {\n\t\t\t\t\t\t\treference_doctype: this.frm.doctype,\n\t\t\t\t\t\t\treference_name: this.frm.docname,\n\t\t\t\t\t\t\tcontent: comment,\n\t\t\t\t\t\t\tcomment_email: frappe.session.user,\n\t\t\t\t\t\t\tcomment_by: frappe.session.user_fullname,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then((comment) => {\n\t\t\t\t\t\t\tlet comment_item =\n\t\t\t\t\t\t\t\tthis.frm.timeline.get_comment_timeline_item(comment);\n\t\t\t\t\t\t\tthis.frm.comment_box.set_value(\"\");\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t\t\t\t\tthis.frm.timeline.add_timeline_item(comment_item);\n\t\t\t\t\t\t\tthis.frm.sidebar.refresh_comments_count &&\n\t\t\t\t\t\t\t\tthis.frm.sidebar.refresh_comments_count();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\tthis.frm.comment_box.enable();\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\tmake_timeline() {\n\t\tthis.frm.timeline = new FormTimeline({\n\t\t\tparent: this.wrapper.find(\".timeline\"),\n\t\t\tfrm: this.frm,\n\t\t});\n\t}\n\trefresh() {\n\t\tif (this.frm.doc.__islocal) {\n\t\t\tthis.parent.addClass(\"hide\");\n\t\t} else {\n\t\t\tthis.parent.removeClass(\"hide\");\n\t\t\tthis.frm.timeline.refresh();\n\t\t}\n\t}\n};\n", "frappe.ui.form.FormTour = class FormTour {\n\tconstructor({ frm }) {\n\t\tthis.frm = frm;\n\t\tthis.driver_steps = [];\n\t}\n\n\tinit_driver() {\n\t\tthis.driver = new frappe.Driver({\n\t\t\tclassName: \"frappe-driver\",\n\t\t\tallowClose: false,\n\t\t\tpadding: 10,\n\t\t\toverlayClickNext: true,\n\t\t\tkeyboardControl: true,\n\t\t\tnextBtnText: \"Next\",\n\t\t\tprevBtnText: \"Previous\",\n\t\t\topacity: 0.25,\n\t\t\tonHighlighted: (step) => {\n\t\t\t\t// if last step is to save, then attach a listener to save button\n\t\t\t\tif (step.options.is_save_step) {\n\t\t\t\t\t$(step.options.element).one(\"click\", () => this.driver.reset());\n\t\t\t\t\tthis.driver.overlay.refresh();\n\t\t\t\t}\n\n\t\t\t\t// focus on input\n\t\t\t\tconst $input = $(step.node).find(\"input\").get(0);\n\t\t\t\tif ($input) frappe.utils.sleep(200).then(() => $input.focus());\n\t\t\t},\n\t\t});\n\n\t\tfrappe.router.on(\"change\", () => this.driver.reset());\n\t\tthis.frm.layout.sections.forEach((section) => section.collapse(false));\n\t}\n\n\tasync init({ tour_name, on_finish }) {\n\t\tif (tour_name) {\n\t\t\tthis.tour = await frappe.db.get_doc(\"Form Tour\", tour_name);\n\t\t} else {\n\t\t\tconst doctype_tour_exists = await frappe.db.exists(\"Form Tour\", this.frm.doctype);\n\t\t\tif (doctype_tour_exists) {\n\t\t\t\tthis.tour = await frappe.db.get_doc(\"Form Tour\", this.frm.doctype);\n\t\t\t} else {\n\t\t\t\tthis.tour = { steps: frappe.tour[this.frm.doctype] };\n\t\t\t}\n\t\t}\n\n\t\tif (on_finish) this.on_finish = on_finish;\n\n\t\tthis.init_driver();\n\t\tif (this.tour.include_name_field) this.include_name_field();\n\t\tthis.build_steps();\n\t\tthis.update_driver_steps();\n\t}\n\n\tinclude_name_field() {\n\t\tconst name_step = {\n\t\t\tdescription: __(\"Enter a name for this {0}\", [this.frm.doctype]),\n\t\t\tfieldname: \"__newname\",\n\t\t\ttitle: __(\"Document Name\"),\n\t\t\tposition: \"right\",\n\t\t\tis_table_field: 0,\n\t\t};\n\t\tthis.tour.steps.unshift(name_step);\n\t}\n\n\tbuild_steps() {\n\t\tthis.driver_steps = [];\n\t\tthis.tour.steps.forEach((step) => {\n\t\t\tconst on_next = () => {\n\t\t\t\tif (!this.is_next_condition_satisfied(step)) {\n\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t}\n\n\t\t\t\tif (!this.driver.hasNextStep()) {\n\t\t\t\t\tthis.on_finish && this.on_finish();\n\t\t\t\t}\n\t\t\t\tlet field = this.get_next_step()?.options.element.fieldobj;\n\t\t\t\tif (field?.tab && !field.tab.is_active()) {\n\t\t\t\t\tfield.tab.set_active();\n\t\t\t\t\tthis.driver.reset(true);\n\t\t\t\t\tfrappe.utils.sleep(200).then(() => {\n\t\t\t\t\t\tthis.start(step.idx);\n\t\t\t\t\t\tthis.driver.overlay.refresh();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst on_prev = () => {\n\t\t\t\tif (!this.driver.hasPreviousStep()) return;\n\t\t\t\tlet field =\n\t\t\t\t\tthis.driver.steps[this.driver.currentStep - 1]?.options.element.fieldobj;\n\t\t\t\tif (field?.tab && !field.tab.is_active()) {\n\t\t\t\t\tfield.tab.set_active();\n\t\t\t\t\tthis.driver.reset(true);\n\t\t\t\t\tfrappe.utils.sleep(200).then(() => {\n\t\t\t\t\t\tthis.start(step.idx - 2);\n\t\t\t\t\t\tthis.driver.overlay.refresh();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst driver_step = this.get_step(step, on_next, on_prev);\n\t\t\tthis.driver_steps.push(driver_step);\n\n\t\t\tif (step.fieldtype == \"Table\") this.handle_table_step(step);\n\t\t\tif (step.is_table_field) this.handle_child_table_step(step);\n\t\t\tif (step.fieldtype == \"Attach Image\") this.handle_attach_image_steps(step);\n\t\t});\n\n\t\tif (this.tour.save_on_complete && this.frm.is_dirty()) {\n\t\t\tthis.add_step_to_save();\n\t\t}\n\t}\n\n\tis_next_condition_satisfied(step) {\n\t\tconst form = step.is_table_field ? this.frm.cur_grid.grid_form : this.frm;\n\t\treturn form.layout.evaluate_depends_on_value(step.next_step_condition || true);\n\t}\n\n\tget_step(step_info, on_next, on_prev) {\n\t\tconst { name, fieldname, title, description, position, is_table_field } = step_info;\n\t\tlet element = `.frappe-control[data-fieldname='${fieldname}']`;\n\n\t\tconst field = this.frm.get_field(fieldname);\n\t\tif (field) {\n\t\t\t// wrapper for section breaks returns in a list\n\t\t\telement = field.wrapper[0] ? field.wrapper[0] : field.wrapper;\n\t\t}\n\n\t\tif (is_table_field) {\n\t\t\t// TODO: fix wrapper for grid sections\n\t\t\telement = `.grid-row-open .frappe-control[data-fieldname='${fieldname}']`;\n\t\t}\n\n\t\treturn {\n\t\t\telement,\n\t\t\tname,\n\t\t\tpopover: { title, description, position: frappe.router.slug(position || \"Bottom\") },\n\t\t\tonNext: on_next,\n\t\t\tonPrevious: on_prev,\n\t\t};\n\t}\n\n\tupdate_driver_steps(steps = []) {\n\t\tif (steps.length == 0) {\n\t\t\tsteps = this.driver_steps;\n\t\t}\n\t\tthis.driver.defineSteps(steps);\n\t}\n\n\tstart(idx = 0) {\n\t\tif (this.driver_steps.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis.driver.start(idx);\n\t}\n\n\tget_next_step() {\n\t\t// returns the next step only if driver is active\n\t\tif (this.driver.isActivated & this.driver.hasNextStep()) {\n\t\t\tconst current_step = this.driver.currentStep;\n\t\t\treturn this.driver.steps[current_step + 1];\n\t\t}\n\t\treturn;\n\t}\n\n\thandle_table_step(step_info) {\n\t\tconst is_last_step = step_info.idx == this.tour.steps.length;\n\n\t\tif (!is_last_step) {\n\t\t\t// if next step field is inside currently highlighted table field\n\t\t\t// then check if there is a row -> if not, then prompt to add row\n\t\t\t// then edit the first row and hightlight next step\n\n\t\t\tconst curr_step = step_info;\n\t\t\tconst next_step = this.tour.steps[curr_step.idx];\n\t\t\tconst is_next_field_in_curr_table = next_step.parent_fieldname == curr_step.fieldname;\n\n\t\t\tif (!is_next_field_in_curr_table) return;\n\n\t\t\tconst rows = this.frm.doc[curr_step.fieldname];\n\t\t\tconst table_has_rows = rows && rows.length > 0;\n\t\t\tif (table_has_rows) {\n\t\t\t\t// table already has rows\n\t\t\t\t// then just edit the first one on next step\n\t\t\t\tconst curr_driver_step = this.driver_steps.find((s) => s.name == curr_step.name);\n\t\t\t\tcurr_driver_step.onNext = () => {\n\t\t\t\t\tif (this.is_next_condition_satisfied(curr_step)) {\n\t\t\t\t\t\tthis.expand_row_and_proceed(curr_step, curr_step.idx);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.update_driver_steps();\n\t\t\t} else {\n\t\t\t\tthis.add_new_row_step(curr_step);\n\t\t\t}\n\t\t}\n\t}\n\n\tadd_new_row_step(step) {\n\t\tconst $add_row = `.frappe-control[data-fieldname='${step.fieldname}'] .grid-add-row`;\n\t\tconst add_row_step = {\n\t\t\telement: $add_row,\n\t\t\tpopover: { title: __(\"Add a Row\"), description: \"\" },\n\t\t\tonNext: () => {\n\t\t\t\tif (!cur_frm.cur_grid) {\n\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t\tthis.driver_steps.push(add_row_step);\n\n\t\t// setup a listener on add row button\n\t\t// so, once the row is added, move to next step automatically\n\t\t$($add_row).one(\"click\", () => {\n\t\t\tthis.expand_row_and_proceed(step, step.idx + 1); // +1 since add row step is added\n\t\t});\n\t}\n\n\texpand_row_and_proceed(step, start_from) {\n\t\tthis.open_first_row_of(step.fieldname);\n\t\tthis.update_driver_steps(); // need to define again, since driver.js only considers steps which are inside DOM\n\t\tfrappe.utils.sleep(300).then(() => this.driver.start(start_from));\n\t}\n\n\topen_first_row_of(fieldname) {\n\t\tthis.frm.fields_dict[fieldname].grid.grid_rows[0].toggle_view();\n\n\t\t// setup a listener on close row button\n\t\t// so, once the row is closed, move to next step automatically\n\t\tconst $close_row = \".grid-row-open .grid-collapse-row\";\n\t\t$($close_row).one(\"click\", () => {\n\t\t\tconst next_step = this.get_next_step();\n\t\t\tconst next_element = next_step.options.is_save_step ? null : next_step.node;\n\n\t\t\tfrappe.utils.scroll_to(next_element, true, 150, null, () => {\n\t\t\t\tthis.driver.moveNext();\n\t\t\t\tfrappe.flags.disable_auto_scroll = false;\n\t\t\t});\n\t\t\tfrappe.flags.disable_auto_scroll = true;\n\t\t});\n\t}\n\n\thandle_child_table_step(step_info) {\n\t\tconst is_last_step = step_info.idx == this.tour.steps.length;\n\n\t\tif (!is_last_step) {\n\t\t\tconst curr_step = step_info;\n\t\t\tconst next_step = this.tour.steps[curr_step.idx];\n\t\t\tconst field = this.frm.get_field(next_step.fieldname);\n\n\t\t\tif (!field) return;\n\n\t\t\t// next step highlights parent field\n\t\t\t// so, add a step to prompt user to collapse grid form\n\t\t\tthis.add_collapse_row_step();\n\t\t} else if (this.tour.save_on_complete) {\n\t\t\t// if last step & save on complete is checked\n\t\t\t// add a step to prompt user to collapse grid form\n\t\t\t// to be able to save as a last step\n\t\t\tthis.add_collapse_row_step();\n\t\t}\n\t}\n\n\tadd_collapse_row_step() {\n\t\tconst $close_row = \".grid-row-open .grid-collapse-row\";\n\t\tconst close_row_step = {\n\t\t\telement: $close_row,\n\t\t\tpopover: { title: __(\"Collapse\"), description: \"\", position: \"left\" },\n\t\t\tonNext: () => {\n\t\t\t\tif (cur_frm.cur_grid) {\n\t\t\t\t\tthis.driver.preventMove();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t\tthis.driver_steps.push(close_row_step);\n\t}\n\n\tadd_step_to_save() {\n\t\tconst page_id = `[id=\"page-${this.frm.doctype}\"]`;\n\t\tconst $save_btn = `${page_id} .standard-actions .primary-action`;\n\t\tconst save_step = {\n\t\t\telement: $save_btn,\n\t\t\tis_save_step: true,\n\t\t\tallowClose: false,\n\t\t\toverlayClickNext: false,\n\t\t\tpopover: {\n\t\t\t\ttitle: __(\"Save the document.\"),\n\t\t\t\tdescription: \"\",\n\t\t\t\tposition: \"left\",\n\t\t\t\tshowButtons: false,\n\t\t\t},\n\t\t\tonNext: () => {\n\t\t\t\tthis.frm.save();\n\t\t\t},\n\t\t};\n\t\tthis.driver_steps.push(save_step);\n\t\tfrappe.ui.form.on(\n\t\t\tthis.frm.doctype,\n\t\t\t\"after_save\",\n\t\t\t() => this.on_finish && this.on_finish()\n\t\t);\n\t}\n\n\thandle_attach_image_steps() {\n\t\t$(\".btn-attach\").one(\"click\", () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst modal_element = $(\".file-uploader\").closest(\".modal-content\");\n\t\t\t\tconst attach_dialog_step = {\n\t\t\t\t\telement: modal_element[0],\n\t\t\t\t\tallowClose: false,\n\t\t\t\t\toverlayClickNext: false,\n\t\t\t\t\tpopover: {\n\t\t\t\t\t\ttitle: __(\"Select an Image\"),\n\t\t\t\t\t\tdescription: \"\",\n\t\t\t\t\t\tposition: \"left\",\n\t\t\t\t\t\tdoneBtnText: __(\"Next\"),\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tthis.driver_steps.splice(this.driver.currentStep + 1, 0, attach_dialog_step);\n\t\t\t\tthis.update_driver_steps(); // need to define again, since driver.js only considers steps which are inside DOM\n\t\t\t\tthis.driver.moveNext();\n\t\t\t\tthis.driver.overlay.refresh();\n\n\t\t\t\tmodal_element.closest(\".modal\").on(\"hidden.bs.modal\", () => {\n\t\t\t\t\tthis.driver.moveNext();\n\t\t\t\t});\n\t\t\t}, 500);\n\t\t});\n\t}\n};\n", "export class UndoManager {\n\tconstructor({ frm }) {\n\t\tthis.frm = frm;\n\t\tthis.undo_stack = [];\n\t\tthis.redo_stack = [];\n\t}\n\trecord_change({ fieldname, old_value, new_value, doctype, docname, is_child }) {\n\t\tif (old_value == new_value) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.undo_stack.push({\n\t\t\tfieldname,\n\t\t\told_value,\n\t\t\tnew_value,\n\t\t\tdoctype,\n\t\t\tdocname,\n\t\t\tis_child,\n\t\t});\n\t}\n\n\terase_history() {\n\t\tthis.undo_stack = [];\n\t\tthis.redo_stack = [];\n\t}\n\n\tundo() {\n\t\tconst change = this.undo_stack.pop();\n\t\tif (change) {\n\t\t\tthis._apply_change(change);\n\t\t\tthis._push_reverse_entry(change, this.redo_stack);\n\t\t} else {\n\t\t\tthis._show_alert(__(\"Nothing left to undo\"));\n\t\t}\n\t}\n\n\tredo() {\n\t\tconst change = this.redo_stack.pop();\n\t\tif (change) {\n\t\t\tthis._apply_change(change);\n\t\t\tthis._push_reverse_entry(change, this.undo_stack);\n\t\t} else {\n\t\t\tthis._show_alert(__(\"Nothing left to redo\"));\n\t\t}\n\t}\n\n\t_push_reverse_entry(change, stack) {\n\t\tstack.push({\n\t\t\t...change,\n\t\t\tnew_value: change.old_value,\n\t\t\told_value: change.new_value,\n\t\t});\n\t}\n\n\t_apply_change(change) {\n\t\tif (change.is_child) {\n\t\t\tfrappe.model.set_value(\n\t\t\t\tchange.doctype,\n\t\t\t\tchange.docname,\n\t\t\t\tchange.fieldname,\n\t\t\t\tchange.old_value\n\t\t\t);\n\t\t} else {\n\t\t\tthis.frm.set_value(change.fieldname, change.old_value);\n\t\t\tthis.frm.scroll_to_field(change.fieldname, false);\n\t\t}\n\t}\n\n\t_show_alert(msg) {\n\t\t// reduce duration\n\t\t// keyboard interactions shouldn't have long running annoying toasts\n\t\tfrappe.show_alert(msg, 3);\n\t}\n}\n", "frappe.provide(\"frappe.ui\");\n\nexport default class ListFilter {\n\tconstructor({ wrapper, doctype }) {\n\t\tObject.assign(this, arguments[0]);\n\t\tthis.can_add_global = frappe.user.has_role([\"System Manager\", \"Administrator\"]);\n\t\tthis.filters = [];\n\t\tthis.make();\n\t\tthis.bind();\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\t// init dom\n\t\tthis.wrapper.html(`\n\t\t\t<li class=\"input-area\"></li>\n\t\t\t<li class=\"sidebar-action\">\n\t\t\t\t<a class=\"saved-filters-preview\">${__(\"Show Saved\")}</a>\n\t\t\t</li>\n\t\t\t<div class=\"saved-filters\"></div>\n\t\t`);\n\n\t\tthis.$input_area = this.wrapper.find(\".input-area\");\n\t\tthis.$list_filters = this.wrapper.find(\".list-filters\");\n\t\tthis.$saved_filters = this.wrapper.find(\".saved-filters\").hide();\n\t\tthis.$saved_filters_preview = this.wrapper.find(\".saved-filters-preview\");\n\t\tthis.saved_filters_hidden = true;\n\t\tthis.toggle_saved_filters(true);\n\n\t\tthis.filter_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tplaceholder: __(\"Filter Name\"),\n\t\t\t\tinput_class: \"input-xs\",\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1,\n\t\t});\n\n\t\tthis.is_global_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: __(\"Is Global\"),\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1,\n\t\t});\n\t}\n\n\tbind() {\n\t\tthis.bind_save_filter();\n\t\tthis.bind_toggle_saved_filters();\n\t\tthis.bind_click_filter();\n\t\tthis.bind_remove_filter();\n\t}\n\n\trefresh() {\n\t\tthis.get_list_filters().then(() => {\n\t\t\tthis.filters.length\n\t\t\t\t? this.$saved_filters_preview.show()\n\t\t\t\t: this.$saved_filters_preview.hide();\n\t\t\tconst html = this.filters.map((filter) => this.filter_template(filter));\n\t\t\tthis.wrapper.find(\".filter-pill\").remove();\n\t\t\tthis.$saved_filters.append(html);\n\t\t});\n\t\tthis.is_global_input.toggle(false);\n\t\tthis.filter_input.set_description(\"\");\n\t}\n\n\tfilter_template(filter) {\n\t\treturn `<div class=\"list-link filter-pill list-sidebar-button btn btn-default\" data-name=\"${\n\t\t\tfilter.name\n\t\t}\">\n\t\t\t<a class=\"ellipsis filter-name\">${filter.filter_name}</a>\n\t\t\t<a class=\"remove\">${frappe.utils.icon(\"close\")}</a>\n\t\t</div>`;\n\t}\n\n\tbind_toggle_saved_filters() {\n\t\tthis.wrapper.find(\".saved-filters-preview\").click(() => {\n\t\t\tthis.toggle_saved_filters(this.saved_filters_hidden);\n\t\t});\n\t}\n\n\ttoggle_saved_filters(show) {\n\t\tthis.$saved_filters.toggle(show);\n\t\tconst label = show ? __(\"Hide Saved\") : __(\"Show Saved\");\n\t\tthis.wrapper.find(\".saved-filters-preview\").text(label);\n\t\tthis.saved_filters_hidden = !this.saved_filters_hidden;\n\t}\n\n\tbind_click_filter() {\n\t\tthis.wrapper.on(\"click\", \".filter-pill .filter-name\", (e) => {\n\t\t\tlet $filter = $(e.currentTarget).parent(\".filter-pill\");\n\t\t\tthis.set_applied_filter($filter);\n\t\t\tconst name = $filter.attr(\"data-name\");\n\t\t\tthis.list_view.filter_area.clear().then(() => {\n\t\t\t\tthis.list_view.filter_area.add(this.get_filters_values(name));\n\t\t\t});\n\t\t});\n\t}\n\n\tbind_remove_filter() {\n\t\tthis.wrapper.on(\"click\", \".filter-pill .remove\", (e) => {\n\t\t\tconst $li = $(e.currentTarget).closest(\".filter-pill\");\n\t\t\tconst filter_label = $li.text().trim();\n\n\t\t\tfrappe.confirm(\n\t\t\t\t__(\"Are you sure you want to remove the {0} filter?\", [filter_label.bold()]),\n\t\t\t\t() => {\n\t\t\t\t\tconst name = $li.attr(\"data-name\");\n\t\t\t\t\tconst applied_filters = this.get_filters_values(name);\n\t\t\t\t\t$li.remove();\n\t\t\t\t\tthis.remove_filter(name).then(() => this.refresh());\n\t\t\t\t\tthis.list_view.filter_area.remove_filters(applied_filters);\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tbind_save_filter() {\n\t\tthis.filter_input.$input.keydown(\n\t\t\tfrappe.utils.debounce((e) => {\n\t\t\t\tconst value = this.filter_input.get_value();\n\t\t\t\tconst has_value = Boolean(value);\n\n\t\t\t\tif (e.which === frappe.ui.keyCode[\"ENTER\"]) {\n\t\t\t\t\tif (!has_value || this.filter_name_exists(value)) return;\n\n\t\t\t\t\tthis.filter_input.set_value(\"\");\n\t\t\t\t\tthis.save_filter(value).then(() => this.refresh());\n\t\t\t\t\tthis.toggle_saved_filters(true);\n\t\t\t\t} else {\n\t\t\t\t\tlet help_text = __(\"Press Enter to save\");\n\n\t\t\t\t\tif (this.filter_name_exists(value)) {\n\t\t\t\t\t\thelp_text = __(\"Duplicate Filter Name\");\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.filter_input.set_description(has_value ? help_text : \"\");\n\n\t\t\t\t\tif (this.can_add_global) {\n\t\t\t\t\t\tthis.is_global_input.toggle(has_value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 300)\n\t\t);\n\t}\n\n\tsave_filter(filter_name) {\n\t\treturn frappe.db.insert({\n\t\t\tdoctype: \"List Filter\",\n\t\t\treference_doctype: this.list_view.doctype,\n\t\t\tfilter_name,\n\t\t\tfor_user: this.is_global_input.get_value() ? \"\" : frappe.session.user,\n\t\t\tfilters: JSON.stringify(this.get_current_filters()),\n\t\t});\n\t}\n\n\tremove_filter(name) {\n\t\tif (!name) return;\n\t\treturn frappe.db.delete_doc(\"List Filter\", name);\n\t}\n\n\tget_filters_values(name) {\n\t\tconst filter = this.filters.find((filter) => filter.name === name);\n\t\treturn JSON.parse(filter.filters || \"[]\");\n\t}\n\n\tget_current_filters() {\n\t\treturn this.list_view.filter_area.get();\n\t}\n\n\tfilter_name_exists(filter_name) {\n\t\treturn (this.filters || []).find((f) => f.filter_name === filter_name);\n\t}\n\n\tget_list_filters() {\n\t\tif (frappe.session.user === \"Guest\") return Promise.resolve();\n\t\treturn frappe.db\n\t\t\t.get_list(\"List Filter\", {\n\t\t\t\tfields: [\"name\", \"filter_name\", \"for_user\", \"filters\"],\n\t\t\t\tfilters: { reference_doctype: this.list_view.doctype },\n\t\t\t\tor_filters: [\n\t\t\t\t\t[\"for_user\", \"=\", frappe.session.user],\n\t\t\t\t\t[\"for_user\", \"=\", \"\"],\n\t\t\t\t],\n\t\t\t})\n\t\t\t.then((filters) => {\n\t\t\t\tthis.filters = filters || [];\n\t\t\t});\n\t}\n\n\tset_applied_filter($filter) {\n\t\tthis.$saved_filters\n\t\t\t.find(\".btn-primary-light\")\n\t\t\t.toggleClass(\"btn-primary-light btn-default\");\n\t\t$filter.toggleClass(\"btn-default btn-primary-light\");\n\t}\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport ListFilter from \"frappe/public/js/frappe/list/list_filter\";\nfrappe.provide(\"frappe.views\");\n\n// opts:\n// stats = list of fields\n// doctype\n// parent\n\nfrappe.views.ListSidebar = class ListSidebar {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n        // customization\n\t\t    // this.make();\n        // customization end\n\t}\n\n\tmake() {\n\t\tvar sidebar_content = frappe.render_template(\"list_sidebar\", { doctype: this.doctype });\n\n\t\tthis.sidebar = $('<div class=\"list-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.setup_list_filter();\n\t\tthis.setup_list_group_by();\n\n\t\t// do not remove\n\t\t// used to trigger custom scripts\n\t\t$(document).trigger(\"list_sidebar_setup\");\n\n\t\tif (\n\t\t\tthis.list_view.list_view_settings &&\n\t\t\tthis.list_view.list_view_settings.disable_sidebar_stats\n\t\t) {\n\t\t\tthis.sidebar.find(\".list-tags\").remove();\n\t\t} else {\n\t\t\tthis.sidebar.find(\".list-stats\").on(\"show.bs.dropdown\", (e) => {\n\t\t\t\tthis.reload_stats();\n\t\t\t});\n\t\t}\n\n\t\tthis.add_insights_banner();\n\t}\n\n\tsetup_views() {\n\t\tvar show_list_link = false;\n\n\t\tif (frappe.views.calendar[this.doctype]) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Calendar\"]').removeClass(\"hide\");\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Gantt\"]').removeClass(\"hide\");\n\t\t\tshow_list_link = true;\n\t\t}\n\t\t//show link for kanban view\n\t\tthis.sidebar.find('.list-link[data-view=\"Kanban\"]').removeClass(\"hide\");\n\t\tif (this.doctype === \"Communication\" && frappe.boot.email_accounts.length) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Inbox\"]').removeClass(\"hide\");\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (frappe.treeview_settings[this.doctype] || frappe.get_meta(this.doctype).is_tree) {\n\t\t\tthis.sidebar.find(\".tree-link\").removeClass(\"hide\");\n\t\t}\n\n\t\tthis.current_view = \"List\";\n\t\tvar route = frappe.get_route();\n\t\tif (route.length > 2 && frappe.views.view_modes.includes(route[2])) {\n\t\t\tthis.current_view = route[2];\n\n\t\t\tif (this.current_view === \"Kanban\") {\n\t\t\t\tthis.kanban_board = route[3];\n\t\t\t} else if (this.current_view === \"Inbox\") {\n\t\t\t\tthis.email_account = route[3];\n\t\t\t}\n\t\t}\n\n\t\t// disable link for current view\n\t\tthis.sidebar\n\t\t\t.find('.list-link[data-view=\"' + this.current_view + '\"] a')\n\t\t\t.attr(\"disabled\", \"disabled\")\n\t\t\t.addClass(\"disabled\");\n\n\t\t//enable link for Kanban view\n\t\tthis.sidebar\n\t\t\t.find('.list-link[data-view=\"Kanban\"] a, .list-link[data-view=\"Inbox\"] a')\n\t\t\t.attr(\"disabled\", null)\n\t\t\t.removeClass(\"disabled\");\n\n\t\t// show image link if image_view\n\t\tif (this.list_view.meta.image_field) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Image\"]').removeClass(\"hide\");\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (\n\t\t\tthis.list_view.settings.get_coords_method ||\n\t\t\t(this.list_view.meta.fields.find((i) => i.fieldname === \"latitude\") &&\n\t\t\t\tthis.list_view.meta.fields.find((i) => i.fieldname === \"longitude\")) ||\n\t\t\tthis.list_view.meta.fields.find(\n\t\t\t\t(i) => i.fieldname === \"location\" && i.fieldtype == \"Geolocation\"\n\t\t\t)\n\t\t) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Map\"]').removeClass(\"hide\");\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (show_list_link) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"List\"]').removeClass(\"hide\");\n\t\t}\n\t}\n\n\tsetup_reports() {\n\t\t// add reports linked to this doctype to the dropdown\n\t\tvar me = this;\n\t\tvar added = [];\n\t\tvar dropdown = this.page.sidebar.find(\".reports-dropdown\");\n\t\tvar divider = false;\n\n\t\tvar add_reports = function (reports) {\n\t\t\t$.each(reports, function (name, r) {\n\t\t\t\tif (!r.ref_doctype || r.ref_doctype == me.doctype) {\n\t\t\t\t\tvar report_type =\n\t\t\t\t\t\tr.report_type === \"Report Builder\"\n\t\t\t\t\t\t\t? `List/${r.ref_doctype}/Report`\n\t\t\t\t\t\t\t: \"query-report\";\n\n\t\t\t\t\tvar route = r.route || report_type + \"/\" + (r.title || r.name);\n\n\t\t\t\t\tif (added.indexOf(route) === -1) {\n\t\t\t\t\t\t// don't repeat\n\t\t\t\t\t\tadded.push(route);\n\n\t\t\t\t\t\tif (!divider) {\n\t\t\t\t\t\t\tme.get_divider().appendTo(dropdown);\n\t\t\t\t\t\t\tdivider = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t'<li><a href=\"#' + route + '\">' + __(r.title || r.name) + \"</a></li>\"\n\t\t\t\t\t\t).appendTo(dropdown);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// from reference doctype\n\t\tif (this.list_view.settings.reports) {\n\t\t\tadd_reports(this.list_view.settings.reports);\n\t\t}\n\n\t\t// Sort reports alphabetically\n\t\tvar reports =\n\t\t\tObject.values(frappe.boot.user.all_reports).sort((a, b) =>\n\t\t\t\ta.title.localeCompare(b.title)\n\t\t\t) || [];\n\n\t\t// from specially tagged reports\n\t\tadd_reports(reports);\n\t}\n\n\tsetup_list_filter() {\n\t\tthis.list_filter = new ListFilter({\n\t\t\twrapper: this.page.sidebar.find(\".list-filters\"),\n\t\t\tdoctype: this.doctype,\n\t\t\tlist_view: this.list_view,\n\t\t});\n\t}\n\n\tsetup_kanban_boards() {\n\t\tconst $dropdown = this.page.sidebar.find(\".kanban-dropdown\");\n\t\tfrappe.views.KanbanView.setup_dropdown_in_sidebar(this.doctype, $dropdown);\n\t}\n\n\tsetup_keyboard_shortcuts() {\n\t\tthis.sidebar.find(\".list-link > a, .list-link > .btn-group > a\").each((i, el) => {\n\t\t\tfrappe.ui.keys.get_shortcut_group(this.page).add($(el));\n\t\t});\n\t}\n\n\tsetup_list_group_by() {\n\t\tthis.list_group_by = new frappe.views.ListGroupBy({\n\t\t\tdoctype: this.doctype,\n\t\t\tsidebar: this,\n\t\t\tlist_view: this.list_view,\n\t\t\tpage: this.page,\n\t\t});\n\t}\n\n\tget_stats() {\n\t\tvar me = this;\n\n\t\tlet dropdown_options = me.sidebar.find(\".list-stats-dropdown .stat-result\");\n\t\tthis.set_loading_state(dropdown_options);\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.reportview.get_sidebar_stats\",\n\t\t\ttype: \"GET\",\n\t\t\targs: {\n\t\t\t\tstats: me.stats,\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\t// wait for list filter area to be generated before getting filters, or fallback to default filters\n\t\t\t\tfilters:\n\t\t\t\t\t(me.list_view.filter_area\n\t\t\t\t\t\t? me.list_view.get_filters_for_args()\n\t\t\t\t\t\t: me.default_filters) || [],\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tlet stats = (r.message.stats || {})[\"_user_tags\"] || [];\n\t\t\t\tme.render_stat(stats);\n\t\t\t\tlet stats_dropdown = me.sidebar.find(\".list-stats-dropdown\");\n\t\t\t\tfrappe.utils.setup_search(stats_dropdown, \".stat-link\", \".stat-label\");\n\t\t\t},\n\t\t});\n\t}\n\n\tset_loading_state(dropdown) {\n\t\tdropdown.html(`<li>\n\t\t\t<div class=\"empty-state\">\n\t\t\t\t${__(\"Loading...\")}\n\t\t\t</div>\n\t\t</li>`);\n\t}\n\n\trender_stat(stats) {\n\t\tlet args = {\n\t\t\tstats: stats,\n\t\t\tlabel: __(\"Tags\"),\n\t\t};\n\n\t\tlet tag_list = $(frappe.render_template(\"list_sidebar_stat\", args)).on(\n\t\t\t\"click\",\n\t\t\t\".stat-link\",\n\t\t\t(e) => {\n\t\t\t\tlet fieldname = $(e.currentTarget).attr(\"data-field\");\n\t\t\t\tlet label = $(e.currentTarget).attr(\"data-label\");\n\t\t\t\tlet condition = \"like\";\n\t\t\t\tlet existing = this.list_view.filter_area.filter_list.get_filter(fieldname);\n\t\t\t\tif (existing) {\n\t\t\t\t\texisting.remove();\n\t\t\t\t}\n\t\t\t\tif (label == \"No Tags\") {\n\t\t\t\t\tlabel = \"%,%\";\n\t\t\t\t\tcondition = \"not like\";\n\t\t\t\t}\n\t\t\t\tthis.list_view.filter_area.add(this.doctype, fieldname, condition, label);\n\t\t\t}\n\t\t);\n\n\t\tthis.sidebar.find(\".list-stats-dropdown .stat-result\").html(tag_list);\n\t}\n\n\treload_stats() {\n\t\tthis.sidebar.find(\".stat-link\").remove();\n\t\tthis.sidebar.find(\".stat-no-records\").remove();\n\t\tthis.get_stats();\n\t}\n\n\tadd_insights_banner() {\n\t\ttry {\n\t\t\tif (this.list_view.view != \"Report\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (localStorage.getItem(\"show_insights_banner\") == \"false\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.insights_banner) {\n\t\t\t\tthis.insights_banner.remove();\n\t\t\t}\n\n\t\t\tconst message = \"Get more insights with\";\n\t\t\tconst link = \"https://frappe.io/s/insights\";\n\t\t\tconst cta = \"Frappe Insights\";\n\n\t\t\tthis.insights_banner = $(`\n\t\t\t\t<div style=\"position: relative;\">\n\t\t\t\t\t<div class=\"pr-3\">\n\t\t\t\t\t\t${message} <a href=\"${link}\" target=\"_blank\" style=\"color: var(--primary-color)\">${cta} &rarr; </a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style=\"position: absolute; top: -1px; right: -4px; cursor: pointer;\" title=\"Dismiss\"\n\t\t\t\t\t\tonclick=\"localStorage.setItem('show_insights_banner', 'false') || this.parentElement.remove()\">\n\t\t\t\t\t\t<svg class=\"icon  icon-sm\" style=\"\">\n\t\t\t\t\t\t\t<use class=\"\" href=\"#icon-close\"></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`).appendTo(this.sidebar);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n};\n"],
  "mappings": "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",
  "names": []
}
